function t(t,e){var n=t.__state.conversionName.toString(),o=Math.round(t.r),r=Math.round(t.g),i=Math.round(t.b),a=t.a,s=Math.round(t.h),l=t.s.toFixed(1),c=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var d=t.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}return"CSS_RGB"===n?"rgb("+o+","+r+","+i+")":"CSS_RGBA"===n?"rgba("+o+","+r+","+i+","+a+")":"HEX"===n?"0x"+t.hex.toString(16):"RGB_ARRAY"===n?"["+o+","+r+","+i+"]":"RGBA_ARRAY"===n?"["+o+","+r+","+i+","+a+"]":"RGB_OBJ"===n?"{r:"+o+",g:"+r+",b:"+i+"}":"RGBA_OBJ"===n?"{r:"+o+",g:"+r+",b:"+i+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var e=Array.prototype.forEach,n=Array.prototype.slice,o={BREAK:{},extend:function(t){return this.each(n.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(e[n])||(t[n]=e[n])}.bind(this))}),this),t},defaults:function(t){return this.each(n.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(t[n])&&(t[n]=e[n])}.bind(this))}),this),t},compose:function(){var t=n.call(arguments);return function(){for(var e=n.call(arguments),o=t.length-1;o>=0;o--)e=[t[o].apply(this,e)];return e[0]}},each:function(t,n,o){if(t)if(e&&t.forEach&&t.forEach===e)t.forEach(n,o);else if(t.length===t.length+0){var r,i=void 0;for(i=0,r=t.length;i<r;i++)if(i in t&&n.call(o,t[i],i)===this.BREAK)return}else for(var a in t)if(n.call(o,t[a],a)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var o=void 0;return function(){var r=this,i=arguments;var a=n||!o;clearTimeout(o),o=setTimeout((function(){o=null,n||t.apply(r,i)}),e),a&&t.apply(r,i)}},toArray:function(t){return t.toArray?t.toArray():n.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},r=[{litmus:o.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:t},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:t},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:t},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:t}}},{litmus:o.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:o.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:o.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(o.isNumber(t.r)&&o.isNumber(t.g)&&o.isNumber(t.b)&&o.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(o.isNumber(t.r)&&o.isNumber(t.g)&&o.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(o.isNumber(t.h)&&o.isNumber(t.s)&&o.isNumber(t.v)&&o.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(o.isNumber(t.h)&&o.isNumber(t.s)&&o.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],i=void 0,a=void 0,s=function(){a=!1;var t=arguments.length>1?o.toArray(arguments):arguments[0];return o.each(r,(function(e){if(e.litmus(t))return o.each(e.conversions,(function(e,n){if(i=e.read(t),!1===a&&!1!==i)return a=i,i.conversionName=n,i.conversion=e,o.BREAK})),o.BREAK})),a},l=void 0,c={hsv_to_rgb:function(t,e,n){var o=Math.floor(t/60)%6,r=t/60-Math.floor(t/60),i=n*(1-e),a=n*(1-r*e),s=n*(1-(1-r)*e),l=[[n,s,i],[a,n,i],[i,n,s],[i,a,n],[s,i,n],[n,i,a]][o];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,n){var o=Math.min(t,e,n),r=Math.max(t,e,n),i=r-o,a=void 0;return 0===r?{h:NaN,s:0,v:0}:(a=t===r?(e-n)/i:e===r?2+(n-t)/i:4+(t-e)/i,(a/=6)<0&&(a+=1),{h:360*a,s:i/r,v:r/255})},rgb_to_hex:function(t,e,n){var o=this.hex_with_component(0,2,t);return o=this.hex_with_component(o,1,e),o=this.hex_with_component(o,0,n)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,n){return n<<(l=8*e)|t&~(255<<l)}},d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},p=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),h=function t(e,n,o){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,o)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(o):void 0},f=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},g=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},m=function(){function e(){if(u(this,e),this.__state=s.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return p(e,[{key:"toString",value:function(){return t(this)}},{key:"toHexString",value:function(){return t(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function _(t,e,n){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||m.recalculateRGB(this,e,n),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(m.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=t}})}function y(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||m.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(m.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}m.recalculateRGB=function(t,e,n){if("HEX"===t.__state.space)t.__state[e]=c.component_from_hex(t.__state.hex,n);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");o.extend(t.__state,c.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},m.recalculateHSV=function(t){var e=c.rgb_to_hsv(t.r,t.g,t.b);o.extend(t.__state,{s:e.s,v:e.v}),o.isNaN(e.h)?o.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},m.COMPONENTS=["r","g","b","h","s","v","hex","a"],_(m.prototype,"r",2),_(m.prototype,"g",1),_(m.prototype,"b",0),y(m.prototype,"h"),y(m.prototype,"s"),y(m.prototype,"v"),Object.defineProperty(m.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(m.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=c.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var b=function(){function t(e,n){u(this,t),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return p(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),v={};o.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){o.each(t,(function(t){v[t]=e}))}));var x=/(\d+(\.\d+)?)px/;function w(t){if("0"===t||o.isUndefined(t))return 0;var e=t.match(x);return o.isNull(e)?0:parseFloat(e[1])}var k={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,n){var r=n,i=e;o.isUndefined(i)&&(i=!0),o.isUndefined(r)&&(r=!0),t.style.position="absolute",i&&(t.style.left=0,t.style.right=0),r&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,n,r){var i=n||{},a=v[e];if(!a)throw new Error("Event type "+e+" not supported.");var s=document.createEvent(a);switch(a){case"MouseEvents":var l=i.x||i.clientX||0,c=i.y||i.clientY||0;s.initMouseEvent(e,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,l,c,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var d=s.initKeyboardEvent||s.initKeyEvent;o.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),d(e,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:s.initEvent(e,i.bubbles||!1,i.cancelable||!0)}o.defaults(s,r),t.dispatchEvent(s)},bind:function(t,e,n,o){var r=o||!1;return t.addEventListener?t.addEventListener(e,n,r):t.attachEvent&&t.attachEvent("on"+e,n),k},unbind:function(t,e,n,o){var r=o||!1;return t.removeEventListener?t.removeEventListener(e,n,r):t.detachEvent&&t.detachEvent("on"+e,n),k},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var n=t.className.split(/ +/);-1===n.indexOf(e)&&(n.push(e),t.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return k},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var n=t.className.split(/ +/),o=n.indexOf(e);-1!==o&&(n.splice(o,1),t.className=n.join(" "))}else t.className=void 0;return k},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return w(e["border-left-width"])+w(e["border-right-width"])+w(e["padding-left"])+w(e["padding-right"])+w(e.width)},getHeight:function(t){var e=getComputedStyle(t);return w(e["border-top-width"])+w(e["border-bottom-width"])+w(e["padding-top"])+w(e["padding-bottom"])+w(e.height)},getOffset:function(t){var e=t,n={left:0,top:0};if(e.offsetParent)do{n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent}while(e);return n},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},A=function(t){function e(t,n){u(this,e);var o=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=o;return o.__prev=o.getValue(),o.__checkbox=document.createElement("input"),o.__checkbox.setAttribute("type","checkbox"),k.bind(o.__checkbox,"change",(function(){r.setValue(!r.__prev)}),!1),o.domElement.appendChild(o.__checkbox),o.updateDisplay(),o}return f(e,b),p(e,[{key:"setValue",value:function(t){var n=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),T=function(t){function e(t,n,r){u(this,e);var i=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),a=r,s=i;if(i.__select=document.createElement("select"),o.isArray(a)){var l={};o.each(a,(function(t){l[t]=t})),a=l}return o.each(a,(function(t,e){var n=document.createElement("option");n.innerHTML=e,n.setAttribute("value",t),s.__select.appendChild(n)})),i.updateDisplay(),k.bind(i.__select,"change",(function(){var t=this.options[this.selectedIndex].value;s.setValue(t)})),i.domElement.appendChild(i.__select),i}return f(e,b),p(e,[{key:"setValue",value:function(t){var n=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return k.isActive(this.__select)?this:(this.__select.value=this.getValue(),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(),C=function(t){function e(t,n){u(this,e);var o=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=o;function i(){r.setValue(r.__input.value)}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),k.bind(o.__input,"keyup",i),k.bind(o.__input,"change",i),k.bind(o.__input,"blur",(function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())})),k.bind(o.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return f(e,b),p(e,[{key:"updateDisplay",value:function(){return k.isActive(this.__input)||(this.__input.value=this.getValue()),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function E(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var S=function(t){function e(t,n,r){u(this,e);var i=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),a=r||{};return i.__min=a.min,i.__max=a.max,i.__step=a.step,o.isUndefined(i.__step)?0===i.initialValue?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=E(i.__impliedStep),i}return f(e,b),p(e,[{key:"setValue",value:function(t){var n=t;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=E(t),this}}]),e}();var O=function(t){function e(t,n,r){u(this,e);var i=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));i.__truncationSuspended=!1;var a=i,s=void 0;function l(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function c(t){var e=s-t.clientY;a.setValue(a.getValue()+e*a.__impliedStep),s=t.clientY}function d(){k.unbind(window,"mousemove",c),k.unbind(window,"mouseup",d),l()}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),k.bind(i.__input,"change",(function(){var t=parseFloat(a.__input.value);o.isNaN(t)||a.setValue(t)})),k.bind(i.__input,"blur",(function(){l()})),k.bind(i.__input,"mousedown",(function(t){k.bind(window,"mousemove",c),k.bind(window,"mouseup",d),s=t.clientY})),k.bind(i.__input,"keydown",(function(t){13===t.keyCode&&(a.__truncationSuspended=!0,this.blur(),a.__truncationSuspended=!1,l())})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return f(e,S),p(e,[{key:"updateDisplay",value:function(){var t,n,o;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),n=this.__precision,o=Math.pow(10,n),Math.round(t*o)/o),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function L(t,e,n,o,r){return o+(t-e)/(n-e)*(r-o)}var F=function(t){function e(t,n,o,r,i){u(this,e);var a=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,{min:o,max:r,step:i})),s=a;function l(t){t.preventDefault();var e=s.__background.getBoundingClientRect();return s.setValue(L(t.clientX,e.left,e.right,s.__min,s.__max)),!1}function c(){k.unbind(window,"mousemove",l),k.unbind(window,"mouseup",c),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function d(t){var e=t.touches[0].clientX,n=s.__background.getBoundingClientRect();s.setValue(L(e,n.left,n.right,s.__min,s.__max))}function p(){k.unbind(window,"touchmove",d),k.unbind(window,"touchend",p),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),k.bind(a.__background,"mousedown",(function(t){document.activeElement.blur(),k.bind(window,"mousemove",l),k.bind(window,"mouseup",c),l(t)})),k.bind(a.__background,"touchstart",(function(t){if(1!==t.touches.length)return;k.bind(window,"touchmove",d),k.bind(window,"touchend",p),d(t)})),k.addClass(a.__background,"slider"),k.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return f(e,S),p(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),R=function(t){function e(t,n,o){u(this,e);var r=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),i=r;return r.__button=document.createElement("div"),r.__button.innerHTML=void 0===o?"Fire":o,k.bind(r.__button,"click",(function(t){return t.preventDefault(),i.fire(),!1})),k.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return f(e,b),p(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(),z=function(t){function e(t,n){u(this,e);var r=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));r.__color=new m(r.getValue()),r.__temp=new m(0);var i=r;r.domElement=document.createElement("div"),k.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",k.bind(r.__input,"keydown",(function(t){13===t.keyCode&&f.call(this)})),k.bind(r.__input,"blur",f),k.bind(r.__selector,"mousedown",(function(){k.addClass(this,"drag").bind(window,"mouseup",(function(){k.removeClass(i.__selector,"drag")}))})),k.bind(r.__selector,"touchstart",(function(){k.addClass(this,"drag").bind(window,"touchend",(function(){k.removeClass(i.__selector,"drag")}))}));var a,l=document.createElement("div");function c(t){y(t),k.bind(window,"mousemove",y),k.bind(window,"touchmove",y),k.bind(window,"mouseup",p),k.bind(window,"touchend",p)}function d(t){b(t),k.bind(window,"mousemove",b),k.bind(window,"touchmove",b),k.bind(window,"mouseup",h),k.bind(window,"touchend",h)}function p(){k.unbind(window,"mousemove",y),k.unbind(window,"touchmove",y),k.unbind(window,"mouseup",p),k.unbind(window,"touchend",p),_()}function h(){k.unbind(window,"mousemove",b),k.unbind(window,"touchmove",b),k.unbind(window,"mouseup",h),k.unbind(window,"touchend",h),_()}function f(){var t=s(this.value);!1!==t?(i.__color.__state=t,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function _(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}function y(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=i.__saturation_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,o=n.clientX,r=n.clientY,a=(o-e.left)/(e.right-e.left),s=1-(r-e.top)/(e.bottom-e.top);return s>1?s=1:s<0&&(s=0),a>1?a=1:a<0&&(a=0),i.__color.v=s,i.__color.s=a,i.setValue(i.__color.toOriginal()),!1}function b(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=i.__hue_field.getBoundingClientRect(),n=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return n>1?n=1:n<0&&(n=0),i.__color.h=360*n,i.setValue(i.__color.toOriginal()),!1}return o.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),o.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),o.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),o.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),o.extend(l.style,{width:"100%",height:"100%",background:"none"}),M(l,"top","rgba(0,0,0,0)","#000"),o.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(a=r.__hue_field).style.background="",a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),k.bind(r.__saturation_field,"mousedown",c),k.bind(r.__saturation_field,"touchstart",c),k.bind(r.__field_knob,"mousedown",c),k.bind(r.__field_knob,"touchstart",c),k.bind(r.__hue_field,"mousedown",d),k.bind(r.__hue_field,"touchstart",d),r.__saturation_field.appendChild(l),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return f(e,b),p(e,[{key:"updateDisplay",value:function(){var t=s(this.getValue());if(!1!==t){var e=!1;o.each(m.COMPONENTS,(function(n){if(!o.isUndefined(t[n])&&!o.isUndefined(this.__color.__state[n])&&t[n]!==this.__color.__state[n])return e=!0,{}}),this),e&&o.extend(this.__color.__state,t)}o.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,r=255-n;o.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,M(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),o.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),e}(),D=["-moz-","-o-","-webkit-","-ms-",""];function M(t,e,n,r){t.style.background="",o.each(D,(function(o){t.style.cssText+="background: "+o+"linear-gradient("+e+", "+n+" 0%, "+r+" 100%); "}))}var P=function(t,e){var n=e||document,o=document.createElement("style");o.type="text/css",o.innerHTML=t;var r=n.getElementsByTagName("head")[0];try{r.appendChild(o)}catch(t){}},I=function(t,e){var n=t[e];return o.isArray(arguments[2])||o.isObject(arguments[2])?new T(t,e,arguments[2]):o.isNumber(n)?o.isNumber(arguments[2])&&o.isNumber(arguments[3])?o.isNumber(arguments[4])?new F(t,e,arguments[2],arguments[3],arguments[4]):new F(t,e,arguments[2],arguments[3]):o.isNumber(arguments[4])?new O(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new O(t,e,{min:arguments[2],max:arguments[3]}):o.isString(n)?new C(t,e):o.isFunction(n)?new R(t,e,""):o.isBoolean(n)?new A(t,e):null};var B=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},N=function(){function t(){u(this,t),this.backgroundElement=document.createElement("div"),o.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),k.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),o.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;k.bind(this.backgroundElement,"click",(function(){e.hide()}))}return p(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),o.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",k.unbind(t.domElement,"webkitTransitionEnd",e),k.unbind(t.domElement,"transitionend",e),k.unbind(t.domElement,"oTransitionEnd",e)};k.bind(this.domElement,"webkitTransitionEnd",e),k.bind(this.domElement,"transitionend",e),k.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-k.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-k.getHeight(this.domElement)/2+"px"}}]),t}(),V=function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");P(V);var H="Default",j=function(){try{return!!window.localStorage}catch(t){return!1}}(),G=void 0,U=!0,$=void 0,X=!1,W=[],Y=function t(e){var n=this,r=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),k.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=o.defaults(r,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),r=o.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),o.isUndefined(r.load)?r.load={preset:H}:r.preset&&(r.load.preset=r.preset),o.isUndefined(r.parent)&&r.hideable&&W.push(this),r.resizable=o.isUndefined(r.parent)&&r.resizable,r.autoPlace&&o.isUndefined(r.scrollable)&&(r.scrollable=!0);var i,a=j&&"true"===localStorage.getItem(tt(this,"isLocal")),s=void 0,l=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(t){n.parent?n.getRoot().preset=t:r.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),n.revert()}},width:{get:function(){return r.width},set:function(t){r.width=t,rt(n,t)}},name:{get:function(){return r.name},set:function(t){r.name=t,l&&(l.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(e){r.closed=e,r.closed?k.addClass(n.__ul,t.CLASS_CLOSED):k.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return a},set:function(t){j&&(a=t,t?k.bind(window,"unload",s):k.unbind(window,"unload",s),localStorage.setItem(tt(n,"isLocal"),t))}}}),o.isUndefined(r.parent)){if(this.closed=r.closed||!1,k.addClass(this.domElement,t.CLASS_MAIN),k.makeSelectable(this.domElement,!1),j&&a){n.useLocalStorage=!0;var c=localStorage.getItem(tt(this,"gui"));c&&(r.load=JSON.parse(c))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,k.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),r.closeOnTop?(k.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(k.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),k.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===r.closed&&(r.closed=!0);var d=document.createTextNode(r.name);k.addClass(d,"controller-name"),l=K(n,d);k.addClass(this.__ul,t.CLASS_CLOSED),k.addClass(l,"title"),k.bind(l,"click",(function(t){return t.preventDefault(),n.closed=!n.closed,!1})),r.closed||(this.closed=!1)}r.autoPlace&&(o.isUndefined(r.parent)&&(U&&($=document.createElement("div"),k.addClass($,"dg"),k.addClass($,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild($),U=!1),$.appendChild(this.domElement),k.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||rt(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},k.bind(window,"resize",this.__resizeHandler),k.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),k.bind(this.__ul,"transitionend",this.__resizeHandler),k.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&ot(this),s=function(){j&&"true"===localStorage.getItem(tt(n,"isLocal"))&&localStorage.setItem(tt(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=s,r.parent||((i=n.getRoot()).width+=1,o.defer((function(){i.width-=1})))};function K(t,e,n){var o=document.createElement("li");return e&&o.appendChild(e),n?t.__ul.insertBefore(o,n):t.__ul.appendChild(o),t.onResize(),o}function J(t){k.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&k.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function Q(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];n.innerHTML=e?n.value+"*":n.value}function Z(t,e){var n=t.getRoot(),o=n.__rememberedObjects.indexOf(e.object);if(-1!==o){var r=n.__rememberedObjectIndecesToControllers[o];if(void 0===r&&(r={},n.__rememberedObjectIndecesToControllers[o]=r),r[e.property]=e,n.load&&n.load.remembered){var i=n.load.remembered,a=void 0;if(i[t.preset])a=i[t.preset];else{if(!i[H])return;a=i[H]}if(a[o]&&void 0!==a[o][e.property]){var s=a[o][e.property];e.initialValue=s,e.setValue(s)}}}}function q(t,e,n,r){if(void 0===e[n])throw new Error('Object "'+e+'" has no property "'+n+'"');var i=void 0;if(r.color)i=new z(e,n);else{var a=[e,n].concat(r.factoryArgs);i=I.apply(t,a)}r.before instanceof b&&(r.before=r.before.__li),Z(t,i),k.addClass(i.domElement,"c");var s=document.createElement("span");k.addClass(s,"property-name"),s.innerHTML=i.property;var l=document.createElement("div");l.appendChild(s),l.appendChild(i.domElement);var c=K(t,l,r.before);return k.addClass(c,Y.CLASS_CONTROLLER_ROW),i instanceof z?k.addClass(c,"color"):k.addClass(c,d(i.getValue())),function(t,e,n){if(n.__li=e,n.__gui=t,o.extend(n,{options:function(e){if(arguments.length>1){var r=n.__li.nextElementSibling;return n.remove(),q(t,n.object,n.property,{before:r,factoryArgs:[o.toArray(arguments)]})}if(o.isArray(e)||o.isObject(e)){var i=n.__li.nextElementSibling;return n.remove(),q(t,n.object,n.property,{before:i,factoryArgs:[e]})}},name:function(t){return n.__li.firstElementChild.firstElementChild.innerHTML=t,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof F){var r=new O(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});o.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=n[t],o=r[t];n[t]=r[t]=function(){var t=Array.prototype.slice.call(arguments);return o.apply(r,t),e.apply(n,t)}})),k.addClass(e,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof O){var i=function(e){if(o.isNumber(n.__min)&&o.isNumber(n.__max)){var r=n.__li.firstElementChild.firstElementChild.innerHTML,i=n.__gui.__listening.indexOf(n)>-1;n.remove();var a=q(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return a.name(r),i&&a.listen(),a}return e};n.min=o.compose(i,n.min),n.max=o.compose(i,n.max)}else n instanceof A?(k.bind(e,"click",(function(){k.fakeEvent(n.__checkbox,"click")})),k.bind(n.__checkbox,"click",(function(t){t.stopPropagation()}))):n instanceof R?(k.bind(e,"click",(function(){k.fakeEvent(n.__button,"click")})),k.bind(e,"mouseover",(function(){k.addClass(n.__button,"hover")})),k.bind(e,"mouseout",(function(){k.removeClass(n.__button,"hover")}))):n instanceof z&&(k.addClass(e,"color"),n.updateDisplay=o.compose((function(t){return e.style.borderLeftColor=n.__color.toString(),t}),n.updateDisplay),n.updateDisplay());n.setValue=o.compose((function(e){return t.getRoot().__preset_select&&n.isModified()&&Q(t.getRoot(),!0),e}),n.setValue)}(t,c,i),t.__controllers.push(i),i}function tt(t,e){return document.location.href+"."+e}function et(t,e,n){var o=document.createElement("option");o.innerHTML=e,o.value=e,t.__preset_select.appendChild(o),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function nt(t,e){e.style.display=t.useLocalStorage?"block":"none"}function ot(t){var e=void 0;function n(n){return n.preventDefault(),t.width+=e-n.clientX,t.onResize(),e=n.clientX,!1}function r(){k.removeClass(t.__closeButton,Y.CLASS_DRAG),k.unbind(window,"mousemove",n),k.unbind(window,"mouseup",r)}function i(o){return o.preventDefault(),e=o.clientX,k.addClass(t.__closeButton,Y.CLASS_DRAG),k.bind(window,"mousemove",n),k.bind(window,"mouseup",r),!1}t.__resize_handle=document.createElement("div"),o.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),k.bind(t.__resize_handle,"mousedown",i),k.bind(t.__closeButton,"mousedown",i),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function rt(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function it(t,e){var n={};return o.each(t.__rememberedObjects,(function(r,i){var a={},s=t.__rememberedObjectIndecesToControllers[i];o.each(s,(function(t,n){a[n]=e?t.initialValue:t.getValue()})),n[i]=a})),n}function at(t){0!==t.length&&B.call(window,(function(){at(t)})),o.each(t,(function(t){t.updateDisplay()}))}Y.toggleHide=function(){X=!X,o.each(W,(function(t){t.domElement.style.display=X?"none":""}))},Y.CLASS_AUTO_PLACE="a",Y.CLASS_AUTO_PLACE_CONTAINER="ac",Y.CLASS_MAIN="main",Y.CLASS_CONTROLLER_ROW="cr",Y.CLASS_TOO_TALL="taller-than-window",Y.CLASS_CLOSED="closed",Y.CLASS_CLOSE_BUTTON="close-button",Y.CLASS_CLOSE_TOP="close-top",Y.CLASS_CLOSE_BOTTOM="close-bottom",Y.CLASS_DRAG="drag",Y.DEFAULT_WIDTH=245,Y.TEXT_CLOSED="Close Controls",Y.TEXT_OPEN="Open Controls",Y._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||Y.toggleHide()},k.bind(window,"keydown",Y._keydownHandler,!1),o.extend(Y.prototype,{add:function(t,e){return q(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return q(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;o.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&$.removeChild(this.domElement);var t=this;o.each(this.__folders,(function(e){t.removeFolder(e)})),k.unbind(window,"keydown",Y._keydownHandler,!1),J(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var n=new Y(e);this.__folders[t]=n;var o=K(this,n.domElement);return k.addClass(o,"folder"),n},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],J(t);var e=this;o.each(t.__folders,(function(e){t.removeFolder(e)})),o.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=k.getOffset(t.__ul).top,n=0;o.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(n+=k.getHeight(e))})),window.innerHeight-e-20<n?(k.addClass(t.domElement,Y.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(k.removeClass(t.domElement,Y.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&o.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:o.debounce((function(){this.onResize()}),50),remember:function(){if(o.isUndefined(G)&&((G=new N).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;o.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&function(t){var e=t.__save_row=document.createElement("li");k.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),k.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",k.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",k.addClass(r,"button"),k.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",k.addClass(i,"button"),k.addClass(i,"save-as");var a=document.createElement("span");a.innerHTML="Revert",k.addClass(a,"button"),k.addClass(a,"revert");var s=t.__preset_select=document.createElement("select");t.load&&t.load.remembered?o.each(t.load.remembered,(function(e,n){et(t,n,n===t.preset)})):et(t,H,!1);if(k.bind(s,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(s),e.appendChild(n),e.appendChild(r),e.appendChild(i),e.appendChild(a),j){var l=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(tt(t,"isLocal"))&&c.setAttribute("checked","checked"),nt(t,l),k.bind(c,"change",(function(){t.useLocalStorage=!t.useLocalStorage,nt(t,l)}))}var d=document.getElementById("dg-new-constructor");k.bind(d,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||G.hide()})),k.bind(n,"click",(function(){d.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),G.show(),d.focus(),d.select()})),k.bind(r,"click",(function(){t.save()})),k.bind(i,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),k.bind(a,"click",(function(){t.revert()}))}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&rt(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=it(this)),t.folders={},o.each(this.__folders,(function(e,n){t.folders[n]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=it(this),Q(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[H]=it(this,!0)),this.load.remembered[t]=it(this),this.preset=t,et(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){o.each(this.__controllers,(function(e){this.getRoot().load.remembered?Z(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),o.each(this.__folders,(function(t){t.revert(t)})),t||Q(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&at(this.__listening)},updateDisplay:function(){o.each(this.__controllers,(function(t){t.updateDisplay()})),o.each(this.__folders,(function(t){t.updateDisplay()}))}});var st=Y,lt={};Object.defineProperty(lt,"__esModule",{value:!0});var ct=lt.default=void 0;const dt=6/29,ut=3*dt*dt,pt=t=>Math.round(255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055))||0,ht=t=>t>dt?t*t*t:ut*(t-4/29);function ft(t){return 0===t.length?0:void 0===t[0].length?1:void 0===t[0][0].length?2:void 0===t[0][0][0].length?3:void 0}ct=lt.default=({luminance:t,a:e,b:n})=>{const o=(t+16)/116,r=.96422*ht(o+e/500),i=Number(ht(o)),a=.82521*ht(o-n/200);return{red:pt(3.1338561*r-1.6168667*i-.4906146*a),green:pt(-.9787684*r+1.9161415*i+.033454*a),blue:pt(.0719453*r-.2289914*i+1.4052427*a)}},core["Charting`DateTicksFunction"]=()=>"DateTicksFunction",core.DateListPlot=()=>{};let gt=!1,mt=!1,_t={name:"WebObjects/Graphics"};const yt={name:"GraphicsComplex 2D"};interpretate.contextExpand(_t),["FaceForm","CurrentValue","FontColor","Tiny","VertexColors","Antialiasing","Small","Plot","ListLinePlot","ListPlot","Automatic","Controls","All","TickLabels","FrameTicksStyle","AlignmentPoint","AspectRatio","Axes","AxesLabel","AxesOrigin","AxesStyle","Background","BaselinePosition","BaseStyle","ColorOutput","ContentSelectable","CoordinatesToolOptions","DisplayFunction","Epilog","FormatType","Frame","FrameLabel","FrameStyle","FrameTicks","FrameTicksStyle","GridLines","GridLinesStyle","ImageMargins","ImagePadding","ImageSize","ImageSizeRaw","LabelStyle","Method","PlotLabel","PlotRange","PlotRangeClipping","PlotRangePadding","PlotRegion","PreserveImageOptions","Prolog","RotateLabel","Ticks","TicksStyle","TransitionDuration"].map((t=>{_t[t]=()=>t,_t[t].update=()=>t})),_t.HoldForm=async(t,e)=>await interpretate(t[0],e),_t.HoldForm.update=async(t,e)=>await interpretate(t[0],e),_t.Scale=async(t,e)=>await interpretate(t[0],e),_t.Scale.update=async(t,e)=>await interpretate(t[0],e),_t.NamespaceBox=async(t,e)=>await interpretate(t[1],e),_t.DynamicModuleBox=async(t,e)=>await interpretate(t[1],e),_t.TagBox=async(t,e)=>await interpretate(t[0],e),_t.DynamicModule=async(t,e)=>await interpretate(t[1],e),_t["Charting`DelayedClickEffect"]=async(t,e)=>await interpretate(t[0],e),_t.ColorProfileData=()=>{},_t.ParametricPlot=()=>{},_t.TransitionDuration=()=>"TransitionDuration",_t.TransitionType=()=>"TransitionType";_t.Offset=async(t,e)=>{const n=await interpretate(t[1],e);e.offset={x:e.xAxis(n[0])-e.xAxis(0),y:e.yAxis(n[1])-e.yAxis(0)};const o=await interpretate(t[0],e);return Array.isArray(o)?(o.map(((t,e)=>t+n[e])),[0,0]):o},_t.Offset.update=_t.Offset,_t.Graphics=async(t,e)=>{await interpretate.shared.d3.load(),gt||(gt=interpretate.shared.d3.d3),mt||(mt=interpretate.shared.d3["d3-interpolate-path"].interpolatePath),_t.interpolatePath=mt,_t.d3=gt,gt.selection.prototype.maybeTransition=function(t,e){return t?this.transition().ease(t).duration(e):this},gt.selection.prototype.maybeTransitionTween=function(t,e,n,o){return t?this.transition().ease(t).duration(e).attrTween(n,o):this.attr(n,o.apply(this.node(),this.data())(1))};let n=await core._getRules(t,{...e,context:_t,hold:!0});0==Object.keys(n).length&&t.length>1&&(n=await core._getRules(await interpretate(t[1],{...e,context:_t,hold:!0}),{...e,context:_t,hold:!0})),console.log(n);var o=e.element;let r=await interpretate(n.ImageSize,e);r||(r=e.imageSize?Array.isArray(e.imageSize)?e.imageSize:[e.imageSize,.618034*e.imageSize]:[core.DefaultWidth,.618034*core.DefaultWidth]);const i=await interpretate(n.AspectRatio,e)||.618034;r instanceof Array||(r=[r,r*i]),console.log("Image size"),console.log(r);let a,s,l,c=[!1,!1],d=!1,u=[5,5,5,5],p=[!0,!0,!0,!0],h=!1;if(console.log(n),n.Frame&&(n.Frame=await interpretate(n.Frame,e),!0===n.Frame?h=!0:(!0===n.Frame[0][0]&&(h=!0),!0===n.Frame[0]&&(h=!0))),n.Axes&&(n.Axes=await interpretate(n.Axes,e),!0===n.Axes?c=[!0,!0]:Array.isArray(n.Axes)&&(c=n.Axes)),h&&(d=!0,c=[!0,!0,!0,!0]),n.Ticks&&(n.Ticks=await interpretate(n.Ticks,e),Array.isArray(n.Ticks)&&Array.isArray(n.Ticks[0])&&(Number.isInteger(n.Ticks[0][0])||Array.isArray(n.Ticks[0][0]))&&(a=[...n.Ticks,...n.Ticks])),n.FrameTicks&&h&&(n.FrameTicks=await interpretate(n.FrameTicks,e),a=[!0,!0,!0,!0],Array.isArray(n.FrameTicks)&&(Array.isArray(n.FrameTicks[0])&&(Array.isArray(n.FrameTicks[0][0])?(Number.isInteger(n.FrameTicks[0][0][0])||"string"==typeof n.FrameTicks[0][0]||Array.isArray(n.FrameTicks[0][0][0]))&&(a[1]=n.FrameTicks[0][0],a[3]=n.FrameTicks[0][1]):(a[1]=n.FrameTicks[0][0],a[3]=n.FrameTicks[0][1])),Array.isArray(n.FrameTicks[1])&&(Array.isArray(n.FrameTicks[1][0])?(Number.isInteger(n.FrameTicks[1][0][0])||"string"==typeof n.FrameTicks[1][0]||Array.isArray(n.FrameTicks[1][0][0]))&&(a[0]=n.FrameTicks[1][0],a[2]=n.FrameTicks[1][1]):(a[0]=n.FrameTicks[1][0],a[2]=n.FrameTicks[1][1])))),n.TickDirection){const t=await interpretate(n.TickDirection,e);"Inward"===t&&(d=!0),"Outward"===t&&(d=!1)}n.TickLengths&&(n.TickLengths=await interpretate(n.TickLengths,e),Array.isArray(n.TickLengths)||(u=[n.TickLengths,n.TickLengths,n.TickLengths,n.TickLengths])),n.TickLabels&&(n.TickLabels=await interpretate(n.TickLabels,e),p=Array.isArray(n.TickLabels)?n.TickLabels.flat():[!1,!1,!1,!1]);let f={top:0,right:0,bottom:10,left:40},g={top:0,right:0,bottom:15,left:0};c[2]&&(f.top=f.bottom,f.left=f.right),n.AxesLabel&&(g.bottom=10,f.top=30,f.right=50,g.right=50),h&&(g.left=40,g.left=30,f.left=30,f.right=40,f.top=30,g.bottom=10,f.bottom=35),n.ImagePadding&&(console.log("padding: "),console.log(n.ImagePadding),n.ImagePadding=await interpretate(n.ImagePadding,e),"None"===n.ImagePadding?(f.top=0,f.bottom=0,f.left=0,f.right=0):Number.isInteger(n.ImagePadding)?(f.top=n.ImagePadding,f.bottom=n.ImagePadding,f.left=n.ImagePadding,f.right=n.ImagePadding):"All"===n.ImagePadding||console.error("given ImagePadding is not supported!"));let m,_=r[0]-f.left-f.right,y=r[1]-f.top-f.bottom;if((_<0||y<0)&&(f.top=0,f.bottom=0,f.left=0,f.right=0,g={top:0,right:0,bottom:0,left:0},_=r[0],y=r[1]),m=e.inset?e.inset.append("svg"):gt.select(o).append("svg"),"ViewBox"in n){let t=await interpretate(n.ViewBox,e);t instanceof Array||(t=[0,0,t,t*i]),m.attr("viewBox",t),e.viewBox=t}else m.attr("width",_+f.left+f.right+g.left).attr("height",y+f.top+f.bottom+g.bottom),e.svgWidth=_+f.left+f.right+g.left,e.svgHeight=y+f.top+f.bottom+g.bottom;const b=m;m=m.append("g").attr("transform","translate("+(f.left+g.left)+","+f.top+")");let v=[[-1.15,1.15],[-1.15,1.15]],x=!0;if(n.PlotRange){const t=await interpretate(n.PlotRange,e);Number.isFinite(t[0][0])&&(Number.isFinite(t[1][0])?(v=t,x=!1):(v[0]=t[0],v[1]=t[0]))}let w,k,A,T,C=gt.easeLinear;if(n.TransitionType){switch(await interpretate(n.TransitionType,{...e,context:_t})){case"Linear":C=gt.easeLinear;break;case"CubicInOut":C=gt.easeCubicInOut;break;default:C=void 0}}console.log(v);let E=gt.scaleLinear().domain(v[0]).range([0,_]),S=gt.axisBottom(E),O=gt.axisTop(E);if(console.log(c),a)if(a[0])if("string"==typeof a[0])switch(a[0]){case"Automatic":break;case"None":S=S.tickValues([]);break;case"DateTicksFunction":E=gt.scaleTime().domain(v[0].map((t=>1e3*t-2208996e6))).range([0,_]),O=gt.axisTop(E),S=gt.axisBottom(E);const t=E;E=e=>t(1e3*e-2208996e6),E.copy=t.copy,E.range=t.range,E.domain=t.domain,E.invert=t.invert}else if(!0===a[0])console.log("Default ticks");else if(Array.isArray(a[0][0])){const t=a[0].map((t=>t[1]));S=S.tickValues(a[0].map((t=>t[0]))).tickFormat((function(e,n){return t[n]}))}else S=S.tickValues(a[0]);else S=S.tickValues([]);if(a)if(a[2])if("string"==typeof a[2])switch(a[2]){case"Automatic":break;case"None":O=O.tickValues([]);break;case"DateTicksFunction":E=gt.scaleTime().domain(v[0].map((t=>1e3*t-2208996e6))).range([0,_]),O=gt.axisTop(E),S=gt.axisBottom(E);const t=E;E=e=>t(1e3*e-2208996e6),E.copy=t.copy,E.range=t.range,E.domain=t.domain,E.invert=t.invert}else if(!0===a[2])console.log("Default ticks");else if(Array.isArray(a[2][0])){const t=a[2].map((t=>t[1]));O=O.tickValues(a[2].map((t=>t[0]))).tickFormat((function(e,n){return t[n]}))}else O=O.tickValues(a[2]);else O=O.tickValues([]);p[0]||(S=S.tickFormat((t=>""))),p[1]||(O=O.tickFormat((t=>""))),d?(S=S.tickSizeInner(-u[0]).tickSizeOuter(0),O=O.tickSizeInner(-u[2]).tickSizeOuter(0)):(S=S.tickSizeInner(u[0]).tickSizeOuter(0),O=O.tickSizeInner(u[2]).tickSizeOuter(0));let L=gt.scaleLinear().domain(v[1]).range([y,0]),F=gt.axisLeft(L),R=gt.axisRight(L);if(a)if(a[1])if("string"==typeof a[1])switch(a[1]){case"Automatic":break;case"None":F=F.tickValues([]);break;case"DateTicksFunction":L=gt.scaleTime().domain(v[1].map((t=>1e3*t-2208996e6))).range([0,y]),R=gt.axisRight(L),F=gt.axisLeft(L);const t=L;L=e=>t(1e3*e-2208996e6),L.copy=t.copy,L.range=t.range,L.domain=t.domain,L.invert=t.invert}else if(!0===a[1])console.log("Default ticks");else if(Array.isArray(a[1][0])){const t=a[1].map((t=>t[1]));F=F.tickValues(a[1].map((t=>t[0]))).tickFormat((function(e,n){return t[n]}))}else F=F.tickValues(a[1]);else F=F.tickValues([]);if(a)if(a[3])if("string"==typeof a[3])switch(a[3]){case"Automatic":break;case"None":R=R.tickValues([]);break;case"DateTicksFunction":L=gt.scaleTime().domain(v[1].map((t=>1e3*t-2208996e6))).range([0,y]),R=gt.axisRight(L),F=gt.axisLeft(L);const t=L;L=e=>t(1e3*e-2208996e6),L.copy=t.copy,L.range=t.range,L.domain=t.domain,L.invert=t.invert}else if(!0===a[3])console.log("Default ticks");else if(Array.isArray(a[3][0])){const t=a[3].map((t=>t[1]));R=R.tickValues(a[3].map((t=>t[0]))).tickFormat((function(e,n){return t[n]}))}else R=R.tickValues(a[3]);else R=R.tickValues([]);if(p[2]||(F=F.tickFormat((t=>""))),p[3]||(R=R.tickFormat((t=>""))),d?(F=F.tickSizeInner(-u[1]).tickSizeOuter(0),R=R.tickSizeInner(-u[3]).tickSizeOuter(0)):(F=F.tickSizeInner(u[1]).tickSizeOuter(0),R=R.tickSizeInner(u[3]).tickSizeOuter(0)),e.context=_t,e.svg=m.append("g"),e.xAxis=E,e.yAxis=L,e.numerical=!0,e.tostring=!1,e.offset={x:0,y:0},e.color="rgb(68, 68, 68)",e.stroke=void 0,e.opacity=1,e.fontsize=10,e.fontfamily="sans-serif",e.strokeWidth=1.5,e.pointSize=.013,e.arrowHead=1,e.transitionDuration=50,e.transitionType=C,e.plotRange=v,s={...e},l={...e},n.AxesStyle&&await interpretate(n.AxesStyle,s),n.FrameStyle&&(console.warn("FrameStyle"),console.log(n.FrameStyle),await interpretate(n.FrameStyle,s),console.log(s)),n.FrameTicksStyle&&await interpretate(n.FrameTicksStyle,l),c[0]&&(w=m.append("g").attr("transform","translate(0,"+y+")").call(S).attr("font-size",l.fontsize).attr("fill",l.color)),c[2]&&(A=m.append("g").attr("transform","translate(0,0)").call(O).attr("font-size",l.fontsize).attr("fill",l.color)),c[1]&&(k=m.append("g").call(F).attr("font-size",l.fontsize).attr("fill",l.color)),c[3]&&(T=m.append("g").attr("transform","translate("+_+", 0)").call(R).attr("font-size",l.fontsize).attr("fill",l.color)),n.AxesLabel&&!h&&(n.AxesLabel=await interpretate(n.AxesLabel,{...e,hold:!0}),Array.isArray(n.AxesLabel))){let t={...e},o=await interpretate(n.AxesLabel[0],t);"None"!=o&&w&&_t.Text.PutText(w.append("text").attr("x",_+t.offset.x+10).attr("y",f.bottom+t.offset.y).attr("font-size",s.fontsize).attr("fill",s.color).attr("text-anchor","start"),o,s),t={...e},o=await interpretate(n.AxesLabel[1],t),"None"!=o&&k&&_t.Text.PutText(k.append("text").attr("x",0+t.offset.x).attr("y",-f.top/2+t.offset.y).attr("font-size",s.fontsize).attr("fill",s.color).attr("text-anchor","start"),o,s)}if(n.FrameLabel&&h&&(n.FrameLabel=await interpretate(n.FrameLabel,{...e,hold:!0}),Array.isArray(n.FrameLabel))){const t=await interpretate(n.FrameLabel[0],{...e,hold:!0}),o=await interpretate(n.FrameLabel[1],{...e,hold:!0});let r,i;"None"!=t&&t&&(r={...e},i=await interpretate(t[0],r),"None"!=i&&k&&_t.Text.PutText(k.append("text").attr("transform","rotate(-90)").attr("y",-f.left+r.offset.x).attr("x",-y/2-r.offset.y).attr("font-size",s.fontsize).attr("fill",s.color).attr("text-anchor","middle"),i,s),r={...e},i=await interpretate(t[1],r),"None"!=i&&T&&_t.Text.PutText(T.append("text").attr("x",0+r.offset.x).attr("y",f.bottom+r.offset.y).attr("font-size",s.fontsize).attr("fill",s.color).attr("text-anchor","middle"),i,s)),"None"!=o&&o&&(r={...e},i=await interpretate(o[1],r),"None"!=i&&A&&_t.Text.PutText(A.append("text").attr("x",_/2+r.offset.x).attr("y",f.bottom+r.offset.y).attr("font-size",s.fontsize).attr("fill",s.color).attr("text-anchor","middle"),i,s),r={...e},i=await interpretate(o[0],r),"None"!=i&&w&&_t.Text.PutText(w.append("text").attr("x",_/2+r.offset.x).attr("y",f.bottom+r.offset.y).attr("font-size",s.fontsize).attr("fill",s.color).attr("text-anchor","middle"),i,s))}if(n.TransitionDuration&&(e.transitionDuration=await interpretate(n.TransitionDuration,e)),e.local.xAxis=E,e.local.yAxis=L,(n.Controls||void 0===n.Controls)&&(void 0===n.Controls||await interpretate(n.Controls,e))&&xt(b,m,e.svg,w,k,A,T,S,F,O,R,E,L,e),e.panZoomEntites={canvas:b,svg:e.svg,gX:w,gY:k,gTX:A,gRY:T,xAxis:S,yAxis:F,txAxis:O,ryAxis:R,x:E,y:L},!e.inset){const t=new st({autoPlace:!1,name:"...",closed:!0}),n=document.createElement("div");n.classList.add("graphics2d-controller"),n.appendChild(t.domElement);const r={Save:function(){!function(t,e){if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(t,e);else{const n=document.createElement("a");document.body.appendChild(n);const o=window.URL.createObjectURL(t);n.href=o,n.download=e,n.click(),setTimeout((()=>{window.URL.revokeObjectURL(o),document.body.removeChild(n)}),0)}}(vt(o.firstChild),"plot.svg")}};t.add(r,"Save"),e.element.appendChild(n)}if(await interpretate(n.Prolog,e),await interpretate(t[0],e),await interpretate(n.Epilog,e),x){console.warn("d3.js autoscale!");const t=r[0]-(f.left+f.right),n=r[1]-(f.top+f.bottom);let o=e.svg.node().getBBox();console.log([t,n]),o.width||(console.warn("Warning! Looks like an element was not drawn properly"),o.width=r[0],o.height=r[0],o.x=0,o.y=0,console.log(o)),console.log(o);const i=Math.min(t/o.width,n/o.height);console.log(i);let a=gt.zoomTransform(b);a=a.translate(t/2,n/2),a=a.scale(i),a=a.translate(-o.x-o.width/2,-o.y-o.height/2),console.log(a),bt(a,m,e.svg,w,k,A,T,S,F,O,R,E,L),e._zoom&&e._zoom.transform(b,a)}};const bt=(t,e,n,o,r,i,a,s,l,c,d,u,p)=>{n.attr("transform",t),o&&o.call(s.scale(t.rescaleX(u))),r&&r.call(l.scale(t.rescaleY(p))),i&&i.call(c.scale(t.rescaleX(u))),a&&a.call(d.scale(t.rescaleY(p)))};_t.Graphics.update=(t,e)=>{console.error("root update method for Graphics is not supported")},_t.Graphics.destroy=(t,e)=>{console.error("Nothing to destroy...")},_t.Inset=async(t,e)=>{const n=await interpretate(t[1],e),o=e.svg.append("g");return await interpretate(t[0],{...e,inset:o}),e.local.group=o,o.attr("transform","translate("+e.xAxis(n[0])+","+e.yAxis(n[1])+")")},_t.Inset.update=async(t,e)=>{const n=await interpretate(t[1],e);return e.local.group.attr("transform","translate("+e.xAxis(n[0])+","+e.yAxis(n[1])+")"),e.local.group},_t.Inset.destroy=async(t,e)=>{console.warn("Destory method is not defined for Inset")},_t.Inset.virtual=!0;const vt=t=>{const e="http://www.w3.org/2000/xmlns/";t=t.cloneNode(!0);const n=window.location.href+"#",o=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT);for(;o.nextNode();)for(const t of o.currentNode.attributes)t.value.includes(n)&&(t.value=t.value.replace(n,"#"));t.setAttributeNS(e,"xmlns","http://www.w3.org/2000/svg"),t.setAttributeNS(e,"xmlns:xlink","http://www.w3.org/1999/xlink");const r=(new window.XMLSerializer).serializeToString(t);return new Blob([r],{type:"image/svg+xml"})};const xt=(t,e,n,o,r,i,a,s,l,c,d,u,p,h)=>{console.log({listener:t,raw:e,view:n,gX:o,gY:r,gTX:i,gRY:a,xAxis:s,yAxis:l,txAxis:c,ryAxis:d,x:u,y:p,env:h});const f=gt.zoom().filter((function(t){return t.preventDefault(),!(t.ctrlKey&&"wheel"!==t.type||t.button)})).on("zoom",(function({transform:t}){n.attr("transform",t),o&&o.call(s.scale(t.rescaleX(u)));r&&r.call(l.scale(t.rescaleY(p)));i&&i.call(c.scale(t.rescaleX(u)));a&&a.call(d.scale(t.rescaleY(p)))}));t.call(f),h._zoom=f};let wt;_t.SVGAttribute=async(t,e)=>{const n=await core._getRules(t,e);let o=await interpretate(t[0],e);return Object.keys(n).forEach((t=>{o=o.attr(t,n[t])})),e.local.object=o,o},_t.SVGAttribute.update=async(t,e)=>{const n=await core._getRules(t,e);let o=e.local.object.maybeTransition(e.transitionType,e.transitionDuration);return Object.keys(n).forEach((t=>{o=o.attr(t,n[t])})),o},_t.SVGAttribute.destroy=async(t,e)=>{console.log("SVGAttribute: nothing to destroy")},_t.SVGAttribute.virtual=!0,_t.LABColor=async(t,e)=>{let n;n=t.length>1?[await interpretate(t[0],e),await interpretate(t[1],e),await interpretate(t[2],e)]:await interpretate(t[0],e);const o=ct({luminance:100*n[0],a:100*n[1],b:100*n[2]});return console.log(n),console.log("LAB color"),console.log(o),e.color="rgb("+Math.floor(o.red)+","+Math.floor(o.green)+","+Math.floor(o.blue)+")",t.length>3&&(e.opacity=await interpretate(t[3],e)),e.color},_t.LABColor.update=()=>{},_t.arrowGenerator=void 0,yt.Arrow=async(t,e)=>{await interpretate.shared.d3.load(),wt||(wt=(await interpretate.shared.d3["d3-arrow"]).arrow1);let n=await interpretate(t[0],e);if(!Array.isArray(n)){let t;const o=uuidv4(),r=wt().id(o).attr("fill",e.color).attr("stroke","none").scale([e.arrowHead]);return e.svg.call(r),t=n.attr("marker-end","url(#"+o+")"),t}const o=e.xAxis,r=e.yAxis;if(n[0][0]){console.log("Multiple isntances"),console.log(n);const t=e.svg.append("g");t.attr("fill","none").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth);const i=uuidv4(),a=wt().id(i).attr("fill",e.color).attr("stroke","none").scale([e.arrowHead]);return e.svg.call(a),n.forEach((n=>{t.append("path").datum(n.map((t=>e.vertices[t-1]))).attr("vector-effect","non-scaling-stroke").attr("d",gt.line().x((function(t){return o(t[0])})).y((function(t){return r(t[1])}))).attr("marker-end","url(#"+i+")")})),t}{const t=uuidv4(),i=wt().id(t).attr("fill",e.color).attr("stroke","none").scale([e.arrowHead]);e.svg.call(i);return e.svg.append("path").datum(n.map((t=>e.vertices[t-1]))).attr("fill","none").attr("vector-effect","non-scaling-stroke").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",gt.line().x((function(t){return o(t[0])})).y((function(t){return r(t[1])}))).attr("marker-end","url(#"+t+")")}},_t.Arrow=async(t,e)=>{await interpretate.shared.d3.load(),wt||(wt=(await interpretate.shared.d3["d3-arrow"]).arrow1),e.xAxis,e.yAxis;const n=uuidv4(),o=wt().id(n).attr("fill",e.color).attr("stroke","none").scale([e.arrowHead]);e.svg.call(o);const r=await interpretate(t[0],e);if(!Array.isArray(r)){let t;return t=r.attr("marker-end","url(#"+n+")"),t}if(e.local.line=gt.line().x((function(t){return e.xAxis(t[0])})).y((function(t){return e.yAxis(t[1])})),r[0][0][0]){const t=[];return r.forEach((o=>{t.push(e.svg.append("path").datum(o).attr("vector-effect","non-scaling-stroke").attr("fill","none").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",e.local.line).attr("marker-end","url(#"+n+")"))})),e.local.arrows=t,t}{const t=e.svg.append("path").datum(r).attr("vector-effect","non-scaling-stroke").attr("fill","none").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",e.local.line).attr("marker-end","url(#"+n+")");return e.local.arrow=t,t}},_t.Arrow.update=async(t,e)=>{e.xAxis,e.yAxis;const n=await interpretate(t[0],e);if(n[0][0][0])throw"Arrows update method does not support multiple traces";return e.local.arrow.datum(n).maybeTransitionTween(e.TransitionType,e.TransitionDuration,"d",(function(t){var n=gt.select(this).attr("d"),o=e.local.line(t);return mt(n,o)}))},_t.Arrow.virtual=!0,_t.Arrow.destroy=async()=>{},_t.Arrowheads=async(t,e)=>{const n=await interpretate(t[0],e);Array.isArray(n)?e.arrowHead=10*n.flat()[0]:e.arrowHead=10*n},_t.Text=async(t,e)=>{const n=await interpretate(t[0],e),o=await interpretate(t[1],e);e.local.text=n;let r={x:0,y:0};e.offset&&(r=e.offset);const i=e.svg.append("text").attr("font-family",e.fontfamily).attr("font-size",e.fontsize).attr("fill",e.color);if(t.length>2){const n=await interpretate(t[2],e);i.attr("x",e.xAxis(o[0]+n[0])+r.x).attr("y",e.yAxis(o[1]+n[1])+r.y)}else i.attr("x",e.xAxis(o[0])+r.x).attr("y",e.yAxis(o[1])+r.y);return _t.Text.PutText(i,n,e),e.local.object=i,i},_t.Text.PutText=(t,e,n)=>{if(!e)return;const o=[_t.Text.TokensSplit(e.replaceAll(/\\([a-zA-z]+)/g,_t.Text.GreekReplacer),_t.Text.TextOperators)].flat(1/0);let r;console.log(o),t.html(o.shift());let i=0;for(;null!=(r=o.shift());)"string"==typeof r?(t.append("tspan").html(r).attr("font-size",n.fontsize).attr("dy",-i),i=0):(i=-n.fontsize*r.ky,t.append("tspan").html(r.data).attr("font-size",Math.round(n.fontsize*r.kf)).attr("dy",i))},_t.Text.TextOperators=[{type:"sup",handler:t=>t,regexp:/\^(\d{1,3})/,meta:{ky:.5,kf:.5}},{type:"sup",handler:t=>t,regexp:/\^{([^{|}]*)}/,meta:{ky:.5,kf:.5}},{type:"sub",handler:t=>t,regexp:/\_(\d{1,3})/,meta:{ky:-.5,kf:.5}},{type:"sub",handler:t=>t,regexp:/\_{([^{|}]*)}/,meta:{ky:-.5,kf:.5}}],_t.Text.GreekReplacer=(t,e,n)=>"&"+e.toLowerCase().replace("sqrt","radic").replace("degree","deg")+";",_t.Text.TokensSplit=(t,e,n=0)=>{if(n===e.length||n<0)return t;const o=t.match(e[n].regexp);if(null===o)return _t.Text.TokensSplit(t,e,n+1);const r={type:e[n].type,data:e[n].handler(o[1]),...e[n].meta};return[_t.Text.TokensSplit(t.slice(0,o.index),e,n+1),r,_t.Text.TokensSplit(t.slice(o.index+o[0].length),e,0)]},_t.Text.virtual=!0,_t.Text.update=async(t,e)=>{const n=await interpretate(t[0],e),o=await interpretate(t[1],e);let r;return r=e.local.text!=n?e.local.object.maybeTransition(e.transitionType,e.transitionDuration).text(n).attr("x",e.xAxis(o[0])).attr("y",e.yAxis(o[1])).attr("fill",e.color):e.local.object.maybeTransition(e.transitionType,e.transitionDuration).attr("x",e.xAxis(o[0])).attr("y",e.yAxis(o[1])).attr("fill",e.color),r},_t.Text.destroy=()=>{console.log("Nothing to destory")},_t.Text.subcontext={},_t.FontSize=()=>"FontSize",_t.FontSize.update=_t.FontSize,_t.FontFamily=()=>"FontFamily",_t.FontFamily.update=_t.FontFamily,_t.Style=async(t,e)=>{const n={...e},o=await core._getRules(t,e);o.FontSize&&(n.fontsize=o.FontSize),o.FontColor&&(n.color=o.FontColor),o.FontFamily&&(n.fontfamily=o.FontFamily);for(let e=1;e<t.length-Object.keys(o).length;++e)await interpretate(t[e],n);return await interpretate(t[0],n)},_t.Style.update=async(t,e)=>{const n=await core._getRules(t,e);return n.FontSize&&(e.fontsize=n.FontSize),n.FontFamily&&(e.fontfamily=n.FontFamily),await interpretate(t[0],e)},_t.AnimationFrameListener=async(t,e)=>{await interpretate(t[0],e);const n=await core._getRules(t,{...e,hold:!0});e.local.event=await interpretate(n.Event,e),e.local.fire=()=>{server.kernel.emitt(e.local.event,"True","Frame")},window.requestAnimationFrame(e.local.fire)},_t.AnimationFrameListener.update=async(t,e)=>{window.requestAnimationFrame(e.local.fire)},_t.AnimationFrameListener.destroy=async(t,e)=>{console.warn("AnimationFrameListener does not exist anymore")},_t.AnimationFrameListener.virtual=!0,_t.GraphicsComplex=async(t,e)=>{const n=await interpretate(t[0],e),o=await core._getRules(t,e),r={...e,vertices:n,context:[yt,_t]};return o.VertexColors&&(r.vertexColors=o.VertexColors),await interpretate(t[1],r)},_t.GraphicsComplex.update=()=>{throw"Updates of GraphicsComplex are not supported!"},_t.GraphicsComplex.destroy=()=>{console.log("Nothing to destroy")},_t.GraphicsComplex.virtual=!0,_t.Medium=()=>.08,_t.Large=()=>1.1/10,_t.Small=()=>.025,_t.GraphicsGroup=async(t,e)=>await interpretate(t[0],e),_t.GraphicsGroup.update=async(t,e)=>await interpretate(t[0],e),_t.AbsoluteThickness=(t,e)=>{e.strokeWidth=interpretate(t[0],e)},_t.PointSize=(t,e)=>{e.pointSize=interpretate(t[0],e)},_t.Annotation=core.List,_t.ZoomAt=async(t,e)=>{let n=await interpretate(t[0],e),o=[0,0];t.length>1&&(o=await interpretate(t[1],e)),o=[e.xAxis(o[0])-e.xAxis(0),e.yAxis(o[1])-e.yAxis(0)],console.log(o);const r=e.panZoomEntites;console.log(e.svg.attr("transform"));const i=e.svg.node().getBBox(),a=gt.zoomIdentity.translate(i.width/2,i.height/2).scale(n).translate(-i.width/2-o[0],-i.height/2-o[1]);r.svg.maybeTransition(e.transitionType,e.transitionDuration).attr("transform",a),r.gX&&r.gX.maybeTransition(e.transitionType,e.transitionDuration).call(r.xAxis.scale(a.rescaleX(r.x))),r.gY&&r.gY.maybeTransition(e.transitionType,e.transitionDuration).call(r.yAxis.scale(a.rescaleY(r.y))),r.gTX&&r.gTX.maybeTransition(e.transitionType,e.transitionDuration).call(r.txAxis.scale(a.rescaleX(r.x))),r.gRY&&r.gRY.maybeTransition(e.transitionType,e.transitionDuration).call(r.ryAxis.scale(a.rescaleY(r.y)))};_t.Directive=async(t,e)=>{const n=await core._getRules(t,e);for(const t of Object.keys(n))e[t.toLowerCase()]=n[t];if((t=>{if("transitiontype"in t)switch(t.transitiontype){case"Linear":t.transitionType=gt.easeLinear;break;case"CubicInOut":t.transitionType=gt.easeCubicInOut;break;default:t.transitionType=!1}t.transitionduration&&(t.transitionDuration=t.transitionduration)})(e),"PlotRange"in n){n.PlotRange;((t,e,n,o)=>{throw"not implemented"})(0,e.plotRange,e.panZoomEntites)}for(let o=0;o<t.length-Object.keys(n).length;++o)await interpretate(t[o],e)},_t.EdgeForm=async(t,e)=>{const n={...e};await interpretate(t[0],n),e.strokeWidth=n.strokeWidth,e.strokeOpacity=n.opacity,"rgb(68, 68, 68)"!==n.color&&(e.stroke=n.color)},_t.EdgeForm.update=async(t,e)=>{},_t.Opacity=async(t,e)=>{e.opacity=await interpretate(t[0],e)},_t.GrayLevel=async(t,e)=>{let n=await interpretate(t[0],e);return n.length&&(n=n[0]),n=Math.floor(255*n),e.color=`rgb(${n},${n},${n})`,e.color},_t.RGBColor=async(t,e)=>{if(3==t.length)e.color="rgb(",e.color+=String(Math.floor(255*await interpretate(t[0],e)))+",",e.color+=String(Math.floor(255*await interpretate(t[1],e)))+",",e.color+=String(Math.floor(255*await interpretate(t[2],e)))+")";else{const n=await interpretate(t[0],e);e.color="rgb(",e.color+=String(Math.floor(255*n[0]))+",",e.color+=String(Math.floor(255*n[1]))+",",e.color+=String(Math.floor(255*n[2]))+")"}return e.color};_t.Hue=async(t,e)=>{if(3==t.length){let n=await Promise.all(t.map((t=>interpretate(t,e))));n=((t,e,n,o=n-n*e/2,r=Math.min(o,1-o))=>[t,r?(n-o)/r:0,o])(...n),n=[n[0],(100*n[1]).toFixed(2),(100*n[2]).toFixed(2)],e.color="hsl("+(314*n[0]).toFixed(2)+","+n[1]+"%,"+n[2]+"%)"}else console.error("g2d: Hue must have three arguments!")},_t.CubicInOut=()=>"CubicInOut",_t.Linear=()=>"Linear",_t.Tooltip=()=>{console.log("Tooltip is not implemented.")},yt.List=core.List,yt.Polygon=async(t,e)=>{let n=await interpretate(t[0],e);if(!e.vertices)throw"No vertices provided!";e.local.line||(e.local.line=gt.line().x((function(t){return e.xAxis(t[0])})).y((function(t){return e.yAxis(t[1])})));const o=[];let r=e.color;return n[0][0]||(n=[n]),n.forEach((t=>{e.vertexColors&&(r=[0,0,0],t.map((t=>{if("string"==typeof e.vertexColors[t-1]){const n=gt.color(e.vertexColors[t-1]);r[0]=r[0]+n.r/255,r[1]=r[1]+n.g/255,r[2]=r[2]+n.b/255}else r[0]=r[0]+e.vertexColors[t-1][0],r[1]=r[1]+e.vertexColors[t-1][1],r[2]=r[2]+e.vertexColors[t-1][2]})),r[0]=255*r[0]/t.length,r[1]=255*r[1]/t.length,r[2]=255*r[2]/t.length,r="rgb("+r[0]+","+r[1]+","+r[2]+")"),o.push(e.svg.append("path").datum(t.map((t=>e.vertices[t-1]))).attr("fill",r).attr("fill-opacity",e.opacity).attr("stroke-opacity",e.strokeOpacity||e.opacity).attr("vector-effect","non-scaling-stroke").attr("stroke-width",e.strokeWidth).attr("stroke",e.stroke||r).attr("d",e.local.line))})),o},_t.Polygon=async(t,e)=>{let n=await interpretate(t[0],e);if(e.local.line=gt.line().x((function(t){return e.xAxis(t[0])})).y((function(t){return e.yAxis(t[1])})),Array.isArray(n[0][0])){console.log("most likely there are many polygons");const t=e.svg.append("g").attr("fill",e.color).attr("fill-opacity",e.opacity).attr("stroke-opacity",e.strokeOpacity||e.opacity).attr("vector-effect","non-scaling-stroke").attr("stroke-width",e.strokeWidth).attr("stroke",e.stroke||e.color);return n.forEach((n=>{n.push(n[0]),t.append("path").datum(n).attr("d",e.local.line)})),e.local.polygons=t,t}return n.push(n[0]),e.local.area=e.svg.append("path").datum(n).attr("fill",e.color).attr("fill-opacity",e.opacity).attr("stroke-opacity",e.strokeOpacity||e.opacity).attr("vector-effect","non-scaling-stroke").attr("stroke-width",e.strokeWidth).attr("stroke",e.stroke||e.color).attr("d",e.local.line),e.local.area},_t.Polygon.update=async(t,e)=>{let n=await interpretate(t[0],e);if(e.local.polygons)throw"update method for many polygons in not supported";e.xAxis,e.yAxis;return e.local.area.datum(n).maybeTransitionTween(e.transitionType,e.transitionDuration,"d",(function(t){var n=gt.select(this).attr("d"),o=e.local.line(t);return mt(n,o)}))},_t.Polygon.destroy=(t,e)=>{console.log("area destroyed"),delete e.local.area},_t.Polygon.virtual=!0,_t.IdentityFunction=async(t,e)=>await interpretate(t[0],e),_t.Tooltip=_t.IdentityFunction,_t.StatusArea=_t.IdentityFunction,_t["Charting`DelayedMouseEffect"]=_t.IdentityFunction,yt.Line=async(t,e)=>{console.log("drawing a line");let n=await interpretate(t[0],e);const o=e.xAxis,r=e.yAxis;if(n[0][0]){const t=e.svg.append("g");return t.attr("fill","none").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth),n.forEach((n=>{t.append("path").datum(n.map((t=>e.vertices[t-1]))).attr("vector-effect","non-scaling-stroke").attr("d",gt.line().x((function(t){return o(t[0])})).y((function(t){return r(t[1])})))})),t}return e.svg.append("path").datum(n.map((t=>e.vertices[t-1]))).attr("fill","none").attr("vector-effect","non-scaling-stroke").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",gt.line().x((function(t){return o(t[0])})).y((function(t){return r(t[1])})))},_t.BezierCurve=async(t,e)=>{let n=await interpretate(t[0],e);var o=gt.path();const r=e.xAxis,i=e.yAxis;n=n.map((t=>[r(t[0]),i(t[1])])),o.moveTo(...n[0]);for(let t=1;t<n.length-2;t+=3)o.bezierCurveTo(...n[t],...n[t+1],...n[t+2]);return e.svg.append("path").attr("fill","none").attr("vector-effect","non-scaling-stroke").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",o)},_t.Line=async(t,e)=>{let n=await interpretate(t[0],e);const o=e.xAxis,r=e.yAxis,i=uuidv4();let a;switch(e.local.uid=i,e.local.uid=i,ft(n)){case 0:a=e.svg.append("path").datum([]).attr("class","line-"+i).attr("fill","none").attr("vector-effect","non-scaling-stroke").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",gt.line().x((function(t){return o(t[0])})).y((function(t){return r(t[1])})));break;case 2:a=e.svg.append("path").datum(n).attr("class","line-"+i).attr("vector-effect","non-scaling-stroke").attr("fill","none").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",gt.line().x((function(t){return o(t[0])})).y((function(t){return r(t[1])})));break;case 3:console.log(n),n.forEach(((t,n)=>{a=e.svg.append("path").datum(t).join("path").attr("class","line-"+i+"-"+n).attr("vector-effect","non-scaling-stroke").attr("fill","none").attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",gt.line().x((function(t){return o(t[0])})).y((function(t){return r(t[1])})))}))}return e.local.nsets=n.length,e.local.line=gt.line().x((function(t){return e.xAxis(t[0])})).y((function(t){return e.yAxis(t[1])})),a},_t.Line.update=async(t,e)=>{let n=await interpretate(t[0],e);const o=e.xAxis,r=e.yAxis;let i;switch(ft(n)){case 0:i=e.svg.selectAll(".line-"+e.local.uid).datum([]).attr("class","line-"+e.local.uid).maybeTransitionTween(e.transitionType,e.transitionDuration,"d",(function(t){var n=gt.select(this).attr("d"),o=e.local.line(t);return mt(n,o)}));break;case 2:Math.min(n.length,e.local.nsets),i=e.svg.selectAll(".line-"+e.local.uid).datum(n).attr("class","line-"+e.local.uid).maybeTransitionTween(e.transitionType,e.transitionDuration,"d",(function(t){var n=gt.select(this).attr("d"),o=e.local.line(t);return mt(n,o)}));break;case 3:for(let t=0;t<Math.min(n.length,e.local.nsets);++t)console.log("upd 1"),i=e.svg.selectAll(".line-"+e.local.uid+"-"+t).datum(n[t]).attr("class","line-"+e.local.uid+"-"+t).maybeTransitionTween(e.transitionType,e.transitionDuration,"d",(function(t){var n=gt.select(this).attr("d"),o=e.local.line(t);return mt(n,o)}));if(n.length>e.local.nsets){console.log("upd 2"),console.log("new lines");for(let t=e.local.nsets;t<n.length;++t)i=e.svg.append("path").datum(n[t]).attr("class","line-"+e.local.uid+"-"+t).attr("fill","none").attr("stroke",e.color).attr("stroke-width",e.strokeWidth).maybeTransition(e.transitionType,e.transitionDuration).attr("d",gt.line().x((function(t){return o(t[0])})).y((function(t){return r(t[1])})))}if(n.length<e.local.nsets){console.log("upd 3");for(let t=n.length;t<e.local.nsets;++t)i=e.svg.selectAll(".line-"+e.local.uid+"-"+t).datum(n[0]).join("path").attr("class","line-"+e.local.uid+"-"+t).maybeTransition(e.transitionType,e.transitionDuration).attr("d",e.local.line)}}return e.local.nsets=Math.max(n.length,e.local.nsets),i},_t.Line.virtual=!0,_t.Line.destroy=(t,e)=>{console.log("nothing to destroy")},_t.Circle=async(t,e)=>{let n=await interpretate(t[0],e),o=1;t.length>1&&(o=await interpretate(t[1],e),Array.isArray(o)&&(o=(o[0]+o[1])/2));const r=e.xAxis,i=e.yAxis;return e.svg.append("circle").attr("vector-effect","non-scaling-stroke").attr("cx",r(n[0])).attr("cy",i(n[1])).attr("r",r(o)-r(0)).style("stroke",e.color).style("fill","none").style("opacity",e.opacity)},_t._arc=async(t,e)=>{let n=await interpretate(t[0],e),o=await interpretate(t[1],e);Array.isArray(o)&&(o=(o[0]+o[1])/2);let r=await interpretate(t[2],e);const i=e.xAxis,a=e.yAxis;e.local.coords=[i(n[0]),a(n[1])],e.local.r=i(o)-i(0);const s=gt.arc().outerRadius(0).innerRadius(e.local.r).startAngle(r[0]).endAngle(r[1]);e.local.arc=s,console.log({x:i(n[0]),xorg:n[0],r:e.local.r,rorg:o});return e.svg.append("path").attr("vector-effect","non-scaling-stroke").attr("transform",`translate(${i(n[0])},${a(n[1])})`).style("stroke","none").style("fill",e.color).style("opacity",e.opacity).attr("d",s)},yt.Disk=async(t,e)=>{if(t.length>2)throw"Graphics complex with arcs is not supported";let n=await interpretate(t[0],e),o=1;t.length>1&&(o=await interpretate(t[1],e),Array.isArray(o)&&(o=(o[0]+o[1])/2));const r=e.xAxis,i=e.yAxis;if(n[0]){const t=[],a=r(o)-r(0);return n.map((t=>e.vertices[t-1])).map((n=>{t.push(e.svg.append("circle").attr("vector-effect","non-scaling-stroke").attr("cx",r(n[0])).attr("cy",i(n[1])).attr("r",a).style("stroke","none").style("fill",e.color).style("opacity",e.opacity))})),t}{const t=e.vertices[n-1],a=[r(t[0]),i(t[1])],s=r(o)-r(0);return e.svg.append("circle").attr("vector-effect","non-scaling-stroke").attr("cx",a[0]).attr("cy",a[1]).attr("r",s).style("stroke","none").style("fill",e.color).style("opacity",e.opacity)}},_t.Disk=async(t,e)=>{if(t.length>2)return await _t._arc(t,e);let n=await interpretate(t[0],e),o=1;t.length>1&&(o=await interpretate(t[1],e),Array.isArray(o)&&(o=(o[0]+o[1])/2));const r=e.xAxis,i=e.yAxis;e.local.coords=[r(n[0]),i(n[1])],e.local.r=r(o)-r(0);const a=e.svg.append("circle").attr("vector-effect","non-scaling-stroke").attr("cx",r(n[0])).attr("cy",i(n[1])).attr("r",e.local.r).style("stroke","none").style("fill",e.color).style("opacity",e.opacity);return e.local.object=a,a},_t.Disk.update=async(t,e)=>{let n=await interpretate(t[0],e),o=1;t.length>1&&(o=await interpretate(t[1],e),Array.isArray(o)&&(o=(o[0]+o[1])/2));const r=e.xAxis,i=e.yAxis;e.local.coords=[r(n[0]),i(n[1])],e.local.r=r(o)-r(0),e.local.object.maybeTransition(e.transitionType,e.transitionDuration).attr("cx",e.local.coords[0]).attr("cy",e.local.coords[1]).attr("r",e.local.r)},_t.Disk.virtual=!0,_t.Disk.destroy=(t,e)=>{console.log("nothing to destroy")},yt.Point=async(t,e)=>{let n=await interpretate(t[0],e);const o=e.xAxis,r=e.yAxis;n[0][0]&&(n=n.flat()),n=n.map((t=>e.vertices[t-1]));const i=e.svg.append("g").style("stroke-width",100*e.pointSize*2).style("stroke-linecap","round").style("stroke",e.color).style("opacity",e.opacity),a=[];let s;return n.forEach(((t,n)=>{if(e.vertexColors){if(s=[0,0,0],"string"==typeof e.vertexColors[n]){const t=gt.color(e.vertexColors[n]);s[0]=s[0]+t.r/255,s[1]=s[1]+t.g/255,s[2]=s[2]+t.b/255}else s[0]=s[0]+e.vertexColors[n][0],s[1]=s[1]+e.vertexColors[n][1],s[2]=s[2]+e.vertexColors[n][2];s[0]=255*s[0],s[1]=255*s[1],s[2]=255*s[2],s="rgb("+s[0]+","+s[1]+","+s[2]+")",a.push(i.append("path").attr("stroke",s).attr("d",`M ${o(t[0])} ${r(t[1])} l 0.0001 0`).attr("vector-effect","non-scaling-stroke"))}else a.push(i.append("path").attr("d",`M ${o(t[0])} ${r(t[1])} l 0.0001 0`).attr("vector-effect","non-scaling-stroke"))})),i},_t.Point=async(t,e)=>{let n=await interpretate(t[0],e);const o=e.xAxis,r=e.yAxis,i=ft(n);0===i?n=[]:i<2&&(n=[n]);const a=uuidv4();e.local.uid=a;const s=e.svg.append("g").style("stroke-width",100*e.pointSize*2).style("stroke-linecap","round").style("stroke",e.color).style("opacity",e.opacity),l=[];return n.forEach(((t,e)=>{l.push(s.append("path").attr("d",`M ${o(t[0])} ${r(t[1])} l 0.0001 0`).attr("vector-effect","non-scaling-stroke"))})),e.local.points=l,e.local.object=s,s},_t.Point.update=async(t,e)=>{let n=await interpretate(t[0],e);const o=ft(n);0===o?n=[]:o<2&&(n=[n]);const r=e.xAxis,i=e.yAxis;let a;const s=e.local.object,l=Math.min(e.local.points.length,n.length);let c=[0,0];for(let t=e.local.points.length;t<n.length;t++)t-1>=0&&(c=n[t-1]),a=s.append("path").attr("d",`M ${r(c[0])} ${i(c[1])} l 0.0001 0`).style("opacity",e.opacity/5).attr("vector-effect","non-scaling-stroke"),e.local.points.push(a),a=a.maybeTransition(e.transitionType,e.transitionDuration).attr("d",`M ${r(n[t][0])} ${i(n[t][1])} l 0.0001 0`).style("opacity",e.opacity);for(let t=e.local.points.length;t>n.length;t--)a=e.local.points.pop(),a.maybeTransition(e.transitionType,e.transitionDuration).style("opacity",0).remove();for(let t=0;t<l;t++)a=e.local.points[t].maybeTransition(e.transitionType,e.transitionDuration).attr("d",`M ${r(n[t][0])} ${i(n[t][1])} l 0.0001 0`);return a},_t.Point.virtual=!0,_t.Point.destroy=(t,e)=>{console.log("nothing to destroy")},_t.EventListener=async(t,e)=>{const n=await interpretate(t[1],e);let o=await interpretate(t[0],e);return Array.isArray(o)&&(o=o[0]),n.forEach((t=>{_t.EventListener[t.lhs](t.rhs,o,e)})),null},_t.EventListener.update=async(t,e)=>{console.log("EventListener does not support updates")},_t.EventListener.onload=(t,e,n)=>{console.log("onload event generator"),server.kernel.emitt(t,"True","onload")},_t.MiddlewareListener=async(t,e)=>{const n=await core._getRules(t,e),o=await interpretate(t[1],e),r=await interpretate(t[2],e);return console.log(t),e.local.middleware=_t.MiddlewareListener[o](r,n,e),await interpretate(t[0],e)},_t.MiddlewareListener.update=(t,e)=>interpretate(t[0],e),_t.MiddlewareListener.end=(t,e,n)=>{const o=e.Threshold||1;return server.kernel.emitt(t,"True","end"),console.log("pre Fire"),e=>{let n=!1;return e.then((e=>e.tween(t,(function(e){return function(e){e>=o&&!n&&(server.kernel.emitt(t,"True","end"),n=!0)}}))))}},_t.MiddlewareListener.endtransition=_t.MiddlewareListener.end,_t.EventListener.drag=(t,e,n)=>{console.log("drag event generator"),console.log(n.local);const o=n.xAxis,r=n.yAxis;let i=[];const a=throttle(((e,n)=>{server.kernel.emitt(t,`{${e}, ${n}}`.replace("e","*^").replace("e","*^"),"drag")}));e.call(gt.drag().on("start",(function(t,e){0===i.length&&(i=[t.x,t.y])})).on("drag",(function(t,e){gt.select(this).raise().attr("transform",(e=>"translate("+[t.x-i[0],t.y-i[1]]+")")),a(o.invert(t.x),r.invert(t.y))})).on("end",(function(t,e){})))},_t.EventListener.dragall=(t,e,n)=>{console.log("drag event generator"),console.log(n.local);const o=n.xAxis,r=n.yAxis;const i=throttle(((e,n,o)=>{server.kernel.emitt(t,`{"${o}", {${e}, ${n}}}`.replace("e","*^").replace("e","*^"),"dragall")}));e.call(gt.drag().on("start",(function(t,e){i(o.invert(t.x),r.invert(t.y),"dragstarted")})).on("drag",(function(t,e){i(o.invert(t.x),r.invert(t.y),"dragged")})).on("end",(function(t,e){i(o.invert(t.x),r.invert(t.y),"dragended")})))},_t.EventListener.click=(t,e,n)=>{console.log("click event generator"),console.log(n.local);const o=n.xAxis,r=n.yAxis,i=throttle(((e,n)=>{server.kernel.emitt(t,`{${e}, ${n}}`.replace("e","*^").replace("e","*^"),"click")}));e.call(gt.drag().on("start",(function(t,e){i(o.invert(t.x),r.invert(t.y))})))},_t.EventListener.mousemove=(t,e,n)=>{console.log("mouse event generator"),console.log(n.local);const o=n.xAxis,r=n.yAxis,i=throttle(((e,n)=>{server.kernel.emitt(t,`{${e}, ${n}}`.replace("e","*^").replace("e","*^"),"mousemove")}));e.on("mousemove",(t=>{return e=gt.pointer(t),void i(o.invert(e[0]),r.invert(e[1]));var e}))},_t.EventListener.mouseover=(t,e,n)=>{console.log("mouse event generator"),console.log(n.local);const o=n.xAxis,r=n.yAxis,i=throttle(((e,n)=>{server.kernel.emitt(t,`{${e}, ${n}}`.replace("e","*^").replace("e","*^"),"mouseover")}));e.on("mouseover",(t=>{return e=gt.pointer(t),void i(o.invert(e[0]),r.invert(e[1]));var e}))},_t.EventListener.zoom=(t,e,n)=>{console.log("zoom event generator"),console.log(n.local);const o=throttle((e=>{server.kernel.emitt(t,`${e}`,"zoom")}));e.call(gt.zoom().on("zoom",(function(t){console.log(),o(t.transform.k)})))},_t.Rotate=async(t,e)=>{const n=await interpretate(t[1],e);t.length>2&&await interpretate(t[2],e);const o=e.svg.append("g");e.local.group=o,await interpretate(t[0],{...e,svg:o});const r=o.node().getBBox(),i="rotate("+n/Math.PI*180+", "+(r.x+r.width/2)+", "+(r.y+r.height/2)+")";o.attr("transform",i),e.local.rotation=i},_t.Rotate.update=async(t,e)=>{const n=await interpretate(t[1],e),o=e.local.group.node().getBBox(),r="rotate("+n/Math.PI*180+", "+(o.x+o.width/2)+", "+(o.y+o.height/2)+")";var i=gt.interpolateString(e.local.rotation,r);e.local.group.maybeTransitionTween(e.transitionType,e.transitionDuration,"transform",(function(t,e,n){return i})),e.local.rotation=r},_t.Rotate.virtual=!0,_t.Rotate.destroy=(t,e)=>{console.log("nothing to destroy")},_t.Translate=async(t,e)=>{const n=await interpretate(t[1],e),o=e.svg.append("g");e.local.group=o;const r=e.xAxis,i=e.yAxis;return await interpretate(t[0],{...e,svg:o}),o.attr("transform",`translate(${r(n[0])-r(0)}, ${i(n[1])-i(0)})`)},_t.Translate.update=async(t,e)=>{const n=await interpretate(t[1],e),o=e.xAxis,r=e.yAxis;return e.local.group.maybeTransition(e.transitionType,e.transitionDuration).attr("transform",`translate(${o(n[0])-o(0)}, ${r(n[1])-r(0)})`)},_t.Translate.virtual=!0,_t.Translate.destroy=(t,e)=>{console.log("nothing to destroy")},_t.Center=()=>"Center",_t.Center.update=_t.Center,_t.Degree=()=>Math.PI/180,_t.Degree.update=_t.Degree,_t.Rectangle=async(t,e)=>{const n=await interpretate(t[0],e),o=await interpretate(t[1],e);if(n[1]>o[1]){const t=n[1];n[1]=o[1],o[1]=t}if(n[0]>o[0]){const t=n[0];n[0]=o[0],o[0]=t}const r=e.xAxis,i=e.yAxis;n[0]=r(n[0]),n[1]=i(n[1]),o[0]=r(o[0]),o[1]=i(o[1]);const a=[Math.abs(o[0]-n[0]),Math.abs(o[1]-n[1])];return e.local.rect=e.svg.append("rect").attr("x",n[0]).attr("y",n[1]-a[1]).attr("width",a[0]).attr("height",a[1]).attr("vector-effect","non-scaling-stroke").attr("stroke",e.stroke).attr("opacity",e.opacity).attr("fill",e.color),e.local.rect},_t.Rectangle.update=async(t,e)=>{const n=await interpretate(t[0],e),o=await interpretate(t[1],e);if(n[1]>o[1]){const t=n[1];n[1]=o[1],o[1]=t}if(n[0]>o[0]){const t=n[0];n[0]=o[0],o[0]=t}const r=e.xAxis,i=e.yAxis;n[0]=r(n[0]),n[1]=i(n[1]),o[0]=r(o[0]),o[1]=i(o[1]);const a=[Math.abs(o[0]-n[0]),Math.abs(o[1]-n[1])];e.local.rect.maybeTransition(e.transitionType,e.transitionDuration).attr("x",n[0]).attr("y",n[1]-a[1]).attr("width",a[0]).attr("height",a[1])},_t.Rectangle.virtual=!0,_t.Rectangle.destroy=(t,e)=>{console.log("nothing to destroy")},_t.Void=(t,e)=>{},_t.Identity=_t.Void,_t.Scaled=_t.Void,_t.GoldenRatio=_t.Void,_t.None=()=>!1,_t.AbsolutePointSize=_t.Void,_t.CopiedValueFunction=_t.Void,_t.Raster=async(t,e)=>{if(e.image)return await interpretate(t[0],e);const n=await interpretate(t[0],{...e,context:_t,nfast:!0,numeric:!0});console.log(t);const o=n.length,r=n[0].length,i=n[0][0].length,a=e.xAxis,s=e.yAxis;let l=[[0,r],[0,o]];if(t.length>1){const n=await interpretate(t[1],e);l[0][0]=n[0][0],l[0][1]=n[1][0],l[1][0]=n[0][1],l[1][1]=n[1][1]}t.length>2&&(await interpretate(t[2],e),console.warn("scaling is not implemented!"));const c=Math.abs((a(l[0][1])-a(l[0][0]))/r),d=Math.abs((s(l[1][1])-s(l[1][0]))/o),u=(l[0][1]-l[0][0])/r,p=(l[1][1]-l[1][0])/o,h=e.svg;if(i)if(2!==i)if(3!==i)if(4!==i);else for(let t=0;t<o;++t)for(let e=0;e<r;++e)h.append("rect").attr("x",a(u*e+l[0][0])).attr("y",s(p*t+l[1][0])-d).attr("width",c).attr("height",d).attr("opacity",n[t][e][3]).attr("fill",`rgb(${Math.floor(255*n[t][e][0])}, ${Math.floor(255*n[t][e][1])}, ${Math.floor(255*n[t][e][2])})`);else for(let t=0;t<o;++t)for(let o=0;o<r;++o)h.append("rect").attr("x",a(u*o+l[0][0])).attr("y",s(p*t+l[1][0])-d).attr("width",c).attr("height",d).attr("opacity",e.opacity).attr("fill",`rgb(${Math.floor(255*n[t][o][0])}, ${Math.floor(255*n[t][o][1])}, ${Math.floor(255*n[t][o][2])})`);else for(let t=0;t<o;++t)for(let e=0;e<r;++e)h.append("rect").attr("x",a(u*e+l[0][0])).attr("y",s(p*t+l[1][0])-d).attr("width",c).attr("height",d).attr("opacity",n[t][e][1]).attr("fill",`rgb(${Math.floor(255*n[t][e][0])}, ${Math.floor(255*n[t][e][0])}, ${Math.floor(255*n[t][e][0])})`);else for(let t=0;t<o;++t)for(let o=0;o<r;++o)h.append("rect").attr("x",a(u*o+l[0][0])).attr("y",s(p*t+l[1][0])-d).attr("width",c).attr("height",d).attr("opacity",e.opacity).attr("fill",`rgb(${Math.floor(255*n[t][o])}, ${Math.floor(255*n[t][o])}, ${Math.floor(255*n[t][o])})`)},_t.Magnification=()=>"Magnification",_t.ColorSpace=()=>"ColorSpace",_t.Interleaving=()=>"Interleaving",_t.MetaInformation=()=>"MetaInformation",_t.ImageResolution=()=>"ImageResolution",_t.DateObject=()=>{console.warn("Date Object is not supported for now")},_t.Image=async(t,e)=>{const n=await core._getRules(t,{...e,context:_t}),o=performance.now(),r=await interpretate(t[0],{...e,context:_t,nfast:!0,numeric:!0,image:!0}),i=r.length,a=r[0].length;console.log(a),console.log(i);let s=n.ImageSize;n.Magnification&&(s=Math.floor(a*n.Magnification)),s||(s=e.imageSize?e.imageSize:a),Array.isArray(s)&&(s=s[0]);const l=Math.floor(s),c=Math.floor(i/a*s),d=a/l;console.log(d);const u=r[0][0].length;let p;if(e.inset){p=e.inset.append("foreignObject").attr("width",l).attr("height",c).append("xhtml:canvas").attr("xmlns","http://www.w3.org/1999/xhtml").node().getContext("2d")}else{const t=document.createElement("canvas");t.width=l,t.height=c,e.element.appendChild(t),p=t.getContext("2d")}e.local.ctx=p,e.local.length=a*i*4,e.local.width=a,e.local.height=i,e.local.target_width=l,e.local.target_height=c,e.local.scalingFactor=d,e.local.rgb=u;const h=new Uint8ClampedArray(l*c*4);let f,g,m=0;if(u){if(3===u)for(let t=0;t<c;++t)for(let e=0;e<l;++e)f=Math.floor(t*d),g=Math.floor(e*d),h[m+0]=r[f][g][0],h[m+1]=r[f][g][1],h[m+2]=r[f][g][2],h[m+3]=255,m+=4;if(4===u)for(let t=0;t<c;++t)for(let e=0;e<l;++e)f=Math.floor(t*d),g=Math.floor(e*d),h[m+0]=r[f][g][0],h[m+1]=r[f][g][1],h[m+2]=r[f][g][2],h[m+3]=255,m+=4;p.putImageData(new ImageData(h,l,c),0,0),console.warn(performance.now()-o+" passed")}else{for(let t=0;t<c;++t)for(let e=0;e<l;++e)f=Math.floor(t*d),g=Math.floor(e*d),h[m+0]=255*r[f][g],h[m+1]=255*r[f][g],h[m+2]=255*r[f][g],h[m+3]=255,m+=4;p.putImageData(new ImageData(h,a,i),0,0)}},_t.Image.update=async(t,e)=>{const n=await interpretate(t[0],{...e,nfast:!0,numeric:!0,image:!0});n.length,n[0].length;const o=n[0][0].length,r=e.local.ctx,i=e.local.target_width,a=e.local.target_height,s=e.local.scalingFactor,l=new Uint8ClampedArray(i*a*4);let c,d,u=0;if(o){if(3===o)for(let t=0;t<a;++t)for(let e=0;e<i;++e)c=Math.floor(t*s),d=Math.floor(e*s),l[u+0]=n[c][d][0],l[u+1]=n[c][d][1],l[u+2]=n[c][d][2],l[u+3]=255,u+=4;if(4===o)for(let t=0;t<a;++t)for(let e=0;e<i;++e)c=Math.floor(t*s),d=Math.floor(e*s),l[u+0]=n[c][d][0],l[u+1]=n[c][d][1],l[u+2]=n[c][d][2],l[u+3]=255,u+=4;r.putImageData(new ImageData(l,i,a),0,0)}else{for(let t=0;t<a;++t)for(let e=0;e<i;++e)c=Math.floor(t*s),d=Math.floor(e*s),l[u+0]=255*n[c][d],l[u+1]=255*n[c][d],l[u+2]=255*n[c][d],l[u+3]=255,u+=4;r.putImageData(new ImageData(l,i,a),0,0)}},_t.Image.destroy=(t,e)=>{},_t.GraphicsGroupBox=_t.GraphicsGroup,_t.GraphicsComplexBox=_t.GraphicsComplex,_t.DiskBox=_t.Disk,_t.LineBox=_t.Line;
