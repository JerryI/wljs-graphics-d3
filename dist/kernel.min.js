function t(t,e){var o=t.__state.conversionName.toString(),r=Math.round(t.r),n=Math.round(t.g),a=Math.round(t.b),i=t.a,s=Math.round(t.h),l=t.s.toFixed(1),c=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===o||"SIX_CHAR_HEX"===o){for(var d=t.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}return"CSS_RGB"===o?"rgb("+r+","+n+","+a+")":"CSS_RGBA"===o?"rgba("+r+","+n+","+a+","+i+")":"HEX"===o?"0x"+t.hex.toString(16):"RGB_ARRAY"===o?"["+r+","+n+","+a+"]":"RGBA_ARRAY"===o?"["+r+","+n+","+a+","+i+"]":"RGB_OBJ"===o?"{r:"+r+",g:"+n+",b:"+a+"}":"RGBA_OBJ"===o?"{r:"+r+",g:"+n+",b:"+a+",a:"+i+"}":"HSV_OBJ"===o?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===o?"{h:"+s+",s:"+l+",v:"+c+",a:"+i+"}":"unknown format"}var e=Array.prototype.forEach,o=Array.prototype.slice,r={BREAK:{},extend:function(t){return this.each(o.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(o){this.isUndefined(e[o])||(t[o]=e[o])}.bind(this))}),this),t},defaults:function(t){return this.each(o.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(o){this.isUndefined(t[o])&&(t[o]=e[o])}.bind(this))}),this),t},compose:function(){var t=o.call(arguments);return function(){for(var e=o.call(arguments),r=t.length-1;r>=0;r--)e=[t[r].apply(this,e)];return e[0]}},each:function(t,o,r){if(t)if(e&&t.forEach&&t.forEach===e)t.forEach(o,r);else if(t.length===t.length+0){var n,a=void 0;for(a=0,n=t.length;a<n;a++)if(a in t&&o.call(r,t[a],a)===this.BREAK)return}else for(var i in t)if(o.call(r,t[i],i)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,o){var r=void 0;return function(){var n=this,a=arguments;var i=o||!r;clearTimeout(r),r=setTimeout((function(){r=null,o||t.apply(n,a)}),e),i&&t.apply(n,a)}},toArray:function(t){return t.toArray?t.toArray():o.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},n=[{litmus:r.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:t},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:t},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:t},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:t}}},{litmus:r.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:r.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:r.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(r.isNumber(t.r)&&r.isNumber(t.g)&&r.isNumber(t.b)&&r.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(r.isNumber(t.r)&&r.isNumber(t.g)&&r.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(r.isNumber(t.h)&&r.isNumber(t.s)&&r.isNumber(t.v)&&r.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(r.isNumber(t.h)&&r.isNumber(t.s)&&r.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],a=void 0,i=void 0,s=function(){i=!1;var t=arguments.length>1?r.toArray(arguments):arguments[0];return r.each(n,(function(e){if(e.litmus(t))return r.each(e.conversions,(function(e,o){if(a=e.read(t),!1===i&&!1!==a)return i=a,a.conversionName=o,a.conversion=e,r.BREAK})),r.BREAK})),i},l=void 0,c={hsv_to_rgb:function(t,e,o){var r=Math.floor(t/60)%6,n=t/60-Math.floor(t/60),a=o*(1-e),i=o*(1-n*e),s=o*(1-(1-n)*e),l=[[o,s,a],[i,o,a],[a,o,s],[a,i,o],[s,a,o],[o,a,i]][r];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,o){var r=Math.min(t,e,o),n=Math.max(t,e,o),a=n-r,i=void 0;return 0===n?{h:NaN,s:0,v:0}:(i=t===n?(e-o)/a:e===n?2+(o-t)/a:4+(t-e)/a,(i/=6)<0&&(i+=1),{h:360*i,s:a/n,v:n/255})},rgb_to_hex:function(t,e,o){var r=this.hex_with_component(0,2,t);return r=this.hex_with_component(r,1,e),r=this.hex_with_component(r,0,o)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,o){return o<<(l=8*e)|t&~(255<<l)}},d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},p=function(){function t(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,o,r){return o&&t(e.prototype,o),r&&t(e,r),e}}(),f=function t(e,o,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,o);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,o,r)}if("value"in n)return n.value;var i=n.get;return void 0!==i?i.call(r):void 0},h=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},m=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},g=function(){function e(){if(u(this,e),this.__state=s.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return p(e,[{key:"toString",value:function(){return t(this)}},{key:"toHexString",value:function(){return t(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function y(t,e,o){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||g.recalculateRGB(this,e,o),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(g.recalculateRGB(this,e,o),this.__state.space="RGB"),this.__state[e]=t}})}function _(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||g.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(g.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}g.recalculateRGB=function(t,e,o){if("HEX"===t.__state.space)t.__state[e]=c.component_from_hex(t.__state.hex,o);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");r.extend(t.__state,c.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},g.recalculateHSV=function(t){var e=c.rgb_to_hsv(t.r,t.g,t.b);r.extend(t.__state,{s:e.s,v:e.v}),r.isNaN(e.h)?r.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},g.COMPONENTS=["r","g","b","h","s","v","hex","a"],y(g.prototype,"r",2),y(g.prototype,"g",1),y(g.prototype,"b",0),_(g.prototype,"h"),_(g.prototype,"s"),_(g.prototype,"v"),Object.defineProperty(g.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(g.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=c.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var b=function(){function t(e,o){u(this,t),this.initialValue=e[o],this.domElement=document.createElement("div"),this.object=e,this.property=o,this.__onChange=void 0,this.__onFinishChange=void 0}return p(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),v={};r.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){r.each(t,(function(t){v[t]=e}))}));var x=/(\d+(\.\d+)?)px/;function w(t){if("0"===t||r.isUndefined(t))return 0;var e=t.match(x);return r.isNull(e)?0:parseFloat(e[1])}var A={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,o){var n=o,a=e;r.isUndefined(a)&&(a=!0),r.isUndefined(n)&&(n=!0),t.style.position="absolute",a&&(t.style.left=0,t.style.right=0),n&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,o,n){var a=o||{},i=v[e];if(!i)throw new Error("Event type "+e+" not supported.");var s=document.createEvent(i);switch(i){case"MouseEvents":var l=a.x||a.clientX||0,c=a.y||a.clientY||0;s.initMouseEvent(e,a.bubbles||!1,a.cancelable||!0,window,a.clickCount||1,0,0,l,c,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var d=s.initKeyboardEvent||s.initKeyEvent;r.defaults(a,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),d(e,a.bubbles||!1,a.cancelable,window,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.keyCode,a.charCode);break;default:s.initEvent(e,a.bubbles||!1,a.cancelable||!0)}r.defaults(s,n),t.dispatchEvent(s)},bind:function(t,e,o,r){var n=r||!1;return t.addEventListener?t.addEventListener(e,o,n):t.attachEvent&&t.attachEvent("on"+e,o),A},unbind:function(t,e,o,r){var n=r||!1;return t.removeEventListener?t.removeEventListener(e,o,n):t.detachEvent&&t.detachEvent("on"+e,o),A},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var o=t.className.split(/ +/);-1===o.indexOf(e)&&(o.push(e),t.className=o.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return A},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var o=t.className.split(/ +/),r=o.indexOf(e);-1!==r&&(o.splice(r,1),t.className=o.join(" "))}else t.className=void 0;return A},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return w(e["border-left-width"])+w(e["border-right-width"])+w(e["padding-left"])+w(e["padding-right"])+w(e.width)},getHeight:function(t){var e=getComputedStyle(t);return w(e["border-top-width"])+w(e["border-bottom-width"])+w(e["padding-top"])+w(e["padding-bottom"])+w(e.height)},getOffset:function(t){var e=t,o={left:0,top:0};if(e.offsetParent)do{o.left+=e.offsetLeft,o.top+=e.offsetTop,e=e.offsetParent}while(e);return o},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},k=function(){function t(e,o){u(this,t);var r=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),n=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),A.bind(r.__checkbox,"change",(function(){n.setValue(!n.__prev)}),!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return h(t,b),p(t,[{key:"setValue",value:function(e){var o=f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),o}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),T=function(){function t(e,o,n){u(this,t);var a=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),i=n,s=a;if(a.__select=document.createElement("select"),r.isArray(i)){var l={};r.each(i,(function(t){l[t]=t})),i=l}return r.each(i,(function(t,e){var o=document.createElement("option");o.innerHTML=e,o.setAttribute("value",t),s.__select.appendChild(o)})),a.updateDisplay(),A.bind(a.__select,"change",(function(){var t=this.options[this.selectedIndex].value;s.setValue(t)})),a.domElement.appendChild(a.__select),a}return h(t,b),p(t,[{key:"setValue",value:function(e){var o=f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),o}},{key:"updateDisplay",value:function(){return A.isActive(this.__select)?this:(this.__select.value=this.getValue(),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(),C=function(){function t(e,o){u(this,t);var r=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),n=r;function a(){n.setValue(n.__input.value)}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),A.bind(r.__input,"keyup",a),A.bind(r.__input,"change",a),A.bind(r.__input,"blur",(function(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())})),A.bind(r.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return h(t,b),p(t,[{key:"updateDisplay",value:function(){return A.isActive(this.__input)||(this.__input.value=this.getValue()),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function E(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var S=function(){function t(e,o,n){u(this,t);var a=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),i=n||{};return a.__min=i.min,a.__max=i.max,a.__step=i.step,r.isUndefined(a.__step)?0===a.initialValue?a.__impliedStep=1:a.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(a.initialValue))/Math.LN10))/10:a.__impliedStep=a.__step,a.__precision=E(a.__impliedStep),a}return h(t,b),p(t,[{key:"setValue",value:function(e){var o=e;return void 0!==this.__min&&o<this.__min?o=this.__min:void 0!==this.__max&&o>this.__max&&(o=this.__max),void 0!==this.__step&&o%this.__step!=0&&(o=Math.round(o/this.__step)*this.__step),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,o)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=E(t),this}}]),t}();var O=function(){function t(e,o,n){u(this,t);var a=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o,n));a.__truncationSuspended=!1;var i=a,s=void 0;function l(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}function c(t){var e=s-t.clientY;i.setValue(i.getValue()+e*i.__impliedStep),s=t.clientY}function d(){A.unbind(window,"mousemove",c),A.unbind(window,"mouseup",d),l()}return a.__input=document.createElement("input"),a.__input.setAttribute("type","text"),A.bind(a.__input,"change",(function(){var t=parseFloat(i.__input.value);r.isNaN(t)||i.setValue(t)})),A.bind(a.__input,"blur",(function(){l()})),A.bind(a.__input,"mousedown",(function(t){A.bind(window,"mousemove",c),A.bind(window,"mouseup",d),s=t.clientY})),A.bind(a.__input,"keydown",(function(t){13===t.keyCode&&(i.__truncationSuspended=!0,this.blur(),i.__truncationSuspended=!1,l())})),a.updateDisplay(),a.domElement.appendChild(a.__input),a}return h(t,S),p(t,[{key:"updateDisplay",value:function(){var e,o,r;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),o=this.__precision,r=Math.pow(10,o),Math.round(e*r)/r),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function R(t,e,o,r,n){return r+(t-e)/(o-e)*(n-r)}var L=function(){function t(e,o,r,n,a){u(this,t);var i=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o,{min:r,max:n,step:a})),s=i;function l(t){t.preventDefault();var e=s.__background.getBoundingClientRect();return s.setValue(R(t.clientX,e.left,e.right,s.__min,s.__max)),!1}function c(){A.unbind(window,"mousemove",l),A.unbind(window,"mouseup",c),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function d(t){var e=t.touches[0].clientX,o=s.__background.getBoundingClientRect();s.setValue(R(e,o.left,o.right,s.__min,s.__max))}function p(){A.unbind(window,"touchmove",d),A.unbind(window,"touchend",p),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return i.__background=document.createElement("div"),i.__foreground=document.createElement("div"),A.bind(i.__background,"mousedown",(function(t){document.activeElement.blur(),A.bind(window,"mousemove",l),A.bind(window,"mouseup",c),l(t)})),A.bind(i.__background,"touchstart",(function(t){if(1!==t.touches.length)return;A.bind(window,"touchmove",d),A.bind(window,"touchend",p),d(t)})),A.addClass(i.__background,"slider"),A.addClass(i.__foreground,"slider-fg"),i.updateDisplay(),i.__background.appendChild(i.__foreground),i.domElement.appendChild(i.__background),i}return h(t,S),p(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),F=function(){function t(e,o,r){u(this,t);var n=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),a=n;return n.__button=document.createElement("div"),n.__button.innerHTML=void 0===r?"Fire":r,A.bind(n.__button,"click",(function(t){return t.preventDefault(),a.fire(),!1})),A.addClass(n.__button,"button"),n.domElement.appendChild(n.__button),n}return h(t,b),p(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(),I=function(){function t(e,o){u(this,t);var n=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o));n.__color=new g(n.getValue()),n.__temp=new g(0);var a=n;n.domElement=document.createElement("div"),A.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",A.bind(n.__input,"keydown",(function(t){13===t.keyCode&&h.call(this)})),A.bind(n.__input,"blur",h),A.bind(n.__selector,"mousedown",(function(){A.addClass(this,"drag").bind(window,"mouseup",(function(){A.removeClass(a.__selector,"drag")}))})),A.bind(n.__selector,"touchstart",(function(){A.addClass(this,"drag").bind(window,"touchend",(function(){A.removeClass(a.__selector,"drag")}))}));var i,l=document.createElement("div");function c(t){_(t),A.bind(window,"mousemove",_),A.bind(window,"touchmove",_),A.bind(window,"mouseup",p),A.bind(window,"touchend",p)}function d(t){b(t),A.bind(window,"mousemove",b),A.bind(window,"touchmove",b),A.bind(window,"mouseup",f),A.bind(window,"touchend",f)}function p(){A.unbind(window,"mousemove",_),A.unbind(window,"touchmove",_),A.unbind(window,"mouseup",p),A.unbind(window,"touchend",p),y()}function f(){A.unbind(window,"mousemove",b),A.unbind(window,"touchmove",b),A.unbind(window,"mouseup",f),A.unbind(window,"touchend",f),y()}function h(){var t=s(this.value);!1!==t?(a.__color.__state=t,a.setValue(a.__color.toOriginal())):this.value=a.__color.toString()}function y(){a.__onFinishChange&&a.__onFinishChange.call(a,a.__color.toOriginal())}function _(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=a.__saturation_field.getBoundingClientRect(),o=t.touches&&t.touches[0]||t,r=o.clientX,n=o.clientY,i=(r-e.left)/(e.right-e.left),s=1-(n-e.top)/(e.bottom-e.top);return s>1?s=1:s<0&&(s=0),i>1?i=1:i<0&&(i=0),a.__color.v=s,a.__color.s=i,a.setValue(a.__color.toOriginal()),!1}function b(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=a.__hue_field.getBoundingClientRect(),o=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return o>1?o=1:o<0&&(o=0),a.__color.h=360*o,a.setValue(a.__color.toOriginal()),!1}return r.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),r.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),r.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),r.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),r.extend(l.style,{width:"100%",height:"100%",background:"none"}),z(l,"top","rgba(0,0,0,0)","#000"),r.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(i=n.__hue_field).style.background="",i.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",i.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),A.bind(n.__saturation_field,"mousedown",c),A.bind(n.__saturation_field,"touchstart",c),A.bind(n.__field_knob,"mousedown",c),A.bind(n.__field_knob,"touchstart",c),A.bind(n.__hue_field,"mousedown",d),A.bind(n.__hue_field,"touchstart",d),n.__saturation_field.appendChild(l),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}return h(t,b),p(t,[{key:"updateDisplay",value:function(){var t=s(this.getValue());if(!1!==t){var e=!1;r.each(g.COMPONENTS,(function(o){if(!r.isUndefined(t[o])&&!r.isUndefined(this.__color.__state[o])&&t[o]!==this.__color.__state[o])return e=!0,{}}),this),e&&r.extend(this.__color.__state,t)}r.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var o=this.__color.v<.5||this.__color.s>.5?255:0,n=255-o;r.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+o+","+o+","+o+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,z(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),r.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+o+","+o+","+o+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),t}(),D=["-moz-","-o-","-webkit-","-ms-",""];function z(t,e,o,n){t.style.background="",r.each(D,(function(r){t.style.cssText+="background: "+r+"linear-gradient("+e+", "+o+" 0%, "+n+" 100%); "}))}var M=function(t,e){var o=e||document,r=document.createElement("style");r.type="text/css",r.innerHTML=t;var n=o.getElementsByTagName("head")[0];try{n.appendChild(r)}catch(t){}},P=function(t,e){var o=t[e];return r.isArray(arguments[2])||r.isObject(arguments[2])?new T(t,e,arguments[2]):r.isNumber(o)?r.isNumber(arguments[2])&&r.isNumber(arguments[3])?r.isNumber(arguments[4])?new L(t,e,arguments[2],arguments[3],arguments[4]):new L(t,e,arguments[2],arguments[3]):r.isNumber(arguments[4])?new O(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new O(t,e,{min:arguments[2],max:arguments[3]}):r.isString(o)?new C(t,e):r.isFunction(o)?new F(t,e,""):r.isBoolean(o)?new k(t,e):null};var j=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},N=function(){function t(){u(this,t),this.backgroundElement=document.createElement("div"),r.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),A.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),r.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;A.bind(this.backgroundElement,"click",(function(){e.hide()}))}return p(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),r.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",A.unbind(t.domElement,"webkitTransitionEnd",e),A.unbind(t.domElement,"transitionend",e),A.unbind(t.domElement,"oTransitionEnd",e)};A.bind(this.domElement,"webkitTransitionEnd",e),A.bind(this.domElement,"transitionend",e),A.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-A.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-A.getHeight(this.domElement)/2+"px"}}]),t}(),B=function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");M(B);var V="Default",H=function(){try{return!!window.localStorage}catch(t){return!1}}(),G=void 0,U=!0,$=void 0,W=!1,X=[],Y=function t(e){var o=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),A.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=r.defaults(n,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),n=r.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),r.isUndefined(n.load)?n.load={preset:V}:n.preset&&(n.load.preset=n.preset),r.isUndefined(n.parent)&&n.hideable&&X.push(this),n.resizable=r.isUndefined(n.parent)&&n.resizable,n.autoPlace&&r.isUndefined(n.scrollable)&&(n.scrollable=!0);var a,i=H&&"true"===localStorage.getItem(tt(this,"isLocal")),s=void 0,l=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return o.parent?o.getRoot().preset:n.load.preset},set:function(t){o.parent?o.getRoot().preset=t:n.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),o.revert()}},width:{get:function(){return n.width},set:function(t){n.width=t,nt(o,t)}},name:{get:function(){return n.name},set:function(t){n.name=t,l&&(l.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(e){n.closed=e,n.closed?A.addClass(o.__ul,t.CLASS_CLOSED):A.removeClass(o.__ul,t.CLASS_CLOSED),this.onResize(),o.__closeButton&&(o.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return i},set:function(t){H&&(i=t,t?A.bind(window,"unload",s):A.unbind(window,"unload",s),localStorage.setItem(tt(o,"isLocal"),t))}}}),r.isUndefined(n.parent)){if(this.closed=n.closed||!1,A.addClass(this.domElement,t.CLASS_MAIN),A.makeSelectable(this.domElement,!1),H&&i){o.useLocalStorage=!0;var c=localStorage.getItem(tt(this,"gui"));c&&(n.load=JSON.parse(c))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,A.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),n.closeOnTop?(A.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(A.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),A.bind(this.__closeButton,"click",(function(){o.closed=!o.closed}))}else{void 0===n.closed&&(n.closed=!0);var d=document.createTextNode(n.name);A.addClass(d,"controller-name"),l=K(o,d);A.addClass(this.__ul,t.CLASS_CLOSED),A.addClass(l,"title"),A.bind(l,"click",(function(t){return t.preventDefault(),o.closed=!o.closed,!1})),n.closed||(this.closed=!1)}n.autoPlace&&(r.isUndefined(n.parent)&&(U&&($=document.createElement("div"),A.addClass($,"dg"),A.addClass($,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild($),U=!1),$.appendChild(this.domElement),A.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||nt(o,n.width)),this.__resizeHandler=function(){o.onResizeDebounced()},A.bind(window,"resize",this.__resizeHandler),A.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),A.bind(this.__ul,"transitionend",this.__resizeHandler),A.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&rt(this),s=function(){H&&"true"===localStorage.getItem(tt(o,"isLocal"))&&localStorage.setItem(tt(o,"gui"),JSON.stringify(o.getSaveObject()))},this.saveToLocalStorageIfPossible=s,n.parent||((a=o.getRoot()).width+=1,r.defer((function(){a.width-=1})))};function K(t,e,o){var r=document.createElement("li");return e&&r.appendChild(e),o?t.__ul.insertBefore(r,o):t.__ul.appendChild(r),t.onResize(),r}function J(t){A.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&A.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function Q(t,e){var o=t.__preset_select[t.__preset_select.selectedIndex];o.innerHTML=e?o.value+"*":o.value}function Z(t,e){var o=t.getRoot(),r=o.__rememberedObjects.indexOf(e.object);if(-1!==r){var n=o.__rememberedObjectIndecesToControllers[r];if(void 0===n&&(n={},o.__rememberedObjectIndecesToControllers[r]=n),n[e.property]=e,o.load&&o.load.remembered){var a=o.load.remembered,i=void 0;if(a[t.preset])i=a[t.preset];else{if(!a[V])return;i=a[V]}if(i[r]&&void 0!==i[r][e.property]){var s=i[r][e.property];e.initialValue=s,e.setValue(s)}}}}function q(t,e,o,n){if(void 0===e[o])throw new Error('Object "'+e+'" has no property "'+o+'"');var a=void 0;if(n.color)a=new I(e,o);else{var i=[e,o].concat(n.factoryArgs);a=P.apply(t,i)}n.before instanceof b&&(n.before=n.before.__li),Z(t,a),A.addClass(a.domElement,"c");var s=document.createElement("span");A.addClass(s,"property-name"),s.innerHTML=a.property;var l=document.createElement("div");l.appendChild(s),l.appendChild(a.domElement);var c=K(t,l,n.before);return A.addClass(c,Y.CLASS_CONTROLLER_ROW),a instanceof I?A.addClass(c,"color"):A.addClass(c,d(a.getValue())),function(t,e,o){if(o.__li=e,o.__gui=t,r.extend(o,{options:function(e){if(arguments.length>1){var n=o.__li.nextElementSibling;return o.remove(),q(t,o.object,o.property,{before:n,factoryArgs:[r.toArray(arguments)]})}if(r.isArray(e)||r.isObject(e)){var a=o.__li.nextElementSibling;return o.remove(),q(t,o.object,o.property,{before:a,factoryArgs:[e]})}},name:function(t){return o.__li.firstElementChild.firstElementChild.innerHTML=t,o},listen:function(){return o.__gui.listen(o),o},remove:function(){return o.__gui.remove(o),o}}),o instanceof L){var n=new O(o.object,o.property,{min:o.__min,max:o.__max,step:o.__step});r.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=o[t],r=n[t];o[t]=n[t]=function(){var t=Array.prototype.slice.call(arguments);return r.apply(n,t),e.apply(o,t)}})),A.addClass(e,"has-slider"),o.domElement.insertBefore(n.domElement,o.domElement.firstElementChild)}else if(o instanceof O){var a=function(e){if(r.isNumber(o.__min)&&r.isNumber(o.__max)){var n=o.__li.firstElementChild.firstElementChild.innerHTML,a=o.__gui.__listening.indexOf(o)>-1;o.remove();var i=q(t,o.object,o.property,{before:o.__li.nextElementSibling,factoryArgs:[o.__min,o.__max,o.__step]});return i.name(n),a&&i.listen(),i}return e};o.min=r.compose(a,o.min),o.max=r.compose(a,o.max)}else o instanceof k?(A.bind(e,"click",(function(){A.fakeEvent(o.__checkbox,"click")})),A.bind(o.__checkbox,"click",(function(t){t.stopPropagation()}))):o instanceof F?(A.bind(e,"click",(function(){A.fakeEvent(o.__button,"click")})),A.bind(e,"mouseover",(function(){A.addClass(o.__button,"hover")})),A.bind(e,"mouseout",(function(){A.removeClass(o.__button,"hover")}))):o instanceof I&&(A.addClass(e,"color"),o.updateDisplay=r.compose((function(t){return e.style.borderLeftColor=o.__color.toString(),t}),o.updateDisplay),o.updateDisplay());o.setValue=r.compose((function(e){return t.getRoot().__preset_select&&o.isModified()&&Q(t.getRoot(),!0),e}),o.setValue)}(t,c,a),t.__controllers.push(a),a}function tt(t,e){return document.location.href+"."+e}function et(t,e,o){var r=document.createElement("option");r.innerHTML=e,r.value=e,t.__preset_select.appendChild(r),o&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function ot(t,e){e.style.display=t.useLocalStorage?"block":"none"}function rt(t){var e=void 0;function o(o){return o.preventDefault(),t.width+=e-o.clientX,t.onResize(),e=o.clientX,!1}function n(){A.removeClass(t.__closeButton,Y.CLASS_DRAG),A.unbind(window,"mousemove",o),A.unbind(window,"mouseup",n)}function a(r){return r.preventDefault(),e=r.clientX,A.addClass(t.__closeButton,Y.CLASS_DRAG),A.bind(window,"mousemove",o),A.bind(window,"mouseup",n),!1}t.__resize_handle=document.createElement("div"),r.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),A.bind(t.__resize_handle,"mousedown",a),A.bind(t.__closeButton,"mousedown",a),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function nt(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function at(t,e){var o={};return r.each(t.__rememberedObjects,(function(n,a){var i={},s=t.__rememberedObjectIndecesToControllers[a];r.each(s,(function(t,o){i[o]=e?t.initialValue:t.getValue()})),o[a]=i})),o}function it(t){0!==t.length&&j.call(window,(function(){it(t)})),r.each(t,(function(t){t.updateDisplay()}))}Y.toggleHide=function(){W=!W,r.each(X,(function(t){t.domElement.style.display=W?"none":""}))},Y.CLASS_AUTO_PLACE="a",Y.CLASS_AUTO_PLACE_CONTAINER="ac",Y.CLASS_MAIN="main",Y.CLASS_CONTROLLER_ROW="cr",Y.CLASS_TOO_TALL="taller-than-window",Y.CLASS_CLOSED="closed",Y.CLASS_CLOSE_BUTTON="close-button",Y.CLASS_CLOSE_TOP="close-top",Y.CLASS_CLOSE_BOTTOM="close-bottom",Y.CLASS_DRAG="drag",Y.DEFAULT_WIDTH=245,Y.TEXT_CLOSED="Close Controls",Y.TEXT_OPEN="Open Controls",Y._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||Y.toggleHide()},A.bind(window,"keydown",Y._keydownHandler,!1),r.extend(Y.prototype,{add:function(t,e){return q(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return q(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;r.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&$.removeChild(this.domElement);var t=this;r.each(this.__folders,(function(e){t.removeFolder(e)})),A.unbind(window,"keydown",Y._keydownHandler,!1),J(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var o=new Y(e);this.__folders[t]=o;var r=K(this,o.domElement);return A.addClass(r,"folder"),o},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],J(t);var e=this;r.each(t.__folders,(function(e){t.removeFolder(e)})),r.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=A.getOffset(t.__ul).top,o=0;r.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(o+=A.getHeight(e))})),window.innerHeight-e-20<o?(A.addClass(t.domElement,Y.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(A.removeClass(t.domElement,Y.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&r.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:r.debounce((function(){this.onResize()}),50),remember:function(){if(r.isUndefined(G)&&((G=new N).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;r.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&function(t){var e=t.__save_row=document.createElement("li");A.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),A.addClass(e,"save-row");var o=document.createElement("span");o.innerHTML="&nbsp;",A.addClass(o,"button gears");var n=document.createElement("span");n.innerHTML="Save",A.addClass(n,"button"),A.addClass(n,"save");var a=document.createElement("span");a.innerHTML="New",A.addClass(a,"button"),A.addClass(a,"save-as");var i=document.createElement("span");i.innerHTML="Revert",A.addClass(i,"button"),A.addClass(i,"revert");var s=t.__preset_select=document.createElement("select");t.load&&t.load.remembered?r.each(t.load.remembered,(function(e,o){et(t,o,o===t.preset)})):et(t,V,!1);if(A.bind(s,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(s),e.appendChild(o),e.appendChild(n),e.appendChild(a),e.appendChild(i),H){var l=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(tt(t,"isLocal"))&&c.setAttribute("checked","checked"),ot(t,l),A.bind(c,"change",(function(){t.useLocalStorage=!t.useLocalStorage,ot(t,l)}))}var d=document.getElementById("dg-new-constructor");A.bind(d,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||G.hide()})),A.bind(o,"click",(function(){d.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),G.show(),d.focus(),d.select()})),A.bind(n,"click",(function(){t.save()})),A.bind(a,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),A.bind(i,"click",(function(){t.revert()}))}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&nt(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=at(this)),t.folders={},r.each(this.__folders,(function(e,o){t.folders[o]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=at(this),Q(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[V]=at(this,!0)),this.load.remembered[t]=at(this),this.preset=t,et(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){r.each(this.__controllers,(function(e){this.getRoot().load.remembered?Z(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),r.each(this.__folders,(function(t){t.revert(t)})),t||Q(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&it(this.__listening)},updateDisplay:function(){r.each(this.__controllers,(function(t){t.updateDisplay()})),r.each(this.__folders,(function(t){t.updateDisplay()}))}});var st=Y,lt={};Object.defineProperty(lt,"__esModule",{value:!0});var ct=lt.default=void 0;const dt=6/29,ut=3*dt*dt,pt=t=>Math.round(255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055))||0,ft=t=>t>dt?t*t*t:ut*(t-4/29);function ht(t){return 0===t.length?0:void 0===t[0].length?1:void 0===t[0][0].length?2:void 0===t[0][0][0].length?3:void 0}ct=lt.default=({luminance:t,a:e,b:o})=>{const r=(t+16)/116,n=.96422*ft(r+e/500),a=Number(ft(r)),i=.82521*ft(r-o/200);return{red:pt(3.1338561*n-1.6168667*a-.4906146*i),green:pt(-.9787684*n+1.9161415*a+.033454*i),blue:pt(.0719453*n-.2289914*a+1.4052427*i)}},core["Charting`DateTicksFunction"]=()=>"DateTicksFunction",core.DateListPlot=()=>{},core["Graphics`DPR"]=()=>window.devicePixelRatio;let mt=!1,gt=!1,yt={name:"WebObjects/Graphics"};const _t={name:"GraphicsComplex 2D"};interpretate.contextExpand(yt),["FaceForm","ViewMatrix","CurrentValue","FontColor","Tiny","VertexColors","Antialiasing","Small","Plot","ListCurvePathPlot","ListLinePlot","ListPlot","Automatic","Controls","All","TickLabels","FrameTicksStyle","AlignmentPoint","AspectRatio","Axes","AxesLabel","AxesOrigin","AxesStyle","Background","BaselinePosition","BaseStyle","ColorOutput","ContentSelectable","CoordinatesToolOptions","DisplayFunction","Epilog","FormatType","Frame","FrameLabel","FrameStyle","FrameTicks","FrameTicksStyle","GridLines","GridLinesStyle","ImageMargins","ImagePadding","ImageSize","ImageSizeRaw","Full","LabelStyle","Method","PlotLabel","PlotRange","PlotRangeClipping","PlotRangePadding","PlotRegion","PreserveImageOptions","Prolog","RotateLabel","Ticks","TicksStyle","TransitionDuration"].map((t=>{yt[t]=()=>t,yt[t].update=()=>t})),yt.Spacer=()=>{},core.GoldenRatio=()=>1.618,yt["Graphics`Canvas"]=async(t,e)=>{let o={k:1,x:0,y:0};e.onZoom.push((t=>{o=t}));const r={xAxis:e.xAxis,yAxis:e.yAxis};return e.xAxis=t=>0,e.yAxis=t=>0,e.xAxis.invert=t=>{const n=(t-o.x-e.panZoomEntites.left)/o.k;return r.xAxis.invert(n)},e.yAxis.invert=t=>{const n=(t-o.y-e.panZoomEntites.top)/o.k;return r.yAxis.invert(n)},e.panZoomEntites.canvas},yt.HoldForm=async(t,e)=>await interpretate(t[0],e),yt.HoldForm.update=async(t,e)=>await interpretate(t[0],e),yt.Scale=async(t,e)=>await interpretate(t[0],e),yt.Scale.update=async(t,e)=>await interpretate(t[0],e),yt.NamespaceBox=async(t,e)=>await interpretate(t[1],e),yt.DynamicModuleBox=async(t,e)=>await interpretate(t[1],e),yt.TagBox=async(t,e)=>await interpretate(t[0],e),yt.DynamicModule=async(t,e)=>await interpretate(t[1],e),yt["Charting`DelayedClickEffect"]=async(t,e)=>await interpretate(t[0],e),yt.ColorProfileData=()=>{},yt.ParametricPlot=()=>{},yt.TransitionDuration=()=>"TransitionDuration",yt.TransitionType=()=>"TransitionType";yt.Offset=async(t,e)=>{const o=await interpretate(t[1],e),r={x:o[0],y:o[1]},n=await interpretate(t[0],{...e,offset:r});if(Array.isArray(n)){return[e.xAxis.invert(n[0])-e.xAxis.invert(0)+r.x,e.xAxis.invert(n[1])+r.y-e.xAxis.invert(0)]}return n},yt.Offset.update=yt.Offset,yt.Graphics=async(t,e)=>{await interpretate.shared.d3.load(),mt||(mt=interpretate.shared.d3.d3),gt||(gt=interpretate.shared.d3["d3-interpolate-path"].interpolatePath),yt.interpolatePath=gt,yt.d3=mt,mt.selection.prototype.maybeTransition=function(t,e){return t?this.transition().ease(t).duration(e):this},mt.selection.prototype.maybeTransitionTween=function(t,e,o,r){return t?this.transition().ease(t).duration(e).attrTween(o,r):this.attr(o,r.apply(this.node(),this.data())(1))};let o=await core._getRules(t,{...e,context:yt,hold:!0});if(0==Object.keys(o).length&&t.length>1)if("List"===t[1][0]){const r=t[1].slice(1);o="List"===r[0][0]?await core._getRules(r[0].slice(1),{...e,context:yt,hold:!0}):await core._getRules(r,{...e,context:yt,hold:!0})}else o=await core._getRules(await interpretate(t[1],{...e,context:yt,hold:!0}),{...e,context:yt,hold:!0});console.log(o);let r=o.PlotLabel;var n=e.element;let a=await interpretate(o.ImageSize,{...e,context:yt});"number"==typeof a?a<1&&(a=1e4*a/2):"string"==typeof a&&(a=core.DefaultWidth),a||(a=e.imageSize?Array.isArray(e.imageSize)?e.imageSize:[e.imageSize,.618034*e.imageSize]:core.DefaultWidth);let i,s,l,c=[!1,!1],d=!1,u=[5,5,5,5],p=[!0,!1,!0,!1],f=!1;if(console.log(o),o.Frame&&(o.Frame=await interpretate(o.Frame,e),!0===o.Frame?f=!0:(!0===o.Frame[0][0]&&(f=!0),!0===o.Frame[0]&&(f=!0),o.Frame[1]&&!0===o.Frame[1][0]&&(c=[!0,!1]))),o.Axes&&(o.Axes=await interpretate(o.Axes,e),!0===o.Axes?c=[!0,!0]:Array.isArray(o.Axes)&&(c=o.Axes)),f&&(d=!0,c=[!0,!0,!0,!0]),o.Ticks&&(o.Ticks=await interpretate(o.Ticks,e),Array.isArray(o.Ticks)&&Array.isArray(o.Ticks[0])&&(Number.isInteger(o.Ticks[0][0])||Array.isArray(o.Ticks[0][0]))&&(i=[...o.Ticks,...o.Ticks])),o.FrameTicks&&f&&(o.FrameTicks=await interpretate(o.FrameTicks,e),i=[!0,!0,!0,!0],Array.isArray(o.FrameTicks)&&(Array.isArray(o.FrameTicks[0])&&(Array.isArray(o.FrameTicks[0][0])?(Number.isInteger(o.FrameTicks[0][0][0])||"string"==typeof o.FrameTicks[0][0]||Array.isArray(o.FrameTicks[0][0][0]))&&(i[1]=o.FrameTicks[0][0],i[3]=o.FrameTicks[0][1]):(i[1]=o.FrameTicks[0][0],i[3]=o.FrameTicks[0][1])),Array.isArray(o.FrameTicks[1])&&(Array.isArray(o.FrameTicks[1][0])?(Number.isInteger(o.FrameTicks[1][0][0])||"string"==typeof o.FrameTicks[1][0]||Array.isArray(o.FrameTicks[1][0][0]))&&(i[0]=o.FrameTicks[1][0],i[2]=o.FrameTicks[1][1]):(i[0]=o.FrameTicks[1][0],i[2]=o.FrameTicks[1][1])))),o.FrameTicks&&o.FrameTicks[2][1]){let t=o.FrameTicks[2][1];Array.isArray(t)&&(t=t[1],Array.isArray(t)&&"Charting`getDateTicks"==t[0]&&(f=!1,c=[!0,!1]))}if(o.TickDirection){const t=await interpretate(o.TickDirection,e);"Inward"===t&&(d=!0),"Outward"===t&&(d=!1)}o.TickLengths&&(o.TickLengths=await interpretate(o.TickLengths,e),Array.isArray(o.TickLengths)||(u=[o.TickLengths,o.TickLengths,o.TickLengths,o.TickLengths])),o.TickLabels&&(o.TickLabels=await interpretate(o.TickLabels,e),p=Array.isArray(o.TickLabels)?o.TickLabels.flat():[!1,!1,!1,!1]);let h={top:0,right:0,bottom:10,left:40},m={top:0,right:0,bottom:15,left:0};c[2]&&(h.top=h.bottom,h.left=h.right),o.AxesLabel&&(m.bottom=10,h.top=30,h.right=50,m.right=50),f&&(m.left=40,m.left=30,h.left=30,h.right=40,h.top=30,m.bottom=10,h.bottom=35),o.ImagePadding&&(console.log("padding: "),console.log(o.ImagePadding),o.ImagePadding=await interpretate(o.ImagePadding,e),console.log(o.ImagePadding),"None"===o.ImagePadding?(h.top=0,h.bottom=0,h.left=0,h.right=0):Number.isInteger(o.ImagePadding)?(h.top=o.ImagePadding,h.bottom=o.ImagePadding,h.left=o.ImagePadding,h.right=o.ImagePadding):"All"===o.ImagePadding||(!1===o.ImagePadding?(h.top=0,h.bottom=0,h.left=0,h.right=0):console.error("given ImagePadding is not supported!")));let g=await interpretate(o.AspectRatio,e)||1;a instanceof Array||(g=(g*(a-h.left-h.right)+h.top+h.bottom)/a,a=[a,a*g]);let y,_=a[0]-h.left-h.right,b=a[1]-h.top-h.bottom;if((_<0||b<0)&&(h.top=0,h.bottom=0,h.left=0,h.right=0,m={top:0,right:0,bottom:0,left:0},_=a[0],b=a[1]),y=mt.select(n).append("svg"),"ViewBox"in o){let t=await interpretate(o.ViewBox,e);t instanceof Array||(t=[0,0,t,t*g]),y.attr("viewBox",t),e.viewBox=t}else y.attr("width",_+h.left+h.right+m.left).attr("height",b+h.top+h.bottom+m.bottom),e.svgWidth=_+h.left+h.right+m.left,e.svgHeight=b+h.top+h.bottom+m.bottom;let v=0,x=2;f&&(v=7,x=0),y.attr("tabindex","0");const w=y;y=y.append("g").attr("transform","translate("+(h.left+m.left)+","+h.top+")");const A="clp"+Math.random().toFixed(4).toString().replace(".","");y.append("clipPath").attr("id",A).append("rect").attr("width",_-2*v+x).attr("height",b-2*v+x).attr("x",v-x).attr("y",v-x);let k=[[-1.15,1.15],[-1.15,1.15]],T=!0;if(o.PlotRange||e.plotRange){const t=e.plotRange||await interpretate(o.PlotRange,e);Number.isFinite(t[0][0])&&(Number.isFinite(t[1][0])?(k=t,T=!1):(k[0]=t[0],k[1]=t[0]))}let C,E,S,O,R=mt.easeLinear;if(o.TransitionType){switch(await interpretate(o.TransitionType,{...e,context:yt})){case"Linear":R=mt.easeLinear;break;case"CubicInOut":R=mt.easeCubicInOut;break;default:R=void 0}}console.log(k);let L=mt.scaleLinear().domain(k[0]).range([0,_]),F=mt.axisBottom(L),I=mt.axisTop(L);if(console.log(c),i)if(i[0])if("string"==typeof i[0])switch(i[0]){case"Automatic":break;case"None":F=F.tickValues([]);break;case"DateTicksFunction":L=mt.scaleTime().domain(k[0].map((t=>1e3*t-2208996e6))).range([0,_]),I=mt.axisTop(L),F=mt.axisBottom(L);const t=L;L=e=>t(1e3*e-2208996e6),L.copy=t.copy,L.range=t.range,L.domain=t.domain,L.invert=t.invert}else if(!0===i[0])console.log("Default ticks");else if(Array.isArray(i[0][0])){const t=i[0].map((t=>t[1]));F=F.tickValues(i[0].map((t=>t[0]))).tickFormat((function(e,o){return t[o]}))}else F=F.tickValues(i[0]);else F=F.tickValues([]);if(i)if(i[2])if("string"==typeof i[2])switch(i[2]){case"Automatic":break;case"None":I=I.tickValues([]);break;case"DateTicksFunction":L=mt.scaleTime().domain(k[0].map((t=>1e3*t-2208996e6))).range([0,_]),I=mt.axisTop(L).ticks(4),F=mt.axisBottom(L).ticks(4);const t=L;L=e=>t(1e3*e-2208996e6),L.copy=t.copy,L.range=t.range,L.domain=t.domain,L.invert=t.invert}else if(!0===i[2])console.log("Default ticks");else if(Array.isArray(i[2][0])){const t=i[2].map((t=>t[1]));I=I.tickValues(i[2].map((t=>t[0]))).tickFormat((function(e,o){return t[o]}))}else I=I.tickValues(i[2]);else I=I.tickValues([]);p[0]||(F=F.tickFormat((t=>""))),p[1]||(I=I.tickFormat((t=>""))),d?(F=F.tickSizeInner(-u[0]).tickSizeOuter(0),I=I.tickSizeInner(-u[2]).tickSizeOuter(0)):(F=F.tickSizeInner(u[0]).tickSizeOuter(0),I=I.tickSizeInner(u[2]).tickSizeOuter(0));let D=mt.scaleLinear().domain(k[1]).range([b,0]),z=mt.axisLeft(D),M=mt.axisRight(D);if(i)if(i[1])if("string"==typeof i[1])switch(i[1]){case"Automatic":break;case"None":z=z.tickValues([]);break;case"DateTicksFunction":D=mt.scaleTime().domain(k[1].map((t=>1e3*t-2208996e6))).range([0,b]),M=mt.axisRight(D),z=mt.axisLeft(D);const t=D;D=e=>t(1e3*e-2208996e6),D.copy=t.copy,D.range=t.range,D.domain=t.domain,D.invert=t.invert}else if(!0===i[1])console.log("Default ticks");else if(Array.isArray(i[1][0])){const t=i[1].map((t=>t[1]));z=z.tickValues(i[1].map((t=>t[0]))).tickFormat((function(e,o){return t[o]}))}else z=z.tickValues(i[1]);else z=z.tickValues([]);if(i)if(i[3])if("string"==typeof i[3])switch(i[3]){case"Automatic":break;case"None":M=M.tickValues([]);break;case"DateTicksFunction":D=mt.scaleTime().domain(k[1].map((t=>1e3*t-2208996e6))).range([0,b]),M=mt.axisRight(D),z=mt.axisLeft(D);const t=D;D=e=>t(1e3*e-2208996e6),D.copy=t.copy,D.range=t.range,D.domain=t.domain,D.invert=t.invert}else if(!0===i[3])console.log("Default ticks");else if(Array.isArray(i[3][0])){const t=i[3].map((t=>t[1]));M=M.tickValues(i[3].map((t=>t[0]))).tickFormat((function(e,o){return t[o]}))}else M=M.tickValues(i[3]);else M=M.tickValues([]);p[2]||(z=z.tickFormat((t=>""))),p[3]||(M=M.tickFormat((t=>""))),d?(z=z.tickSizeInner(-u[1]).tickSizeOuter(0),M=M.tickSizeInner(-u[3]).tickSizeOuter(0)):(z=z.tickSizeInner(u[1]).tickSizeOuter(0),M=M.tickSizeInner(u[3]).tickSizeOuter(0)),e.context=yt,e.svg=y.append("g"),e.svg=e.svg.attr("clip-path","url(#"+A+")").append("g"),e.xAxis=L,e.yAxis=D,e.numerical=!0,e.tostring=!1,e.offset={x:0,y:0},e.color="rgb(68, 68, 68)",e.stroke=void 0,e.opacity=1,e.fontsize=10,e.fontfamily="sans-serif",e.strokeWidth=1.5,e.pointSize=.023,e.arrowHead=1,e.onZoom=[],e.transitionDuration=50,e.transitionType=R,e.plotRange=k,s={...e},l={...e},o.AxesStyle&&await interpretate(o.AxesStyle,s),o.FrameStyle&&(console.warn("FrameStyle"),console.log(o.FrameStyle),await interpretate(o.FrameStyle,s),console.log(s)),o.FrameTicksStyle&&await interpretate(o.FrameTicksStyle,l),c[0]&&(C=y.append("g").attr("transform","translate(0,"+b+")").call(F).attr("font-size",l.fontsize).attr("fill",l.color)),c[2]&&(S=y.append("g").attr("transform","translate(0,0)").call(I).attr("font-size",l.fontsize).attr("fill",l.color)),c[1]&&(E=y.append("g").call(z).attr("font-size",l.fontsize).attr("fill",l.color)),c[3]&&(O=y.append("g").attr("transform","translate("+_+", 0)").call(M).attr("font-size",l.fontsize).attr("fill",l.color));let P={...e};if(o.LabelStyle&&await interpretate(o.LabelStyle,P),r&&(r=await interpretate(r,P),y.append("text").attr("x",_/2+P.offset.x).attr("y",0-h.top/2+P.offset.y).attr("text-anchor","middle").attr("fill",P.color).style("font-size",P.fontsize).style("font-family",P.fontfamily).text(r)),o.AxesLabel&&!f&&(o.AxesLabel=await interpretate(o.AxesLabel,{...e,hold:!0}),Array.isArray(o.AxesLabel))){let t={...e},r=await interpretate(o.AxesLabel[0],t);if("None"!=r&&C){let e=0,o=0;Array.isArray(r)&&(e=r[1][0],o=r[1][1],r=r[0]),yt.Text.PutText(C.append("text").attr("x",_+t.offset.x+10+e).attr("y",h.bottom+t.offset.y+o).attr("font-size",s.fontsize).attr("fill",s.color).attr("text-anchor","start"),r,s)}if(t={...e},r=await interpretate(o.AxesLabel[1],t),"None"!=r&&E){let e=0,o=0;Array.isArray(r)&&(e=r[1][0],o=r[1][1],r=r[0]),yt.Text.PutText(E.append("text").attr("x",0+t.offset.x+e).attr("y",-h.top/2+t.offset.y+o).attr("font-size",s.fontsize).attr("fill",s.color).attr("text-anchor","start"),r,s)}}if(o.FrameLabel&&f&&(o.FrameLabel=await interpretate(o.FrameLabel,{...e}),Array.isArray(o.FrameLabel))){let t,r,n=o.FrameLabel[0],a=o.FrameLabel[1];if("string"==typeof n){const t=[n,a];n=[t[1],"None"],a=[t[0],"None"]}if("None"!=n&&n){if(t={...e},r=n[0],"None"!=r&&E){let e=0,o=0;Array.isArray(r)&&(e=r[1][0],o=r[1][1],r=r[0]),yt.Text.PutText(E.append("text").attr("transform","rotate(-90)").attr("y",-h.left+t.offset.x+e).attr("x",-b/2-t.offset.y+o).attr("font-size",s.fontsize).attr("fill",s.color).attr("text-anchor","middle"),r,s)}if(t={...e},r=n[1],"None"!=r&&O){let e=0,o=0;Array.isArray(r)&&(e=r[1][0],o=r[1][1],r=r[0]),yt.Text.PutText(O.append("text").attr("x",0+t.offset.x+e).attr("y",h.bottom+t.offset.y+o).attr("font-size",s.fontsize).attr("fill",s.color).attr("text-anchor","middle"),r,s)}}if("None"!=a&&a){if(t={...e},r=a[1],"None"!=r&&S){let e=0,o=0;Array.isArray(r)&&(e=r[1][0],o=r[1][1],r=r[0]),yt.Text.PutText(S.append("text").attr("x",_/2+t.offset.x+e).attr("y",h.bottom+t.offset.y+o).attr("font-size",s.fontsize).attr("fill",s.color).attr("text-anchor","middle"),r,s)}if(t={...e},r=a[0],"None"!=r&&C){let e=0,o=0;Array.isArray(r)&&(e=r[1][0],o=r[1][1],r=r[0]),yt.Text.PutText(C.append("text").attr("x",_/2+t.offset.x+e).attr("y",h.bottom+t.offset.y+o).attr("font-size",s.fontsize).attr("fill",s.color).attr("text-anchor","middle"),r,s)}}}if(o.TransitionDuration&&(e.transitionDuration=await interpretate(o.TransitionDuration,e)),e.local.xAxis=L,e.local.yAxis=D,(o.Controls||void 0===o.Controls)&&(void 0===o.Controls||await interpretate(o.Controls,e))&&xt(w,y,e.svg,C,E,S,O,F,z,I,M,L,D,e),e.panZoomEntites={canvas:w,svg:e.svg,left:h.left+m.left,top:h.top,gX:C,gY:E,gTX:S,gRY:O,xAxis:F,yAxis:z,txAxis:I,ryAxis:M,x:L,y:D},!e.inset&&_>=160&&b>=98){const t=new st({autoPlace:!1,name:"...",closed:!0}),o=document.createElement("div");o.classList.add("graphics2d-controller"),o.appendChild(t.domElement);const r={Save:function(){!function(t,e){if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(t,e);else{const o=document.createElement("a");document.body.appendChild(o);const r=window.URL.createObjectURL(t);o.href=r,o.download=e,o.click(),setTimeout((()=>{window.URL.revokeObjectURL(r),document.body.removeChild(o)}),0)}}(vt(n.firstChild),"plot.svg")}};t.add(r,"Save"),e.element.appendChild(o)}const j=Object.keys(e.global.stack);if(await interpretate(o.Prolog,e),await interpretate(t[0],e),interpretate(o.Epilog,e),T){if(e.reRendered)return console.error("Something is wrong with ranges. We could not determine them properly"),void console.warn(e);y.node().style.opacity=0,console.warn("d3.js autoscale! Requires double evaluation!!!");const o=a[0]-(h.left+h.right),r=a[1]-(h.top+h.bottom);let i=e.svg.node().getBBox();console.log([o,r]),console.log(i);const s=[[L.invert(i.x),L.invert(i.x+i.width)],[D.invert(i.height+i.y),D.invert(i.height+i.y-i.height)]];console.log(s),console.warn("Kill all created instances");const l=Object.keys(e.global.stack).filter((t=>!j.some((e=>e===t))));for(const t of l)e.global.stack[t].dispose();return y.remove(),n.replaceChildren(),await yt.Graphics(t,{...e,plotRange:s,reRendered:!0})}return e},yt["Graphics`Serialize"]=async(t,e)=>{const o=await core._getRules(t,e);let r=e.element;o.TemporalDOM&&(r=document.createElement("div"),r.style.pointerEvents="none",r.style.opacity=0,r.style.position="absolute",document.body.appendChild(r));const n=await interpretate(t[0],{...e,element:r}),a=await vt(n.element.firstChild).text();return Object.values(e.global.stack).forEach((t=>{t.dispose()})),o.TemporalDOM&&r.remove(),a},yt.Graphics.update=(t,e)=>{console.error("root update method for Graphics is not supported")},yt.Graphics.destroy=(t,e)=>{console.error("Nothing to destroy...")},yt.JoinForm=(t,e)=>{e.joinform=interpretate(t[0],e),console.warn("JoinForm is not implemented!")};const bt={BezierCurve:async(t,e)=>{let o=await interpretate(t[0],e);var r=e.path;const n=e.xAxis,a=e.yAxis;o=o.map((t=>[n(t[0]),a(t[1])]));let i=o.length-1;if(e.startQ){r.moveTo(...o[0]);for(let t=1;t<o.length-2;t+=3)i-=3,r.bezierCurveTo(...o[t],...o[t+1],...o[t+2]);e.startQ=!1}else for(let t=0;t<o.length-2;t+=3)i-=3,r.bezierCurveTo(...o[t],...o[t+1],...o[t+2]);i>0&&r.quadraticCurveTo(...o[o.length-2],...o[o.length-1])},Line:async(t,e)=>{let o=await interpretate(t[0],e);var r=e.path;const n=e.xAxis,a=e.yAxis;if(o=o.map((t=>[n(t[0]),a(t[1])])),e.startQ){r.moveTo(...o[0]);for(let t=1;t<o.length;++t)r.lineTo(...o[t]);e.startQ=!1}else for(let t=0;t<o.length;++t)r.lineTo(...o[t])}};yt.JoinedCurve=async(t,e)=>{const o=mt.path();return await interpretate(t[0],{...e,path:o,context:[bt,yt],startQ:!0}),e.svg.append("path").attr("fill","none").attr("vector-effect","non-scaling-stroke").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",o)},yt.CapForm=()=>{},yt.FilledCurve=async(t,e)=>{const o=mt.path();return await interpretate(t[0],{...e,path:o,context:[bt,yt],startQ:!0}),e.svg.append("path").attr("fill",e.color).attr("vector-effect","non-scaling-stroke").attr("opacity",e.opacity).attr("fill-rule","evenodd").attr("stroke","none").attr("stroke-width",e.strokeWidth).attr("d",o)},yt.Inset=async(t,e)=>{let o,r=[0,0];const n=await core._getRules(t,e),a=Object.keys(n).length;let i;t.length-a>1&&(r=await interpretate(t[1],e)),r instanceof NumericArrayObject&&(r=r.normal()),t.length-a>2&&(i=await interpretate(t[2],e)),t.length-a>3&&(o=await interpretate(t[3],e));const s=e.svg.append("g"),l=s.append("foreignObject");l.attr("width","auto"),l.attr("height","auto");const c={global:e.global,inset:!0,element:l.node()};o&&("number"==typeof o&&(o=[o,o/1.6]),o=[Math.abs(e.xAxis(o[0])-e.xAxis(0)),Math.abs(e.yAxis(o[1])-e.yAxis(0))],l.attr("width",o[0]),l.attr("height",o[1])),await interpretate(t[0],c);const d=s.node().firstChild,u={width:d.scrollWidth,height:d.scrollHeight};return o||(l.attr("width",u.width),l.attr("height",u.height)),"ViewMatrix"in n&&!n.ViewMatrix?(l.attr("x",0),l.attr("y",0),s):(i||(i=[u.width/2,u.height/2]),l.attr("x",e.xAxis(r[0])-i[0]).attr("y",e.yAxis(r[1])-i[1]),e.local.foreignObject=l,e.local.opos=i,s)},yt.Inset.update=async(t,e)=>{let o=await interpretate(t[1],e);o instanceof NumericArrayObject&&(o=o.normal());const r=e.local.opos;return e.local.foreignObject.attr("x",e.xAxis(o[0])-r[0]).attr("y",e.yAxis(o[1])-r[1]),e.local.foreignObject},yt.Inset.destroy=async(t,e)=>{console.warn("Destory method is not defined for Inset")},yt.Inset.virtual=!0;const vt=t=>{const e="http://www.w3.org/2000/xmlns/";t=t.cloneNode(!0);const o=window.location.href+"#",r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT);for(;r.nextNode();)for(const t of r.currentNode.attributes)t.value.includes(o)&&(t.value=t.value.replace(o,"#"));t.setAttributeNS(e,"xmlns","http://www.w3.org/2000/svg"),t.setAttributeNS(e,"xmlns:xlink","http://www.w3.org/1999/xlink");const n=(new window.XMLSerializer).serializeToString(t);return new Blob([n],{type:"image/svg+xml"})};const xt=(t,e,o,r,n,a,i,s,l,c,d,u,p,f)=>{console.log({listener:t,raw:e,view:o,gX:r,gY:n,gTX:a,gRY:i,xAxis:s,yAxis:l,txAxis:c,ryAxis:d,x:u,y:p,env:f});const h=mt.zoom().filter((function(t){return t.preventDefault(),!(t.ctrlKey&&"wheel"!==t.type||t.button)})).on("zoom",(function({transform:t}){o.attr("transform",t),r&&r.call(s.scale(t.rescaleX(u)));n&&n.call(l.scale(t.rescaleY(p)));a&&a.call(c.scale(t.rescaleX(u)));i&&i.call(d.scale(t.rescaleY(p)));f.onZoom.forEach((e=>{e(t)}))}));t.call(h),f._zoom=h};let wt;yt.SVGAttribute=async(t,e)=>{const o=await core._getRules(t,e);let r=await interpretate(t[0],e);return Object.keys(o).forEach((t=>{r=r.attr(t,o[t])})),e.local.object=r,r},yt.SVGAttribute.update=async(t,e)=>{const o=await core._getRules(t,e);let r=e.local.object.maybeTransition(e.transitionType,e.transitionDuration);return Object.keys(o).forEach((t=>{r=r.attr(t,o[t])})),r},yt.SVGAttribute.destroy=async(t,e)=>{console.log("SVGAttribute: nothing to destroy")},yt.SVGAttribute.virtual=!0,yt.LABColor=async(t,e)=>{let o;o=t.length>1?[await interpretate(t[0],e),await interpretate(t[1],e),await interpretate(t[2],e)]:await interpretate(t[0],e);const r=ct({luminance:100*o[0],a:100*o[1],b:100*o[2]});return console.log(o),console.log("LAB color"),console.log(r),e.color="rgb("+Math.floor(r.red)+","+Math.floor(r.green)+","+Math.floor(r.blue)+")",t.length>3&&(e.opacity=await interpretate(t[3],e)),e.color},yt.LABColor.update=()=>{},yt.arrowGenerator=void 0,_t.Arrow=async(t,e)=>{await interpretate.shared.d3.load(),wt||(wt=(await interpretate.shared.d3["d3-arrow"]).arrow1);let o=await interpretate(t[0],e);if(!Array.isArray(o)){let t;const r=uuidv4(),n=wt().id(r).attr("fill",e.color).attr("stroke","none").scale([e.arrowHead]);return e.svg.call(n),t=o.attr("marker-end","url(#"+r+")"),t}const r=e.xAxis,n=e.yAxis;if(o[0][0]){console.log("Multiple isntances"),console.log(o);const t=e.svg.append("g");t.attr("fill","none").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth);const a=uuidv4(),i=wt().id(a).attr("fill",e.color).attr("stroke","none").scale([e.arrowHead]);return e.svg.call(i),o.forEach((o=>{t.append("path").datum(o.map((t=>e.vertices[t-1]))).attr("vector-effect","non-scaling-stroke").attr("d",mt.line().x((function(t){return r(t[0])})).y((function(t){return n(t[1])}))).attr("marker-end","url(#"+a+")")})),t}{const t=uuidv4(),a=wt().id(t).attr("fill",e.color).attr("stroke","none").scale([e.arrowHead]);e.svg.call(a);return e.svg.append("path").datum(o.map((t=>e.vertices[t-1]))).attr("fill","none").attr("vector-effect","non-scaling-stroke").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",mt.line().x((function(t){return r(t[0])})).y((function(t){return n(t[1])}))).attr("marker-end","url(#"+t+")")}},yt.Arrow=async(t,e)=>{await interpretate.shared.d3.load(),wt||(wt=(await interpretate.shared.d3["d3-arrow"]).arrow1),e.xAxis,e.yAxis;const o=uuidv4(),r=wt().id(o).attr("fill",e.color).attr("stroke","none").scale([e.arrowHead]);e.local.marker=o,e.svg.call(r);let n=await interpretate(t[0],e);if(n instanceof NumericArrayObject&&(n=n.normal()),!Array.isArray(n)){let t;return t=n.attr("marker-end","url(#"+o+")"),t}if(e.local.line=mt.line().x((function(t){return e.xAxis(t[0])})).y((function(t){return e.yAxis(t[1])})),n[0][0][0]||"number"==typeof n[0][0][0]){const t=[];return n.forEach((r=>{t.push(e.svg.append("path").datum(r).attr("vector-effect","non-scaling-stroke").attr("fill","none").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",e.local.line).attr("marker-end","url(#"+o+")"))})),e.local.arrows=t,t}{const t=e.svg.append("path").datum(n).attr("vector-effect","non-scaling-stroke").attr("fill","none").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",e.local.line).attr("marker-end","url(#"+o+")");return e.local.arrow=t,e.colorRefs&&(e.colorRefs[e.root.uid]=e.root),e.opacityRefs&&(e.opacityRefs[e.root.uid]=e.root),t}},yt.Arrow.update=async(t,e)=>{e.xAxis,e.yAxis;let o=await interpretate(t[0],e);if(o instanceof NumericArrayObject&&(o=o.normal()),o[0][0][0])throw"Arrows update method does not support multiple traces";return e.local.arrow.datum(o).maybeTransitionTween(e.TransitionType,e.TransitionDuration,"d",(function(t){var o=mt.select(this).attr("d"),r=e.local.line(t);return gt(o,r)}))},yt.Arrow.updateColor=(t,e)=>{"string"==typeof e.local.marker&&(e.local.marker=mt.select(document.getElementById(e.local.marker).firstChild)),e.local.marker.attr("fill",e.color),Array.isArray(e.local.arrows)?e.local.arrows.map((t=>t.attr("stroke",e.color))):e.local.arrow.attr("stroke",e.color)},yt.Arrow.updateOpacity=(t,e)=>{"string"==typeof e.local.marker&&(e.local.marker=mt.select(document.getElementById(e.local.marker).firstChild)),e.local.marker.attr("opacity",e.opacity),Array.isArray(e.local.arrows)?e.local.arrows.map((t=>t.attr("opacity",e.opacity))):e.local.arrow.attr("opacity",e.opacity)},yt.Arrow.virtual=!0,yt.Arrow.destroy=async(t,e)=>{if(e.colorRefs&&delete e.colorRefs[e.root.uid],e.opacityRefs&&delete e.opacityRefs[e.root.uid],Array.isArray(e.local.arrows)?e.local.arrows.map((t=>t.remove)):e.local.arrow.remove(),"string"==typeof e.local.marker){const t=document.getElementById(e.local.marker);e.local.marker=mt.select(t.firstChild),e.local.marker.remove(),t.remove()}else e.local.marker.remove()},yt.ImageScaled=async(t,e)=>{const o=await interpretate(t[0],e);return[o[0]*(e.plotRange[0][1]-e.plotRange[0][0])+e.plotRange[0][0],o[1]*(e.plotRange[1][1]-e.plotRange[1][0])+e.plotRange[1][0]]},yt.Arrowheads=async(t,e)=>{const o=await interpretate(t[0],e);Array.isArray(o)?e.arrowHead=10*o.flat()[0]:e.arrowHead=10*o},yt.Text=async(t,e)=>{const o=await interpretate(t[0],e);let r=await interpretate(t[1],e);r instanceof NumericArrayObject&&(r=r.normal()),e.local.text=o;let n={x:0,y:0};e.offset&&(n=e.offset);const a=e.svg.append("text").attr("font-family",e.fontfamily).attr("font-size",e.fontsize).attr("fill",e.color);if(t.length>2){const o=(await interpretate(t[2],{...e,plotRange:[[-1,1],[-1,1]]})).map((t=>Math.round(t)));console.warn("OFFSET"),console.warn(o),e.offset&&(n=e.offset),a.attr("x",e.xAxis(r[0])+n.x).attr("y",e.yAxis(r[1])+n.y),0===o[0]&&0===o[1]?a.attr("text-anchor","middle"):-1===o[0]?a.attr("text-anchor","start"):1===o[0]?a.attr("text-anchor","end"):(console.warn(o),console.error("Unknown anchor"))}else a.attr("x",e.xAxis(r[0])+n.x).attr("y",e.yAxis(r[1])+n.y);return yt.Text.PutText(a,o,e),e.local.object=a,e.colorRefs&&(e.colorRefs[e.root.uid]=e.root),e.opacityRefs&&(e.opacityRefs[e.root.uid]=e.root),a},yt.Text.PutText=(t,e,o)=>{if(!e)return;let r=e;"number"==typeof e&&(r=e.toString());const n=[yt.Text.TokensSplit(r.replaceAll(/\\([a-zA-z]+)/g,yt.Text.GreekReplacer),yt.Text.TextOperators)].flat(1/0);let a;console.log(n),t.html(n.shift());let i=0;for(;null!=(a=n.shift());)"string"==typeof a?(t.append("tspan").html(a).attr("font-size",o.fontsize).attr("dy",-i),i=0):(i=-o.fontsize*a.ky,t.append("tspan").html(a.data).attr("font-size",Math.round(o.fontsize*a.kf)).attr("dy",i))},yt.Text.TextOperators=[{type:"sup",handler:t=>t,regexp:/\^(\d{1,3})/,meta:{ky:.5,kf:.5}},{type:"sup",handler:t=>t,regexp:/\^{([^{|}]*)}/,meta:{ky:.5,kf:.5}},{type:"sub",handler:t=>t,regexp:/\_(\d{1,3})/,meta:{ky:-.5,kf:.5}},{type:"sub",handler:t=>t,regexp:/\_{([^{|}]*)}/,meta:{ky:-.5,kf:.5}}],yt.Text.GreekReplacer=(t,e,o)=>"&"+e.toLowerCase().replace("sqrt","radic").replace("degree","deg")+";",yt.Text.TokensSplit=(t,e,o=0)=>{if(o===e.length||o<0)return t;const r=t.match(e[o].regexp);if(null===r)return yt.Text.TokensSplit(t,e,o+1);const n={type:e[o].type,data:e[o].handler(r[1]),...e[o].meta};return[yt.Text.TokensSplit(t.slice(0,r.index),e,o+1),n,yt.Text.TokensSplit(t.slice(r.index+r[0].length),e,0)]},yt.Text.virtual=!0,yt.Text.updateColor=(t,e)=>{e.local.object.attr("fill",e.color)},yt.Text.updateOpacity=(t,e)=>{e.local.object.attr("opacity",e.opacity)},yt.Text.update=async(t,e)=>{const o=await interpretate(t[0],e);let r,n=await interpretate(t[1],e);return n instanceof NumericArrayObject&&(n=n.normal()),r=e.local.text!=o?e.local.object.maybeTransition(e.transitionType,e.transitionDuration).text(o).attr("x",e.xAxis(n[0])).attr("y",e.yAxis(n[1])).attr("fill",e.color):e.local.object.maybeTransition(e.transitionType,e.transitionDuration).attr("x",e.xAxis(n[0])).attr("y",e.yAxis(n[1])).attr("fill",e.color),r},yt.Text.destroy=(t,e)=>{console.log("Nothing to destory"),e.colorRefs&&delete e.colorRefs[e.root.uid],e.opacityRefs&&delete e.opacityRefs[e.root.uid]},yt.Text.subcontext={},yt.FontSize=()=>"FontSize",yt.FontSize.update=yt.FontSize,yt.FontFamily=()=>"FontFamily",yt.FontFamily.update=yt.FontFamily,yt.Style=async(t,e)=>{const o=e,r=await core._getRules(t,e);r.FontSize&&(o.fontsize=r.FontSize),r.FontColor&&(o.color=r.FontColor),r.FontFamily&&(o.fontfamily=r.FontFamily);for(let e=1;e<t.length-Object.keys(r).length;++e)await interpretate(t[e],o);return await interpretate(t[0],o)},yt.Style.update=async(t,e)=>{const o=await core._getRules(t,e);return o.FontSize&&(e.fontsize=o.FontSize),o.FontFamily&&(e.fontfamily=o.FontFamily),await interpretate(t[0],e)},yt.AnimationFrameListener=async(t,e)=>{await interpretate(t[0],e);const o=await core._getRules(t,{...e,hold:!0});e.local.event=await interpretate(o.Event,e),e.local.fire=()=>{server.kernel.emitt(e.local.event,"True","Frame")},window.requestAnimationFrame(e.local.fire)},yt.AnimationFrameListener.update=async(t,e)=>{window.requestAnimationFrame(e.local.fire)},yt.AnimationFrameListener.destroy=async(t,e)=>{console.warn("AnimationFrameListener does not exist anymore")},yt.AnimationFrameListener.virtual=!0,yt.GraphicsComplex=async(t,e)=>{const o=await interpretate(t[0],e),r=await core._getRules(t,e),n={...e,vertices:o,context:[_t,yt]};return r.VertexColors&&(n.vertexColors=r.VertexColors),await interpretate(t[1],n)},yt.GraphicsComplex.update=()=>{throw"Updates of GraphicsComplex are not supported!"},yt.GraphicsComplex.destroy=()=>{console.log("Nothing to destroy")},yt.GraphicsComplex.virtual=!0,yt.Medium=()=>.08,yt.Large=()=>1.1/10,yt.Small=()=>.025,yt.GraphicsGroup=async(t,e)=>await interpretate(t[0],e),yt.Invisible=async(t,e)=>{const o=e.svg.append("g");return o.attr("style","visibility:hidden"),await interpretate(t[0],{...e,svg:o})},yt.Thickness=()=>{},yt.AbsoluteThickness=(t,e)=>{e.strokeWidth=interpretate(t[0],e)},yt.PointSize=async(t,e)=>{e.pointSize=await interpretate(t[0],e)},yt.Annotation=core.List,yt.ZoomAt=async(t,e)=>{let o=await interpretate(t[0],e),r=[0,0];t.length>1&&(r=await interpretate(t[1],e)),r=[e.xAxis(r[0])-e.xAxis(0),e.yAxis(r[1])-e.yAxis(0)],console.log(r);const n=e.panZoomEntites;console.log(e.svg.attr("transform"));const a=e.svg.node().getBBox(),i=mt.zoomIdentity.translate(a.width/2,a.height/2).scale(o).translate(-a.width/2-r[0],-a.height/2-r[1]);n.svg.maybeTransition(e.transitionType,e.transitionDuration).attr("transform",i),n.gX&&n.gX.maybeTransition(e.transitionType,e.transitionDuration).call(n.xAxis.scale(i.rescaleX(n.x))),n.gY&&n.gY.maybeTransition(e.transitionType,e.transitionDuration).call(n.yAxis.scale(i.rescaleY(n.y))),n.gTX&&n.gTX.maybeTransition(e.transitionType,e.transitionDuration).call(n.txAxis.scale(i.rescaleX(n.x))),n.gRY&&n.gRY.maybeTransition(e.transitionType,e.transitionDuration).call(n.ryAxis.scale(i.rescaleY(n.y)))};yt.Directive=async(t,e)=>{const o=await core._getRules(t,e);for(const t of Object.keys(o))e[t.toLowerCase()]=o[t];if((t=>{if("transitiontype"in t)switch(t.transitiontype){case"Linear":t.transitionType=mt.easeLinear;break;case"CubicInOut":t.transitionType=mt.easeCubicInOut;break;default:t.transitionType=!1}t.transitionduration&&(t.transitionDuration=t.transitionduration)})(e),"PlotRange"in o){o.PlotRange;(()=>{throw"not implemented"})(0,e.plotRange,e.panZoomEntites)}for(let r=0;r<t.length-Object.keys(o).length;++r)await interpretate(t[r],e)},yt.EdgeForm=async(t,e)=>{const o={...e};await interpretate(t[0],o),e.strokeWidth=o.strokeWidth,e.strokeOpacity=o.opacity,"rgb(68, 68, 68)"!==o.color&&(e.stroke=o.color)},yt.EdgeForm.update=async(t,e)=>{},yt.Opacity=async(t,e)=>{if(e.opacity=await interpretate(t[0],e),e.exposed.opacity=e.opacity,e.root.child){console.log("Dynamic env variable caught");const t={};e.exposed.opacityRefs=t,e.local.refs=t}return e.opacity},yt.Opacity.update=async(t,e)=>{const o=await interpretate(t[0],e),r=Object.values(e.local.refs);for(const t of r)t.execute({method:"updateOpacity",opacity:o})},yt.Opacity.destroy=(t,e)=>{delete e.local.refs},yt.Opacity.virtual=!0,yt.GrayLevel=async(t,e)=>{let o=await interpretate(t[0],e);return o.length&&(o=o[0]),o=Math.floor(255*o),e.color=`rgb(${o},${o},${o})`,e.color},yt.RGBColor=async(t,e)=>{let o;if(3==t.length)o="rgb(",o+=String(Math.floor(255*await interpretate(t[0],e)))+",",o+=String(Math.floor(255*await interpretate(t[1],e)))+",",o+=String(Math.floor(255*await interpretate(t[2],e)))+")";else{let r=await interpretate(t[0],e);r instanceof NumericArrayObject&&(r=r.normal()),o="rgb(",o+=String(Math.floor(255*r[0]))+",",o+=String(Math.floor(255*r[1]))+",",o+=String(Math.floor(255*r[2]))+")"}if(e.root.child){console.log("Dynamic env variable caught");const t={};e.exposed.colorRefs=t,e.local.refs=t}return e.exposed.color=o,e.color},yt.RGBColor.update=async(t,e)=>{let o;if(3==t.length)o="rgb(",o+=String(Math.floor(255*await interpretate(t[0],e)))+",",o+=String(Math.floor(255*await interpretate(t[1],e)))+",",o+=String(Math.floor(255*await interpretate(t[2],e)))+")";else{let r=await interpretate(t[0],e);r instanceof NumericArrayObject&&(r=r.normal()),o="rgb(",o+=String(Math.floor(255*r[0]))+",",o+=String(Math.floor(255*r[1]))+",",o+=String(Math.floor(255*r[2]))+")"}const r=Object.values(e.local.refs);for(const t of r)t.execute({method:"updateColor",color:o})},yt.RGBColor.destroy=(t,e)=>{delete e.local.refs},yt.RGBColor.virtual=!0;let At=(t,e,o,r=o-o*e/2,n=Math.min(r,1-r))=>[t,n?(o-r)/n:0,r];yt.Hue=async(t,e)=>{let o=await Promise.all(t.map((t=>interpretate(t,e))));if(o.length<3&&(o=[o[0],1,1]),o=At(...o),o=[o[0],(100*o[1]).toFixed(2),(100*o[2]).toFixed(2)],e.color="hsl("+(314*o[0]).toFixed(2)+","+o[1]+"%,"+o[2]+"%)",e.root.child){console.log("Dynamic env variable caught");const t={};e.exposed.colorRefs=t,e.local.refs=t}e.exposed.color=e.color},yt.Hue.update=async(t,e)=>{let o=await Promise.all(t.map((t=>interpretate(t,e))));o.length<3&&(o=[o[0],1,1]),o=At(...o),o=[o[0],(100*o[1]).toFixed(2),(100*o[2]).toFixed(2)];const r="hsl("+(314*o[0]).toFixed(2)+","+o[1]+"%,"+o[2]+"%)",n=Object.values(e.local.refs);for(const t of n)t.execute({method:"updateColor",color:r})},yt.Hue.destroy=(t,e)=>{delete e.local.refs},yt.Hue.virtual=!0,yt.CubicInOut=()=>"CubicInOut",yt.Linear=()=>"Linear",yt.Tooltip=()=>{console.log("Tooltip is not implemented.")},_t.List=core.List,_t.Polygon=async(t,e)=>{let o=await interpretate(t[0],e);if(!e.vertices)throw"No vertices provided!";e.local.line||(e.local.line=mt.line().x((function(t){return e.xAxis(t[0])})).y((function(t){return e.yAxis(t[1])})));const r=[];let n=e.color;return o[0][0]||(o=[o]),o.forEach((t=>{e.vertexColors&&(n=[0,0,0],t.map((t=>{if("string"==typeof e.vertexColors[t-1]){const o=mt.color(e.vertexColors[t-1]);n[0]=n[0]+o.r/255,n[1]=n[1]+o.g/255,n[2]=n[2]+o.b/255}else n[0]=n[0]+e.vertexColors[t-1][0],n[1]=n[1]+e.vertexColors[t-1][1],n[2]=n[2]+e.vertexColors[t-1][2]})),n[0]=255*n[0]/t.length,n[1]=255*n[1]/t.length,n[2]=255*n[2]/t.length,n="rgb("+n[0]+","+n[1]+","+n[2]+")"),r.push(e.svg.append("path").datum(t.map((t=>e.vertices[t-1]))).attr("fill",n).attr("fill-opacity",e.opacity).attr("stroke-opacity",e.strokeOpacity||e.opacity).attr("vector-effect","non-scaling-stroke").attr("stroke-width",e.strokeWidth).attr("stroke",e.stroke||n).attr("d",e.local.line))})),r},yt.Polygon=async(t,e)=>{let o=await interpretate(t[0],e);if(o instanceof NumericArrayObject&&(o=data.normal()),e.local.line=mt.line().x((function(t){return e.xAxis(t[0])})).y((function(t){return e.yAxis(t[1])})),Array.isArray(o[0][0])){console.log("most likely there are many polygons");const t=e.svg.append("g").attr("fill",e.color).attr("fill-opacity",e.opacity).attr("stroke-opacity",e.strokeOpacity||e.opacity).attr("vector-effect","non-scaling-stroke").attr("stroke-width",e.strokeWidth).attr("stroke",e.stroke||e.color);return o.forEach((o=>{o.push(o[0]),t.append("path").datum(o).attr("d",e.local.line)})),e.local.polygons=t,t}return o.push(o[0]),e.local.area=e.svg.append("path").datum(o).attr("fill",e.color).attr("fill-opacity",e.opacity).attr("stroke-opacity",e.strokeOpacity||e.opacity).attr("vector-effect","non-scaling-stroke").attr("stroke-width",e.strokeWidth).attr("stroke",e.stroke||e.color).attr("d",e.local.line),e.colorRefs&&(e.colorRefs[e.root.uid]=e.root),e.local.area},yt.Polygon.updateColor=(t,e)=>{if(e.local.polygons)for(const t of e.local.polygons)t.attr("fill",e.color);else e.local.object.attr("fill",e.color)},yt.Polygon.updateOpacity=(t,e)=>{if(e.local.polygons)for(const t of e.local.polygons)t.attr("fill-opacity",e.opacity),t.attr("stroke-opacity",e.strokeOpacity||e.opacity);else e.local.object.attr("fill-opacity",e.opacity),e.local.object.attr("stroke-opacity",e.strokeOpacity||e.opacity)},yt.Polygon.update=async(t,e)=>{let o=await interpretate(t[0],e);if(o instanceof NumericArrayObject&&(o=o.normal()),e.local.polygons)throw"update method for many polygons in not supported";e.xAxis,e.yAxis;return e.local.area.datum(o).maybeTransitionTween(e.transitionType,e.transitionDuration,"d",(function(t){var o=mt.select(this).attr("d"),r=e.local.line(t);return gt(o,r)}))},yt.Polygon.destroy=(t,e)=>{if(console.log("area destroyed"),e.local){if(e.colorRefs&&delete e.colorRefs[e.root.uid],e.opacityRefs&&delete e.opacityRefs[e.root.uid],e.local.area)return e.local.area.remove(),void delete e.local.area;e.local.polygons&&(e.local.polygons.remove(),delete e.local.polygons)}},yt.Polygon.virtual=!0,yt.IdentityFunction=async(t,e)=>await interpretate(t[0],e),yt.Tooltip=yt.IdentityFunction,yt.StatusArea=yt.IdentityFunction,yt["Charting`DelayedMouseEffect"]=yt.IdentityFunction,_t.Line=async(t,e)=>{console.log("drawing a line");let o=await interpretate(t[0],e);const r=e.xAxis,n=e.yAxis;if(o[0][0]){const t=e.svg.append("g");return t.attr("fill","none").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth),o.forEach((o=>{t.append("path").datum(o.map((t=>e.vertices[t-1]))).attr("vector-effect","non-scaling-stroke").attr("d",mt.line().x((function(t){return r(t[0])})).y((function(t){return n(t[1])})))})),t}return e.svg.append("path").datum(o.map((t=>e.vertices[t-1]))).attr("fill","none").attr("vector-effect","non-scaling-stroke").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",mt.line().x((function(t){return r(t[0])})).y((function(t){return n(t[1])})))},yt.BezierCurve=async(t,e)=>{let o=await interpretate(t[0],e);var r=mt.path();const n=e.xAxis,a=e.yAxis;o=o.map((t=>[n(t[0]),a(t[1])])),r.moveTo(...o[0]);let i=o.length-1;for(let t=1;t<o.length-2;t+=3)i-=3,r.bezierCurveTo(...o[t],...o[t+1],...o[t+2]);return i>0&&r.quadraticCurveTo(...o[o.length-2],...o[o.length-1]),e.svg.append("path").attr("fill","none").attr("vector-effect","non-scaling-stroke").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",r)},yt.Line=async(t,e)=>{e.offset;let o=await interpretate(t[0],e);o instanceof NumericArrayObject&&(o=o.normal());const r=e.xAxis,n=e.yAxis,a=uuidv4();let i;switch(e.local.uid=a,e.local.uid=a,ht(o)){case 0:i=e.svg.append("path").datum([]).attr("class","line-"+a).attr("fill","none").attr("vector-effect","non-scaling-stroke").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",mt.line().x((function(t){return r(t[0])})).y((function(t){return n(t[1])})));break;case 2:if(e.returnPath)throw i=null,"Not implemented!";i=e.svg.append("path").datum(o).attr("class","line-"+a).attr("vector-effect","non-scaling-stroke").attr("fill","none").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",mt.line().x((function(t){return r(t[0])})).y((function(t){return n(t[1])})));break;case 3:console.log(o),o.forEach(((t,o)=>{i=e.svg.append("path").datum(t).join("path").attr("class","line-"+a+"-"+o).attr("vector-effect","non-scaling-stroke").attr("fill","none").attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",mt.line().x((function(t){return r(t[0])})).y((function(t){return n(t[1])})))}))}return e.local.nsets=o.length,e.local.line=mt.line().x((function(t){return e.xAxis(t[0])})).y((function(t){return e.yAxis(t[1])})),e.local.object=i,e.colorRefs&&(e.colorRefs[e.root.uid]=e.root),i},yt.Line.updateColor=(t,e)=>{e.local.object.style("stroke",e.color)},yt.Line.update=async(t,e)=>{let o=await interpretate(t[0],e);o instanceof NumericArrayObject&&(o=o.normal());const r=e.xAxis,n=e.yAxis;let a;switch(ht(o)){case 0:a=e.svg.selectAll(".line-"+e.local.uid).datum([]).attr("class","line-"+e.local.uid).maybeTransitionTween(e.transitionType,e.transitionDuration,"d",(function(t){var o=mt.select(this).attr("d"),r=e.local.line(t);return gt(o,r)}));break;case 2:Math.min(o.length,e.local.nsets),a=e.svg.selectAll(".line-"+e.local.uid).datum(o).attr("class","line-"+e.local.uid).maybeTransitionTween(e.transitionType,e.transitionDuration,"d",(function(t){var o=mt.select(this).attr("d"),r=e.local.line(t);return gt(o,r)}));break;case 3:for(let t=0;t<Math.min(o.length,e.local.nsets);++t)console.log("upd 1"),a=e.svg.selectAll(".line-"+e.local.uid+"-"+t).datum(o[t]).attr("class","line-"+e.local.uid+"-"+t).maybeTransitionTween(e.transitionType,e.transitionDuration,"d",(function(t){var o=mt.select(this).attr("d"),r=e.local.line(t);return gt(o,r)}));if(o.length>e.local.nsets){console.log("upd 2"),console.log("new lines");for(let t=e.local.nsets;t<o.length;++t)a=e.svg.append("path").datum(o[t]).attr("class","line-"+e.local.uid+"-"+t).attr("fill","none").attr("stroke",e.color).attr("stroke-width",e.strokeWidth).maybeTransition(e.transitionType,e.transitionDuration).attr("d",mt.line().x((function(t){return r(t[0])})).y((function(t){return n(t[1])})))}if(o.length<e.local.nsets){console.log("upd 3");for(let t=o.length;t<e.local.nsets;++t)a=e.svg.selectAll(".line-"+e.local.uid+"-"+t).datum(o[0]).join("path").attr("class","line-"+e.local.uid+"-"+t).maybeTransition(e.transitionType,e.transitionDuration).attr("d",e.local.line)}}return e.local.nsets=Math.max(o.length,e.local.nsets),a},yt.Line.virtual=!0,yt.Line.destroy=(t,e)=>{console.log("nothing to destroy"),e.local&&e.local.object&&(Array.isArray(e.local.object)?e.local.object.forEach((t=>t.remove())):e.local.object.remove(),delete e.local.object)},yt.Circle=async(t,e)=>{let o=await interpretate(t[0],e);o instanceof NumericArrayObject&&(o=o.normal());let r=[1,1];t.length>1&&(r=await interpretate(t[1],e),Array.isArray(r)||(r=[r,r]));const n=e.xAxis,a=e.yAxis;e.local.coords=[n(o[0]),a(o[1])],e.local.r=[n(r[0])-n(0),Math.abs(a(r[1])-a(0))];const i=e.svg.append("ellipse").attr("vector-effect","non-scaling-stroke").attr("cx",n(o[0])).attr("cy",a(o[1])).attr("rx",e.local.r[0]).attr("ry",e.local.r[1]).style("stroke",e.color).style("fill","none").style("opacity",e.opacity);return e.local.object=i,e.colorRefs&&(e.colorRefs[e.root.uid]=e.root),e.opacityRefs&&(e.opacityRefs[e.root.uid]=e.root),i},yt.Circle.updateColor=(t,e)=>{e.local.object.style("stroke",e.color)},yt.Circle.updateOpacity=(t,e)=>{e.local.object.style("opacity",e.opacity)},yt.Circle.update=async(t,e)=>{let o=await interpretate(t[0],e);o instanceof NumericArrayObject&&(o=o.normal());let r=1;t.length>1&&(r=await interpretate(t[1],e),Array.isArray(r)||(r=[r,r]));const n=e.xAxis,a=e.yAxis;return e.local.r=[n(r[0])-n(0),Math.abs(a(r[1])-a(0))],e.local.object.maybeTransition(e.transitionType,e.transitionDuration).attr("cx",n(o[0])).attr("cy",a(o[1])).attr("rx",e.local.r[0]).attr("ry",e.local.r[1]),e.local.object},yt.Circle.destroy=(t,e)=>{e.local.object.remove(),e.colorRefs&&delete e.colorRefs[e.root.uid],e.opacityRefs&&delete e.opacityRefs[e.root.uid]},yt.Circle.virtual=!0;const kt=function(t){return 180*t/Math.PI},Tt=function(t){return t*Math.PI/180};function Ct(t,e,o,r,n,a){const{abs:i,sin:s,cos:l}=Math,c=i(o)*l(a),d=i(r)*s(a);return[t+l(n)*c-s(n)*d,e+s(n)*c+l(n)*d]}function Et([t,e],[o,r]){const{acos:n,sqrt:a}=Math;return(t*r-e*o<0?-1:1)*n((t*o+e*r)/(a(t*t+e*e)*a(o*o+r*r)))}yt._arc=async(t,e)=>{let o=await interpretate(t[0],e),r=await interpretate(t[1],e);Array.isArray(r)||(r=[r,r]);let n=(await interpretate(t[2],e)).map((t=>2*Math.PI-t));const a=e.xAxis,i=e.yAxis,s={cx:a(o[0]),cy:i(o[1]),phi:0,rx:a(r[0])-a(0),ry:Math.abs(i(r[1])-i(0)),start:n[0],delta:n[1]-n[0]};console.error(n);const{x1:l,y1:c,x2:d,y2:u,fa:p,fs:f}=function(t,e,o,r,n,a,i){const[s,l]=Ct(t,e,o,r,n,a),[c,d]=Ct(t,e,o,r,n,a+i);return{x1:s,y1:l,x2:c,y2:d,fa:Math.abs(i)>Math.PI?1:0,fs:i>0?1:0}}(s.cx,s.cy,s.rx,s.ry,s.phi,s.start,s.delta),{cx:h,cy:m,theta:g,dTheta:y}=function(t,e,o,r,n,a,i,s,l){const{abs:c,sin:d,cos:u,sqrt:p}=Math,f=t=>Math.pow(t,2),h=d(l),m=u(l),g=m*(t-o)/2+h*(e-r)/2,y=-h*(t-o)/2+m*(e-r)/2,_=f(g),b=f(y),v=f(i),x=f(s),w=_/v+b/x;w>1?(i=p(w)*c(i),s=p(w)*c(s)):(i=c(i),s=c(s));const A=n===a?-1:1,k=p((v*x-v*b-x*_)/(v*b+x*_))*A,T=k*(i*y)/s,C=k*(-s*g)/i,E=m*T-h*C+(t+o)/2,S=h*T+m*C+(e+r)/2,O=Et([1,0],[(g-T)/i,(y-C)/s]);let R=kt(Et([(g-T)/i,(y-C)/s],[(-g-T)/i,(-y-C)/s]))%360;return 0===a&&R>0&&(R-=360),1===a&&R<0&&(R+=360),{cx:E,cy:S,theta:O,dTheta:Tt(R)}}(l,c,d,u,p,f,s.rx,s.ry,s.phi);return e.svg.append("path").attr("vector-effect","non-scaling-stroke").style("fill",e.color).style("opacity",e.opacity).attr("d",`M ${h} ${m}\n         L ${l} ${c}\n         A ${s.rx} ${s.ry} ${kt(s.phi)} ${p} ${f} ${d} ${u}\n         Z`)},_t.Disk=async(t,e)=>{if(t.length>2)throw"Graphics complex with arcs is not supported";let o=await interpretate(t[0],e),r=1;t.length>1&&(r=await interpretate(t[1],e),Array.isArray(r)&&(r=(r[0]+r[1])/2));const n=e.xAxis,a=e.yAxis;if(o[0]){const t=[],i=n(r)-n(0);return o.map((t=>e.vertices[t-1])).map((o=>{t.push(e.svg.append("circle").attr("vector-effect","non-scaling-stroke").attr("cx",n(o[0])).attr("cy",a(o[1])).attr("r",i).style("stroke","none").style("fill",e.color).style("opacity",e.opacity))})),t}{const t=e.vertices[o-1],i=[n(t[0]),a(t[1])],s=n(r)-n(0);return e.svg.append("circle").attr("vector-effect","non-scaling-stroke").attr("cx",i[0]).attr("cy",i[1]).attr("r",s).style("stroke","none").style("fill",e.color).style("opacity",e.opacity)}},yt.Disk=async(t,e)=>{if(t.length>2)return await yt._arc(t,e);let o=await interpretate(t[0],e);o instanceof NumericArrayObject&&(o=o.normal());let r=[1,1];t.length>1&&(r=await interpretate(t[1],e),Array.isArray(r)||(r=[r,r]));const n=e.xAxis,a=e.yAxis;e.local.coords=[n(o[0]),a(o[1])],e.local.r=[n(r[0])-n(0),Math.abs(a(r[1])-a(0))];const i=e.svg.append("ellipse").attr("vector-effect","non-scaling-stroke").attr("cx",n(o[0])).attr("cy",a(o[1])).attr("rx",e.local.r[0]).attr("ry",e.local.r[1]).style("stroke","none").style("fill",e.color).style("opacity",e.opacity);return e.local.object=i,e.colorRefs&&(e.colorRefs[e.root.uid]=e.root),e.opacityRefs&&(e.opacityRefs[e.root.uid]=e.root),i},yt.Disk.update=async(t,e)=>{let o=await interpretate(t[0],e);o instanceof NumericArrayObject&&(o=o.normal());let r=e.local.r;t.length>1&&(r=await interpretate(t[1],e),Array.isArray(r)||(r=[r,r]));const n=e.xAxis,a=e.yAxis;e.local.coords=[n(o[0]),a(o[1])],e.local.r=[n(r[0])-n(0),Math.abs(a(r[1])-a(0))],e.local.object.maybeTransition(e.transitionType,e.transitionDuration).attr("cx",e.local.coords[0]).attr("cy",e.local.coords[1]).attr("rx",e.local.r[0]).attr("ry",e.local.r[1])},yt.Disk.updateColor=(t,e)=>{e.local.object.style("fill",e.color)},yt.Disk.updateOpacity=(t,e)=>{e.local.object.style("opacity",e.opacity)},yt.Disk.virtual=!0,yt.Disk.destroy=(t,e)=>{console.log("nothing to destroy"),e.local&&e.local.object&&(e.colorRefs&&delete e.colorRefs[e.root.uid],e.opacityRefs&&delete e.opacityRefs[e.root.uid],e.local.object.remove(),delete e.local.object)},_t.Point=async(t,e)=>{let o=await interpretate(t[0],e);const r=e.xAxis,n=e.yAxis;o[0][0]&&(o=o.flat()),o=o.map((t=>e.vertices[t-1]));const a=e.svg.append("g").style("stroke-width",100*e.pointSize*2).style("stroke-linecap","round").style("stroke",e.color).style("opacity",e.opacity),i=[];let s;return o.forEach(((t,o)=>{if(e.vertexColors){if(s=[0,0,0],"string"==typeof e.vertexColors[o]){const t=mt.color(e.vertexColors[o]);s[0]=s[0]+t.r/255,s[1]=s[1]+t.g/255,s[2]=s[2]+t.b/255}else s[0]=s[0]+e.vertexColors[o][0],s[1]=s[1]+e.vertexColors[o][1],s[2]=s[2]+e.vertexColors[o][2];s[0]=255*s[0],s[1]=255*s[1],s[2]=255*s[2],s="rgb("+s[0]+","+s[1]+","+s[2]+")",i.push(a.append("path").attr("stroke",s).attr("d",`M ${r(t[0])} ${n(t[1])} l 0.0001 0`).attr("vector-effect","non-scaling-stroke"))}else i.push(a.append("path").attr("d",`M ${r(t[0])} ${n(t[1])} l 0.0001 0`).attr("vector-effect","non-scaling-stroke"))})),a},yt.Point=async(t,e)=>{let o=await interpretate(t[0],e);o instanceof NumericArrayObject&&(o=o.normal());const r=e.xAxis,n=e.yAxis,a=ht(o);0===a?o=[]:a<2&&(o=[o]);const i=uuidv4();e.local.uid=i;const s=e.svg.append("g").style("stroke-width",100*e.pointSize*2).style("stroke-linecap","round").style("stroke",e.color).style("opacity",e.opacity);e.colorRefs&&(e.colorRefs[e.root.uid]=e.root),e.opacityRefs&&(e.opacityRefs[e.root.uid]=e.root);const l=[];return o.forEach(((t,e)=>{l.push(s.append("path").attr("d",`M ${r(t[0])} ${n(t[1])} l 0.0001 0`).attr("vector-effect","non-scaling-stroke"))})),e.local.points=l,e.local.object=s,s},yt.Point.updateColor=(t,e)=>{e.local.object.style("stroke",e.color)},yt.Point.updateOpacity=(t,e)=>{e.local.object.style("opacity",e.opacity)},yt.Point.update=async(t,e)=>{let o=await interpretate(t[0],e);o instanceof NumericArrayObject&&(o=o.normal());const r=ht(o);0===r?o=[]:r<2&&(o=[o]);const n=e.xAxis,a=e.yAxis;let i;const s=e.local.object,l=Math.min(e.local.points.length,o.length);let c=[0,0];for(let t=e.local.points.length;t<o.length;t++)t-1>=0&&(c=o[t-1]),i=s.append("path").attr("d",`M ${n(c[0])} ${a(c[1])} l 0.0001 0`).style("opacity",e.opacity/5).attr("vector-effect","non-scaling-stroke"),e.local.points.push(i),i=i.maybeTransition(e.transitionType,e.transitionDuration).attr("d",`M ${n(o[t][0])} ${a(o[t][1])} l 0.0001 0`).style("opacity",e.opacity);for(let t=e.local.points.length;t>o.length;t--)i=e.local.points.pop(),i.maybeTransition(e.transitionType,e.transitionDuration).style("opacity",0).remove();for(let t=0;t<l;t++)i=e.local.points[t].maybeTransition(e.transitionType,e.transitionDuration).attr("d",`M ${n(o[t][0])} ${a(o[t][1])} l 0.0001 0`);return i},yt.Point.virtual=!0,yt.Point.destroy=(t,e)=>{console.log("nothing to destroy"),e.local&&e.local.object&&(e.colorRefs&&delete e.colorRefs[e.root.uid],Array.isArray(e.local.object)?e.local.object.forEach((t=>t.remove())):e.local.object.remove(),delete e.local.object)},yt.EventListener=async(t,e)=>{const o=await interpretate(t[1],e),r={...e};let n=await interpretate(t[0],r);return Array.isArray(n)&&(n=n[0]),n.on_list||(n.on_list={}),o.forEach((t=>{yt.EventListener[t.lhs](t.rhs,n,r)})),null},yt.EventListener.update=async(t,e)=>{console.log("EventListener does not support updates")},yt.EventListener.onload=(t,e,o)=>{console.log("onload event generator"),server.kernel.emitt(t,"True","onload")},yt.MiddlewareListener=async(t,e)=>{const o=await core._getRules(t,e),r=await interpretate(t[1],e),n=await interpretate(t[2],e);return console.log(t),e.local.middleware=yt.MiddlewareListener[r](n,o,e),await interpretate(t[0],e)},yt.MiddlewareListener.update=(t,e)=>interpretate(t[0],e),yt.MiddlewareListener.end=(t,e,o)=>{const r=e.Threshold||1;return server.kernel.emitt(t,"True","end"),console.log("pre Fire"),e=>{let o=!1;return e.then((e=>e.tween(t,(function(e){return function(e){e>=r&&!o&&(server.kernel.emitt(t,"True","end"),o=!0)}}))))}},yt.MiddlewareListener.endtransition=yt.MiddlewareListener.end,yt.EventListener.drag=(t,e,o)=>{console.log("drag event generator"),console.log(o.local);const r=o.xAxis,n=o.yAxis;let a=[];const i=throttle(((e,o)=>{server.kernel.emitt(t,`{${e}, ${o}}`.replace("e","*^").replace("e","*^"),"drag")}));e.call(mt.drag().on("start",(function(t,e){0===a.length&&(a=[t.x,t.y])})).on("drag",(function(t,e){mt.select(this).raise().attr("transform",(e=>"translate("+[t.x-a[0],t.y-a[1]]+")")),i(r.invert(t.x),n.invert(t.y))})).on("end",(function(t,e){})))},yt.EventListener.dragall=(t,e,o)=>{console.log("drag event generator"),console.log(o.local);const r=o.xAxis,n=o.yAxis;const a=throttle(((e,o,r)=>{server.kernel.emitt(t,`{"${r}", {${e}, ${o}}}`.replace("e","*^").replace("e","*^"),"dragall")}));e.call(mt.drag().on("start",(function(t,e){a(r.invert(t.x),n.invert(t.y),"dragstarted")})).on("drag",(function(t,e){a(r.invert(t.x),n.invert(t.y),"dragged")})).on("end",(function(t,e){a(r.invert(t.x),n.invert(t.y),"dragended")})))},yt.EventListener.click=(t,e,o)=>{console.log("click event generator"),console.log(o.local);const r=o.xAxis,n=o.yAxis,a=throttle(((e,o)=>{server.kernel.emitt(t,`{${e}, ${o}}`.replace("e","*^").replace("e","*^"),"click")}));function i(t,e){t.altKey||a(r.invert(e[0]),n.invert(e[1]))}"click"in e.on_list?e.on_list.click.push((t=>i(t,mt.pointer(t)))):(e.on_list.click=[t=>i(t,mt.pointer(t))],e.on("click",(t=>{for(let o=0;o<e.on_list.click.length;++o)e.on_list.click[o](t)})))},yt.EventListener.mousedown=(t,e,o)=>{console.log("mousedown event generator"),console.log(o.local);const r=o.xAxis,n=o.yAxis,a=throttle(((e,o)=>{server.kernel.emitt(t,`{${e}, ${o}}`.replace("e","*^").replace("e","*^"),"mousedown")}));e.on("mousedown",(t=>{return e=mt.pointer(t),void a(r.invert(e[0]),n.invert(e[1]));var e}))},yt.EventListener.mouseup=(t,e,o)=>{console.log("mouseup event generator"),console.log(o.local);const r=o.xAxis,n=o.yAxis,a=throttle(((e,o)=>{server.kernel.emitt(t,`{${e}, ${o}}`.replace("e","*^").replace("e","*^"),"mouseup")}));e.on("mouseup",(t=>{return e=mt.pointer(t),void a(r.invert(e[0]),n.invert(e[1]));var e}))},yt.EventListener.altclick=(t,e,o)=>{console.log("click event generator"),console.log(o.local);const r=o.xAxis,n=o.yAxis,a=throttle(((e,o)=>{server.kernel.emitt(t,`{${e}, ${o}}`.replace("e","*^").replace("e","*^"),"altclick")}));function i(t,e){t.altKey&&a(r.invert(e[0]),n.invert(e[1]))}"click"in e.on_list?e.on_list.click.push((t=>i(t,mt.pointer(t)))):(e.on_list.click=[t=>i(t,mt.pointer(t))],e.on("click",(t=>{for(let o=0;o<e.on_list.click.length;++o)e.on_list.click[o](t)})))},yt.EventListener.capturekeydown=(t,e,o)=>{let r,n=!0;const a=e;r=()=>{n&&(a.node().focus(),n=!1)};var i;i=r,"click"in e.on_list?e.on_list.click.push(i):(e.on_list.click=[i],e.on("click",(t=>{for(let o=0;o<e.on_list.click.length;++o)e.on_list.click[o](t)}))),a.on("blur",(()=>{n=!0})),a.node().addEventListener("keydown",(e=>{server.kernel.emitt(t,'"'+e.code+'"',"capturekeydown"),e.preventDefault()}))},yt.EventListener.keydown=(t,e,o)=>{let r,n=!0;const a=e;r=()=>{n&&(a.node().focus(),n=!1)};var i;i=r,"click"in e.on_list?e.on_list.click.push(i):(e.on_list.click=[i],e.on("click",(t=>{for(let o=0;o<e.on_list.click.length;++o)e.on_list.click[o](t)}))),a.on("blur",(()=>{n=!0})),a.addEventListener("keydown",(e=>{server.kernel.emitt(t,'"'+e.code+'"',"keydown")}))},yt.EventListener.mousemove=(t,e,o)=>{console.log("mouse event generator"),console.log(o.local);const r=o.xAxis,n=o.yAxis,a=throttle(((e,o)=>{server.kernel.emitt(t,`{${e}, ${o}}`.replace("e","*^").replace("e","*^"),"mousemove")}));e.on("mousemove",(t=>{return e=mt.pointer(t),void a(r.invert(e[0]),n.invert(e[1]));var e}))},yt.EventListener.mouseover=(t,e,o)=>{console.log("mouse event generator"),console.log(o.local);const r=o.xAxis,n=o.yAxis,a=throttle(((e,o)=>{server.kernel.emitt(t,`{${e}, ${o}}`.replace("e","*^").replace("e","*^"),"mouseover")}));e.on("mouseover",(t=>{return e=mt.pointer(t),void a(r.invert(e[0]),n.invert(e[1]));var e}))},yt.EventListener.zoom=(t,e,o)=>{console.log("zoom event generator"),console.log(o.local);const r=throttle((e=>{server.kernel.emitt(t,`${e}`,"zoom")}));e.call(mt.zoom().on("zoom",(function(t){console.log(),r(t.transform.k)})))},yt.Rotate=async(t,e)=>{const o=await interpretate(t[1],e);let r;t.length>2&&(r=await interpretate(t[2],e),e.local.aligment=r);const n=e.svg.append("g");e.local.group=n,await interpretate(t[0],{...e,svg:n});let a=n.node().getBBox();r?(a.x=e.xAxis(r[0]),a.y=e.yAxis(r[1])):(a.x=a.x+a.width/2,a.y=a.y+a.height/2);const i="rotate("+o/Math.PI*180+", "+a.x+", "+a.y+")";n.attr("transform",i),e.local.rotation=i},yt.Rotate.update=async(t,e)=>{const o=await interpretate(t[1],e);let r;r=e.local.group.node().getBBox(),e.local.aligment?(r.x=e.xAxis(e.local.aligment[0]),r.y=e.yAxis(e.local.aligment[1])):(r.x=r.x+r.width/2,r.y=r.y+r.height/2);const n="rotate("+o/Math.PI*180+", "+r.x+", "+r.y+")";var a=mt.interpolateString(e.local.rotation,n);e.local.group.maybeTransitionTween(e.transitionType,e.transitionDuration,"transform",(function(t,e,o){return a})),e.local.rotation=n},yt.Rotate.virtual=!0,yt.Rotate.destroy=(t,e)=>{console.log("nothing to destroy")},yt.Translate=async(t,e)=>{const o=await interpretate(t[1],e),r=e.svg.append("g");e.local.group=r;const n=e.xAxis,a=e.yAxis;return await interpretate(t[0],{...e,svg:r}),r.attr("transform",`translate(${n(o[0])-n(0)}, ${a(o[1])-a(0)})`)},yt.Translate.update=async(t,e)=>{let o=await interpretate(t[1],e);o instanceof NumericArrayObject&&(o=o.normal());const r=e.xAxis,n=e.yAxis;return e.local.group.maybeTransition(e.transitionType,e.transitionDuration).attr("transform",`translate(${r(o[0])-r(0)}, ${n(o[1])-n(0)})`)},yt.Translate.virtual=!0,yt.Translate.destroy=(t,e)=>{console.log("nothing to destroy")},yt.Center=()=>"Center",yt.Center.update=yt.Center,yt.Degree=()=>Math.PI/180,yt.Degree.update=yt.Degree,yt.Rectangle=async(t,e)=>{let o=await interpretate(t[0],e),r=await interpretate(t[1],e);if(o instanceof NumericArrayObject&&(o=o.normal()),r instanceof NumericArrayObject&&(r=r.normal()),o[1]>r[1]){const t=o[1];o[1]=r[1],r[1]=t}if(o[0]>r[0]){const t=o[0];o[0]=r[0],r[0]=t}const n=e.xAxis,a=e.yAxis;o[0]=n(o[0]),o[1]=a(o[1]),r[0]=n(r[0]),r[1]=a(r[1]);const i=[Math.abs(r[0]-o[0]),Math.abs(r[1]-o[1])];return e.local.rect=e.svg.append("rect").attr("x",o[0]).attr("y",o[1]-i[1]).attr("width",i[0]).attr("height",i[1]).attr("vector-effect","non-scaling-stroke").attr("stroke",e.stroke).attr("opacity",e.opacity).attr("fill",e.color),e.colorRefs&&(e.colorRefs[e.root.uid]=e.root),e.opacityRefs&&(e.opacityRefs[e.root.uid]=e.root),e.local.rect},yt.Rectangle.updateColor=(t,e)=>{e.local.rect.attr("fill",e.color)},yt.Rectangle.updateOpacity=(t,e)=>{e.local.rect.attr("opacity",e.opacity)},yt.Rectangle.update=async(t,e)=>{let o=await interpretate(t[0],e),r=await interpretate(t[1],e);if(o instanceof NumericArrayObject&&(o=o.normal()),r instanceof NumericArrayObject&&(r=r.normal()),o[1]>r[1]){const t=o[1];o[1]=r[1],r[1]=t}if(o[0]>r[0]){const t=o[0];o[0]=r[0],r[0]=t}const n=e.xAxis,a=e.yAxis;o[0]=n(o[0]),o[1]=a(o[1]),r[0]=n(r[0]),r[1]=a(r[1]);const i=[Math.abs(r[0]-o[0]),Math.abs(r[1]-o[1])];e.local.rect.maybeTransition(e.transitionType,e.transitionDuration).attr("x",o[0]).attr("y",o[1]-i[1]).attr("width",i[0]).attr("height",i[1])},yt.Rectangle.virtual=!0,yt.Rectangle.destroy=(t,e)=>{console.log("nothing to destroy"),e.local&&e.local.rect&&(e.colorRefs&&delete e.colorRefs[e.root.uid],e.opacityRefs&&delete e.opacityRefs[e.root.uid],e.local.rect.remove(),delete e.local.rect)},yt.Void=(t,e)=>{},yt.Identity=yt.Void,yt.Scaled=yt.Void,yt.GoldenRatio=yt.Void,yt.None=()=>!1,yt.AbsolutePointSize=yt.Void,yt.CopiedValueFunction=yt.Void,yt.Raster=async(t,e)=>{if(e.image)return await interpretate(t[0],e);const o=await interpretate(t[0],{...e,context:yt,nfast:!0,numeric:!0});console.log(t);const r=o.length,n=o[0].length,a=o[0][0].length,i=e.xAxis,s=e.yAxis;let l=[[0,n],[0,r]];if(t.length>1){const o=await interpretate(t[1],e);l[0][0]=o[0][0],l[0][1]=o[1][0],l[1][0]=o[0][1],l[1][1]=o[1][1]}t.length>2&&(await interpretate(t[2],e),console.warn("scaling is not implemented!"));const c=Math.abs((i(l[0][1])-i(l[0][0]))/n),d=Math.abs((s(l[1][1])-s(l[1][0]))/r),u=(l[0][1]-l[0][0])/n,p=(l[1][1]-l[1][0])/r,f=e.svg;if(a)if(2!==a)if(3!==a)if(4!==a);else for(let t=0;t<r;++t)for(let e=0;e<n;++e)f.append("rect").attr("x",i(u*e+l[0][0])).attr("y",s(p*t+l[1][0])-d).attr("width",c).attr("height",d).attr("opacity",o[t][e][3]).attr("fill",`rgb(${Math.floor(255*o[t][e][0])}, ${Math.floor(255*o[t][e][1])}, ${Math.floor(255*o[t][e][2])})`);else for(let t=0;t<r;++t)for(let r=0;r<n;++r)f.append("rect").attr("x",i(u*r+l[0][0])).attr("y",s(p*t+l[1][0])-d).attr("width",c).attr("height",d).attr("opacity",e.opacity).attr("fill",`rgb(${Math.floor(255*o[t][r][0])}, ${Math.floor(255*o[t][r][1])}, ${Math.floor(255*o[t][r][2])})`);else for(let t=0;t<r;++t)for(let e=0;e<n;++e)f.append("rect").attr("x",i(u*e+l[0][0])).attr("y",s(p*t+l[1][0])-d).attr("width",c).attr("height",d).attr("opacity",o[t][e][1]).attr("fill",`rgb(${Math.floor(255*o[t][e][0])}, ${Math.floor(255*o[t][e][0])}, ${Math.floor(255*o[t][e][0])})`);else for(let t=0;t<r;++t)for(let r=0;r<n;++r)f.append("rect").attr("x",i(u*r+l[0][0])).attr("y",s(p*t+l[1][0])-d).attr("width",c).attr("height",d).attr("opacity",e.opacity).attr("fill",`rgb(${Math.floor(255*o[t][r])}, ${Math.floor(255*o[t][r])}, ${Math.floor(255*o[t][r])})`)},yt.Magnification=()=>"Magnification",yt.ColorSpace=()=>"ColorSpace",yt.Interleaving=()=>"Interleaving",yt.MetaInformation=()=>"MetaInformation",yt.ImageResolution=()=>"ImageResolution",yt.DateObject=()=>{console.warn("Date Object is not supported for now")};const St={TypeReal:{},TypeInteger:{}},Ot={Real64:{context:St.TypeReal,constructor:Float64Array},Real32:{context:St.TypeReal,constructor:Float32Array},Integer32:{context:St.TypeInteger,constructor:Int32Array},Integer64:{context:St.TypeInteger,constructor:BigInt64Array},Integer16:{context:St.TypeInteger,constructor:Int16Array},Integer8:{context:St.TypeInteger,constructor:Int8Array},UnsignedInteger32:{context:St.TypeInteger,constructor:Uint32Array},UnsignedInteger64:{context:St.TypeInteger,constructor:BigUint64Array},UnsignedInteger16:{context:St.TypeInteger,constructor:Uint16Array},UnsignedInteger8:{context:St.TypeInteger,constructor:Uint8Array}};function Rt(t,e=[]){return Array.isArray(t)?(e.push(t.length),Rt(t[0],e)):e}const Lt=new RegExp(/^(-?\d+)(.?\d*)(\*\^)?(\d*)/),Ft=window.isNumeric;function It(t,e){if(Array.isArray(t[1]))for(let o=1;o<t.length;++o)It(t[o],e);else e.array.set(t.slice(1).map((t=>{if("string"==typeof t){if(Ft(t))return parseInt(t);if(Lt.test(t)){let[e,o,r,n,a]=t.split(Lt);return o+="."===r?r+"0":r,n&&(o+="E"+a),parseFloat(o)}}return t})),e.index),e.index+=t.length-1}function Dt(t,e,o){var r,n=0;for(r=0;r<o<<2;)e[r++]=255*t[n++]>>>0,e[r++]=255*t[n++]>>>0,e[r++]=255*t[n++]>>>0,e[r++]=255*t[n++]>>>0}function zt(t,e,o){var r,n=0;const a=new Uint32Array(e.buffer);for(r=0;r<o;r++)a[r]=4278190080+(255*t[n++]>>>0)+(255*t[n++]>>>0<<8)+(255*t[n++]>>>0<<16)}function Mt(t,e,o){var r;const n=new Uint32Array(e.buffer);for(r=0;r<o;r++){const e=255*t[r]>>>0;n[r]=4278190080+(e<<16)+(e<<8)+e}}St.NumericArray=(t,e)=>{const o=Ot[interpretate(t[1])],r=[];let n=t[0].length-1;r.push(n),"List"===t[0][1][0]&&(n*=t[0][1].length-1,r.push(t[0][1].length-1),"List"===t[0][1][1][0]&&(n*=t[0][1][1].length-1,r.push(t[0][1][1].length-1)));const a=new o.constructor(n);return It(t[0],{index:0,array:a}),{buffer:a,dims:r}},St.NumericArray.update=St.NumericArray;const Pt={Byte:{constructor:Uint8Array,convert:t=>{if(3===t.dims.length){if(4===t.dims[2]){return new Uint8ClampedArray(t.buffer)}if(3===t.dims[2]){const e=t.dims[0]*t.dims[1],o=new Uint8ClampedArray(e<<2);return function(t,e,o){var r,n=0;const a=new Uint32Array(e.buffer);for(r=0;r<o;r++)a[r]=4278190080+t[n++]+(t[n++]<<8)+(t[n++]<<16)}(t.buffer,o,e),o}throw"It must be RGB or RGBA!"}if(2===t.dims.length){const e=t.dims[0]*t.dims[1],o=new Uint8ClampedArray(e<<2);return function(t,e,o){var r;const n=new Uint32Array(e.buffer);for(r=0;r<o;r++){const e=t[r];n[r]=4278190080+(e<<16)+(e<<8)+e}}(t.buffer,o,e),o}throw"This is not an image data!"}},Bit:{constructor:Uint8Array,convert:t=>{const e=t.dims[0]*t.dims[1],o=new Uint8ClampedArray(e<<2);return function(t,e,o){var r;const n=new Uint32Array(e.buffer);for(r=0;r<o;r++){const e=t[r]<<8;n[r]=4278190080+(e<<16)+(e<<8)+e}}(t.buffer,o,e),o}},Real32:{constructor:Float32Array,convert:t=>{if(3===t.dims.length){if(4===t.dims[2]){const e=t.dims[0]*t.dims[1],o=new Uint8ClampedArray(e<<2);return Dt(t.buffer,o,e),o}if(3===t.dims[2]){const e=t.dims[0]*t.dims[1],o=new Uint8ClampedArray(e<<2);return zt(t.buffer,o,e),o}throw"It must be RGB or RGBA!"}if(2===t.dims.length){const e=t.dims[0]*t.dims[1],o=new Uint8ClampedArray(e<<2);return Mt(t.buffer,o,e),o}throw"This is not an image data!"}},Real64:{contructor:Float64Array,convert:t=>{if(3===t.dims.length){if(4===t.dims[2]){const e=t.dims[0]*t.dims[1],o=new Uint8ClampedArray(e<<2);return Dt(t.buffer,o,e),o}if(3===t.dims[2]){const e=t.dims[0]*t.dims[1],o=new Uint8ClampedArray(e<<2);return zt(t.buffer,o,e),o}throw"It must be RGB or RGBA!"}if(2===t.dims.length){const e=t.dims[0]*t.dims[1],o=new Uint8ClampedArray(e<<2);return Mt(t.buffer,o,e),o}throw"This is not an image data!"}}};yt.Antialiasing=()=>"Antialiasing",yt.Image=async(t,e)=>{const o=await core._getRules(t,{...e,context:yt}),r=performance.now(),n=[];console.log(t);let a=await interpretate(t[0],{...e,context:[St,yt]});n.push(performance.now()-r+" passed");let i,s="Real32";t.length-Object.keys(o).length>1&&(s=interpretate(t[1])),s=Pt[s],Array.isArray(a)&&(console.warn("Will be slow. Not a typed array"),a={buffer:a.flat(1/0),dims:Rt(a)}),i=s.convert(a),n.push(performance.now()-r+" passed"),e.local.type=s,console.warn("ImageSize"),console.warn(a.dims);const l=a.dims[0],c=a.dims[1];e.local.dims=a.dims,console.log({imageData:i,width:c,height:l}),i=new ImageData(new Uint8ClampedArray(i),c,l),n.push(performance.now()-r+" passed");let d=o.ImageSize;o.Magnification&&(d=Math.floor(c*o.Magnification)),d||(d=e.imageSize?e.imageSize:c),Array.isArray(d)&&(d=d[0]);const u=Math.floor(d),p=Math.floor(l/c*d);let f;console.warn("ImageSize"),console.warn({target_width:u,target_height:p}),e.local.targetDims=[p,u];const h=window.devicePixelRatio;var m=document.createElement("canvas");return m.width=u,m.height=p,e.element.appendChild(m),m.style.width=u/h+"px",m.style.height=p/h+"px",f=m.getContext("2d"),e.local.ctx=f,"Antialiasing"in o&&(f.imageSmoothingEnabled=o.Antialiasing),n.push(performance.now()-r+" passed"),u!=c||p!=l?(e.local.resized=!0,console.warn("Resizing might be slow"),i=await createImageBitmap(i),f.drawImage(i,0,0,u,p)):f.putImageData(i,0,0),m},yt.Image.update=async(t,e)=>{let o=await interpretate(t[0],{...e,context:[St,yt]});Array.isArray(o)&&(console.warn("Image:update: not a typed array. It will be slow..."),o={buffer:o.flat(1/0),dims:Rt(o)});let r=e.local.type.convert(o);r=new ImageData(new Uint8ClampedArray(r),e.local.dims[1],e.local.dims[0]),e.local.resized?(r=await createImageBitmap(r),e.local.ctx.clearRect(0,0,e.local.targetDims[1],e.local.targetDims[0]),e.local.ctx.drawImage(r,0,0,e.local.targetDims[1],e.local.targetDims[0])):e.local.ctx.putImageData(r,0,0)},yt.Image.destroy=(t,e)=>{},yt.Image.virtual=!0,yt.Graphics.virtual=!0,yt.GraphicsGroupBox=yt.GraphicsGroup,yt.GraphicsComplexBox=yt.GraphicsComplex,yt.DiskBox=yt.Disk,yt.LineBox=yt.Line;
