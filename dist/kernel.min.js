function t(t,e){var o=t.__state.conversionName.toString(),n=Math.round(t.r),r=Math.round(t.g),i=Math.round(t.b),a=t.a,s=Math.round(t.h),l=t.s.toFixed(1),c=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===o||"SIX_CHAR_HEX"===o){for(var d=t.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}return"CSS_RGB"===o?"rgb("+n+","+r+","+i+")":"CSS_RGBA"===o?"rgba("+n+","+r+","+i+","+a+")":"HEX"===o?"0x"+t.hex.toString(16):"RGB_ARRAY"===o?"["+n+","+r+","+i+"]":"RGBA_ARRAY"===o?"["+n+","+r+","+i+","+a+"]":"RGB_OBJ"===o?"{r:"+n+",g:"+r+",b:"+i+"}":"RGBA_OBJ"===o?"{r:"+n+",g:"+r+",b:"+i+",a:"+a+"}":"HSV_OBJ"===o?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===o?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var e=Array.prototype.forEach,o=Array.prototype.slice,n={BREAK:{},extend:function(t){return this.each(o.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(o){this.isUndefined(e[o])||(t[o]=e[o])}.bind(this))}),this),t},defaults:function(t){return this.each(o.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(o){this.isUndefined(t[o])&&(t[o]=e[o])}.bind(this))}),this),t},compose:function(){var t=o.call(arguments);return function(){for(var e=o.call(arguments),n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},each:function(t,o,n){if(t)if(e&&t.forEach&&t.forEach===e)t.forEach(o,n);else if(t.length===t.length+0){var r,i=void 0;for(i=0,r=t.length;i<r;i++)if(i in t&&o.call(n,t[i],i)===this.BREAK)return}else for(var a in t)if(o.call(n,t[a],a)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,o){var n=void 0;return function(){var r=this,i=arguments;var a=o||!n;clearTimeout(n),n=setTimeout((function(){n=null,o||t.apply(r,i)}),e),a&&t.apply(r,i)}},toArray:function(t){return t.toArray?t.toArray():o.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},r=[{litmus:n.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:t},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:t},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:t},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:t}}},{litmus:n.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:n.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:n.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(n.isNumber(t.r)&&n.isNumber(t.g)&&n.isNumber(t.b)&&n.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(n.isNumber(t.r)&&n.isNumber(t.g)&&n.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(n.isNumber(t.h)&&n.isNumber(t.s)&&n.isNumber(t.v)&&n.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(n.isNumber(t.h)&&n.isNumber(t.s)&&n.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],i=void 0,a=void 0,s=function(){a=!1;var t=arguments.length>1?n.toArray(arguments):arguments[0];return n.each(r,(function(e){if(e.litmus(t))return n.each(e.conversions,(function(e,o){if(i=e.read(t),!1===a&&!1!==i)return a=i,i.conversionName=o,i.conversion=e,n.BREAK})),n.BREAK})),a},l=void 0,c={hsv_to_rgb:function(t,e,o){var n=Math.floor(t/60)%6,r=t/60-Math.floor(t/60),i=o*(1-e),a=o*(1-r*e),s=o*(1-(1-r)*e),l=[[o,s,i],[a,o,i],[i,o,s],[i,a,o],[s,i,o],[o,i,a]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,o){var n=Math.min(t,e,o),r=Math.max(t,e,o),i=r-n,a=void 0;return 0===r?{h:NaN,s:0,v:0}:(a=t===r?(e-o)/i:e===r?2+(o-t)/i:4+(t-e)/i,(a/=6)<0&&(a+=1),{h:360*a,s:i/r,v:r/255})},rgb_to_hex:function(t,e,o){var n=this.hex_with_component(0,2,t);return n=this.hex_with_component(n,1,e),n=this.hex_with_component(n,0,o)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,o){return o<<(l=8*e)|t&~(255<<l)}},d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},p=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),h=function t(e,o,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,o);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,o,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0},f=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},g=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},m=function(){function e(){if(u(this,e),this.__state=s.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return p(e,[{key:"toString",value:function(){return t(this)}},{key:"toHexString",value:function(){return t(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function _(t,e,o){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||m.recalculateRGB(this,e,o),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(m.recalculateRGB(this,e,o),this.__state.space="RGB"),this.__state[e]=t}})}function y(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||m.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(m.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}m.recalculateRGB=function(t,e,o){if("HEX"===t.__state.space)t.__state[e]=c.component_from_hex(t.__state.hex,o);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");n.extend(t.__state,c.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},m.recalculateHSV=function(t){var e=c.rgb_to_hsv(t.r,t.g,t.b);n.extend(t.__state,{s:e.s,v:e.v}),n.isNaN(e.h)?n.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},m.COMPONENTS=["r","g","b","h","s","v","hex","a"],_(m.prototype,"r",2),_(m.prototype,"g",1),_(m.prototype,"b",0),y(m.prototype,"h"),y(m.prototype,"s"),y(m.prototype,"v"),Object.defineProperty(m.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(m.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=c.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var b=function(){function t(e,o){u(this,t),this.initialValue=e[o],this.domElement=document.createElement("div"),this.object=e,this.property=o,this.__onChange=void 0,this.__onFinishChange=void 0}return p(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),v={};n.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){n.each(t,(function(t){v[t]=e}))}));var x=/(\d+(\.\d+)?)px/;function w(t){if("0"===t||n.isUndefined(t))return 0;var e=t.match(x);return n.isNull(e)?0:parseFloat(e[1])}var k={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,o){var r=o,i=e;n.isUndefined(i)&&(i=!0),n.isUndefined(r)&&(r=!0),t.style.position="absolute",i&&(t.style.left=0,t.style.right=0),r&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,o,r){var i=o||{},a=v[e];if(!a)throw new Error("Event type "+e+" not supported.");var s=document.createEvent(a);switch(a){case"MouseEvents":var l=i.x||i.clientX||0,c=i.y||i.clientY||0;s.initMouseEvent(e,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,l,c,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var d=s.initKeyboardEvent||s.initKeyEvent;n.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),d(e,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:s.initEvent(e,i.bubbles||!1,i.cancelable||!0)}n.defaults(s,r),t.dispatchEvent(s)},bind:function(t,e,o,n){var r=n||!1;return t.addEventListener?t.addEventListener(e,o,r):t.attachEvent&&t.attachEvent("on"+e,o),k},unbind:function(t,e,o,n){var r=n||!1;return t.removeEventListener?t.removeEventListener(e,o,r):t.detachEvent&&t.detachEvent("on"+e,o),k},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var o=t.className.split(/ +/);-1===o.indexOf(e)&&(o.push(e),t.className=o.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return k},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var o=t.className.split(/ +/),n=o.indexOf(e);-1!==n&&(o.splice(n,1),t.className=o.join(" "))}else t.className=void 0;return k},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return w(e["border-left-width"])+w(e["border-right-width"])+w(e["padding-left"])+w(e["padding-right"])+w(e.width)},getHeight:function(t){var e=getComputedStyle(t);return w(e["border-top-width"])+w(e["border-bottom-width"])+w(e["padding-top"])+w(e["padding-bottom"])+w(e.height)},getOffset:function(t){var e=t,o={left:0,top:0};if(e.offsetParent)do{o.left+=e.offsetLeft,o.top+=e.offsetTop,e=e.offsetParent}while(e);return o},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},A=function(t){function e(t,o){u(this,e);var n=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,o)),r=n;return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),k.bind(n.__checkbox,"change",(function(){r.setValue(!r.__prev)}),!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return f(e,b),p(e,[{key:"setValue",value:function(t){var o=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),o}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),T=function(t){function e(t,o,r){u(this,e);var i=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,o)),a=r,s=i;if(i.__select=document.createElement("select"),n.isArray(a)){var l={};n.each(a,(function(t){l[t]=t})),a=l}return n.each(a,(function(t,e){var o=document.createElement("option");o.innerHTML=e,o.setAttribute("value",t),s.__select.appendChild(o)})),i.updateDisplay(),k.bind(i.__select,"change",(function(){var t=this.options[this.selectedIndex].value;s.setValue(t)})),i.domElement.appendChild(i.__select),i}return f(e,b),p(e,[{key:"setValue",value:function(t){var o=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),o}},{key:"updateDisplay",value:function(){return k.isActive(this.__select)?this:(this.__select.value=this.getValue(),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(),C=function(t){function e(t,o){u(this,e);var n=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,o)),r=n;function i(){r.setValue(r.__input.value)}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),k.bind(n.__input,"keyup",i),k.bind(n.__input,"change",i),k.bind(n.__input,"blur",(function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())})),k.bind(n.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return f(e,b),p(e,[{key:"updateDisplay",value:function(){return k.isActive(this.__input)||(this.__input.value=this.getValue()),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function E(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var S=function(t){function e(t,o,r){u(this,e);var i=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,o)),a=r||{};return i.__min=a.min,i.__max=a.max,i.__step=a.step,n.isUndefined(i.__step)?0===i.initialValue?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=E(i.__impliedStep),i}return f(e,b),p(e,[{key:"setValue",value:function(t){var o=t;return void 0!==this.__min&&o<this.__min?o=this.__min:void 0!==this.__max&&o>this.__max&&(o=this.__max),void 0!==this.__step&&o%this.__step!=0&&(o=Math.round(o/this.__step)*this.__step),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,o)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=E(t),this}}]),e}();var O=function(t){function e(t,o,r){u(this,e);var i=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,o,r));i.__truncationSuspended=!1;var a=i,s=void 0;function l(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function c(t){var e=s-t.clientY;a.setValue(a.getValue()+e*a.__impliedStep),s=t.clientY}function d(){k.unbind(window,"mousemove",c),k.unbind(window,"mouseup",d),l()}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),k.bind(i.__input,"change",(function(){var t=parseFloat(a.__input.value);n.isNaN(t)||a.setValue(t)})),k.bind(i.__input,"blur",(function(){l()})),k.bind(i.__input,"mousedown",(function(t){k.bind(window,"mousemove",c),k.bind(window,"mouseup",d),s=t.clientY})),k.bind(i.__input,"keydown",(function(t){13===t.keyCode&&(a.__truncationSuspended=!0,this.blur(),a.__truncationSuspended=!1,l())})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return f(e,S),p(e,[{key:"updateDisplay",value:function(){var t,o,n;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),o=this.__precision,n=Math.pow(10,o),Math.round(t*n)/n),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function L(t,e,o,n,r){return n+(t-e)/(o-e)*(r-n)}var F=function(t){function e(t,o,n,r,i){u(this,e);var a=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,o,{min:n,max:r,step:i})),s=a;function l(t){t.preventDefault();var e=s.__background.getBoundingClientRect();return s.setValue(L(t.clientX,e.left,e.right,s.__min,s.__max)),!1}function c(){k.unbind(window,"mousemove",l),k.unbind(window,"mouseup",c),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function d(t){var e=t.touches[0].clientX,o=s.__background.getBoundingClientRect();s.setValue(L(e,o.left,o.right,s.__min,s.__max))}function p(){k.unbind(window,"touchmove",d),k.unbind(window,"touchend",p),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),k.bind(a.__background,"mousedown",(function(t){document.activeElement.blur(),k.bind(window,"mousemove",l),k.bind(window,"mouseup",c),l(t)})),k.bind(a.__background,"touchstart",(function(t){if(1!==t.touches.length)return;k.bind(window,"touchmove",d),k.bind(window,"touchend",p),d(t)})),k.addClass(a.__background,"slider"),k.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return f(e,S),p(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),R=function(t){function e(t,o,n){u(this,e);var r=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,o)),i=r;return r.__button=document.createElement("div"),r.__button.innerHTML=void 0===n?"Fire":n,k.bind(r.__button,"click",(function(t){return t.preventDefault(),i.fire(),!1})),k.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return f(e,b),p(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(),z=function(t){function e(t,o){u(this,e);var r=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,o));r.__color=new m(r.getValue()),r.__temp=new m(0);var i=r;r.domElement=document.createElement("div"),k.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",k.bind(r.__input,"keydown",(function(t){13===t.keyCode&&f.call(this)})),k.bind(r.__input,"blur",f),k.bind(r.__selector,"mousedown",(function(){k.addClass(this,"drag").bind(window,"mouseup",(function(){k.removeClass(i.__selector,"drag")}))})),k.bind(r.__selector,"touchstart",(function(){k.addClass(this,"drag").bind(window,"touchend",(function(){k.removeClass(i.__selector,"drag")}))}));var a,l=document.createElement("div");function c(t){y(t),k.bind(window,"mousemove",y),k.bind(window,"touchmove",y),k.bind(window,"mouseup",p),k.bind(window,"touchend",p)}function d(t){b(t),k.bind(window,"mousemove",b),k.bind(window,"touchmove",b),k.bind(window,"mouseup",h),k.bind(window,"touchend",h)}function p(){k.unbind(window,"mousemove",y),k.unbind(window,"touchmove",y),k.unbind(window,"mouseup",p),k.unbind(window,"touchend",p),_()}function h(){k.unbind(window,"mousemove",b),k.unbind(window,"touchmove",b),k.unbind(window,"mouseup",h),k.unbind(window,"touchend",h),_()}function f(){var t=s(this.value);!1!==t?(i.__color.__state=t,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function _(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}function y(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=i.__saturation_field.getBoundingClientRect(),o=t.touches&&t.touches[0]||t,n=o.clientX,r=o.clientY,a=(n-e.left)/(e.right-e.left),s=1-(r-e.top)/(e.bottom-e.top);return s>1?s=1:s<0&&(s=0),a>1?a=1:a<0&&(a=0),i.__color.v=s,i.__color.s=a,i.setValue(i.__color.toOriginal()),!1}function b(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=i.__hue_field.getBoundingClientRect(),o=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return o>1?o=1:o<0&&(o=0),i.__color.h=360*o,i.setValue(i.__color.toOriginal()),!1}return n.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),n.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),n.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),n.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),n.extend(l.style,{width:"100%",height:"100%",background:"none"}),M(l,"top","rgba(0,0,0,0)","#000"),n.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(a=r.__hue_field).style.background="",a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),k.bind(r.__saturation_field,"mousedown",c),k.bind(r.__saturation_field,"touchstart",c),k.bind(r.__field_knob,"mousedown",c),k.bind(r.__field_knob,"touchstart",c),k.bind(r.__hue_field,"mousedown",d),k.bind(r.__hue_field,"touchstart",d),r.__saturation_field.appendChild(l),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return f(e,b),p(e,[{key:"updateDisplay",value:function(){var t=s(this.getValue());if(!1!==t){var e=!1;n.each(m.COMPONENTS,(function(o){if(!n.isUndefined(t[o])&&!n.isUndefined(this.__color.__state[o])&&t[o]!==this.__color.__state[o])return e=!0,{}}),this),e&&n.extend(this.__color.__state,t)}n.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var o=this.__color.v<.5||this.__color.s>.5?255:0,r=255-o;n.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+o+","+o+","+o+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,M(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),n.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+o+","+o+","+o+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),e}(),D=["-moz-","-o-","-webkit-","-ms-",""];function M(t,e,o,r){t.style.background="",n.each(D,(function(n){t.style.cssText+="background: "+n+"linear-gradient("+e+", "+o+" 0%, "+r+" 100%); "}))}var P=function(t,e){var o=e||document,n=document.createElement("style");n.type="text/css",n.innerHTML=t;var r=o.getElementsByTagName("head")[0];try{r.appendChild(n)}catch(t){}},I=function(t,e){var o=t[e];return n.isArray(arguments[2])||n.isObject(arguments[2])?new T(t,e,arguments[2]):n.isNumber(o)?n.isNumber(arguments[2])&&n.isNumber(arguments[3])?n.isNumber(arguments[4])?new F(t,e,arguments[2],arguments[3],arguments[4]):new F(t,e,arguments[2],arguments[3]):n.isNumber(arguments[4])?new O(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new O(t,e,{min:arguments[2],max:arguments[3]}):n.isString(o)?new C(t,e):n.isFunction(o)?new R(t,e,""):n.isBoolean(o)?new A(t,e):null};var B=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},N=function(){function t(){u(this,t),this.backgroundElement=document.createElement("div"),n.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),k.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),n.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;k.bind(this.backgroundElement,"click",(function(){e.hide()}))}return p(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),n.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",k.unbind(t.domElement,"webkitTransitionEnd",e),k.unbind(t.domElement,"transitionend",e),k.unbind(t.domElement,"oTransitionEnd",e)};k.bind(this.domElement,"webkitTransitionEnd",e),k.bind(this.domElement,"transitionend",e),k.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-k.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-k.getHeight(this.domElement)/2+"px"}}]),t}(),j=function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");P(j);var V="Default",H=function(){try{return!!window.localStorage}catch(t){return!1}}(),G=void 0,$=!0,U=void 0,X=!1,W=[],Y=function t(e){var o=this,r=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),k.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=n.defaults(r,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),r=n.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),n.isUndefined(r.load)?r.load={preset:V}:r.preset&&(r.load.preset=r.preset),n.isUndefined(r.parent)&&r.hideable&&W.push(this),r.resizable=n.isUndefined(r.parent)&&r.resizable,r.autoPlace&&n.isUndefined(r.scrollable)&&(r.scrollable=!0);var i,a=H&&"true"===localStorage.getItem(tt(this,"isLocal")),s=void 0,l=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return o.parent?o.getRoot().preset:r.load.preset},set:function(t){o.parent?o.getRoot().preset=t:r.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),o.revert()}},width:{get:function(){return r.width},set:function(t){r.width=t,rt(o,t)}},name:{get:function(){return r.name},set:function(t){r.name=t,l&&(l.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(e){r.closed=e,r.closed?k.addClass(o.__ul,t.CLASS_CLOSED):k.removeClass(o.__ul,t.CLASS_CLOSED),this.onResize(),o.__closeButton&&(o.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return a},set:function(t){H&&(a=t,t?k.bind(window,"unload",s):k.unbind(window,"unload",s),localStorage.setItem(tt(o,"isLocal"),t))}}}),n.isUndefined(r.parent)){if(this.closed=r.closed||!1,k.addClass(this.domElement,t.CLASS_MAIN),k.makeSelectable(this.domElement,!1),H&&a){o.useLocalStorage=!0;var c=localStorage.getItem(tt(this,"gui"));c&&(r.load=JSON.parse(c))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,k.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),r.closeOnTop?(k.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(k.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),k.bind(this.__closeButton,"click",(function(){o.closed=!o.closed}))}else{void 0===r.closed&&(r.closed=!0);var d=document.createTextNode(r.name);k.addClass(d,"controller-name"),l=K(o,d);k.addClass(this.__ul,t.CLASS_CLOSED),k.addClass(l,"title"),k.bind(l,"click",(function(t){return t.preventDefault(),o.closed=!o.closed,!1})),r.closed||(this.closed=!1)}r.autoPlace&&(n.isUndefined(r.parent)&&($&&(U=document.createElement("div"),k.addClass(U,"dg"),k.addClass(U,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(U),$=!1),U.appendChild(this.domElement),k.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||rt(o,r.width)),this.__resizeHandler=function(){o.onResizeDebounced()},k.bind(window,"resize",this.__resizeHandler),k.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),k.bind(this.__ul,"transitionend",this.__resizeHandler),k.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&nt(this),s=function(){H&&"true"===localStorage.getItem(tt(o,"isLocal"))&&localStorage.setItem(tt(o,"gui"),JSON.stringify(o.getSaveObject()))},this.saveToLocalStorageIfPossible=s,r.parent||((i=o.getRoot()).width+=1,n.defer((function(){i.width-=1})))};function K(t,e,o){var n=document.createElement("li");return e&&n.appendChild(e),o?t.__ul.insertBefore(n,o):t.__ul.appendChild(n),t.onResize(),n}function J(t){k.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&k.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function Q(t,e){var o=t.__preset_select[t.__preset_select.selectedIndex];o.innerHTML=e?o.value+"*":o.value}function Z(t,e){var o=t.getRoot(),n=o.__rememberedObjects.indexOf(e.object);if(-1!==n){var r=o.__rememberedObjectIndecesToControllers[n];if(void 0===r&&(r={},o.__rememberedObjectIndecesToControllers[n]=r),r[e.property]=e,o.load&&o.load.remembered){var i=o.load.remembered,a=void 0;if(i[t.preset])a=i[t.preset];else{if(!i[V])return;a=i[V]}if(a[n]&&void 0!==a[n][e.property]){var s=a[n][e.property];e.initialValue=s,e.setValue(s)}}}}function q(t,e,o,r){if(void 0===e[o])throw new Error('Object "'+e+'" has no property "'+o+'"');var i=void 0;if(r.color)i=new z(e,o);else{var a=[e,o].concat(r.factoryArgs);i=I.apply(t,a)}r.before instanceof b&&(r.before=r.before.__li),Z(t,i),k.addClass(i.domElement,"c");var s=document.createElement("span");k.addClass(s,"property-name"),s.innerHTML=i.property;var l=document.createElement("div");l.appendChild(s),l.appendChild(i.domElement);var c=K(t,l,r.before);return k.addClass(c,Y.CLASS_CONTROLLER_ROW),i instanceof z?k.addClass(c,"color"):k.addClass(c,d(i.getValue())),function(t,e,o){if(o.__li=e,o.__gui=t,n.extend(o,{options:function(e){if(arguments.length>1){var r=o.__li.nextElementSibling;return o.remove(),q(t,o.object,o.property,{before:r,factoryArgs:[n.toArray(arguments)]})}if(n.isArray(e)||n.isObject(e)){var i=o.__li.nextElementSibling;return o.remove(),q(t,o.object,o.property,{before:i,factoryArgs:[e]})}},name:function(t){return o.__li.firstElementChild.firstElementChild.innerHTML=t,o},listen:function(){return o.__gui.listen(o),o},remove:function(){return o.__gui.remove(o),o}}),o instanceof F){var r=new O(o.object,o.property,{min:o.__min,max:o.__max,step:o.__step});n.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=o[t],n=r[t];o[t]=r[t]=function(){var t=Array.prototype.slice.call(arguments);return n.apply(r,t),e.apply(o,t)}})),k.addClass(e,"has-slider"),o.domElement.insertBefore(r.domElement,o.domElement.firstElementChild)}else if(o instanceof O){var i=function(e){if(n.isNumber(o.__min)&&n.isNumber(o.__max)){var r=o.__li.firstElementChild.firstElementChild.innerHTML,i=o.__gui.__listening.indexOf(o)>-1;o.remove();var a=q(t,o.object,o.property,{before:o.__li.nextElementSibling,factoryArgs:[o.__min,o.__max,o.__step]});return a.name(r),i&&a.listen(),a}return e};o.min=n.compose(i,o.min),o.max=n.compose(i,o.max)}else o instanceof A?(k.bind(e,"click",(function(){k.fakeEvent(o.__checkbox,"click")})),k.bind(o.__checkbox,"click",(function(t){t.stopPropagation()}))):o instanceof R?(k.bind(e,"click",(function(){k.fakeEvent(o.__button,"click")})),k.bind(e,"mouseover",(function(){k.addClass(o.__button,"hover")})),k.bind(e,"mouseout",(function(){k.removeClass(o.__button,"hover")}))):o instanceof z&&(k.addClass(e,"color"),o.updateDisplay=n.compose((function(t){return e.style.borderLeftColor=o.__color.toString(),t}),o.updateDisplay),o.updateDisplay());o.setValue=n.compose((function(e){return t.getRoot().__preset_select&&o.isModified()&&Q(t.getRoot(),!0),e}),o.setValue)}(t,c,i),t.__controllers.push(i),i}function tt(t,e){return document.location.href+"."+e}function et(t,e,o){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.__preset_select.appendChild(n),o&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function ot(t,e){e.style.display=t.useLocalStorage?"block":"none"}function nt(t){var e=void 0;function o(o){return o.preventDefault(),t.width+=e-o.clientX,t.onResize(),e=o.clientX,!1}function r(){k.removeClass(t.__closeButton,Y.CLASS_DRAG),k.unbind(window,"mousemove",o),k.unbind(window,"mouseup",r)}function i(n){return n.preventDefault(),e=n.clientX,k.addClass(t.__closeButton,Y.CLASS_DRAG),k.bind(window,"mousemove",o),k.bind(window,"mouseup",r),!1}t.__resize_handle=document.createElement("div"),n.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),k.bind(t.__resize_handle,"mousedown",i),k.bind(t.__closeButton,"mousedown",i),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function rt(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function it(t,e){var o={};return n.each(t.__rememberedObjects,(function(r,i){var a={},s=t.__rememberedObjectIndecesToControllers[i];n.each(s,(function(t,o){a[o]=e?t.initialValue:t.getValue()})),o[i]=a})),o}function at(t){0!==t.length&&B.call(window,(function(){at(t)})),n.each(t,(function(t){t.updateDisplay()}))}Y.toggleHide=function(){X=!X,n.each(W,(function(t){t.domElement.style.display=X?"none":""}))},Y.CLASS_AUTO_PLACE="a",Y.CLASS_AUTO_PLACE_CONTAINER="ac",Y.CLASS_MAIN="main",Y.CLASS_CONTROLLER_ROW="cr",Y.CLASS_TOO_TALL="taller-than-window",Y.CLASS_CLOSED="closed",Y.CLASS_CLOSE_BUTTON="close-button",Y.CLASS_CLOSE_TOP="close-top",Y.CLASS_CLOSE_BOTTOM="close-bottom",Y.CLASS_DRAG="drag",Y.DEFAULT_WIDTH=245,Y.TEXT_CLOSED="Close Controls",Y.TEXT_OPEN="Open Controls",Y._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||Y.toggleHide()},k.bind(window,"keydown",Y._keydownHandler,!1),n.extend(Y.prototype,{add:function(t,e){return q(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return q(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;n.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&U.removeChild(this.domElement);var t=this;n.each(this.__folders,(function(e){t.removeFolder(e)})),k.unbind(window,"keydown",Y._keydownHandler,!1),J(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var o=new Y(e);this.__folders[t]=o;var n=K(this,o.domElement);return k.addClass(n,"folder"),o},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],J(t);var e=this;n.each(t.__folders,(function(e){t.removeFolder(e)})),n.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=k.getOffset(t.__ul).top,o=0;n.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(o+=k.getHeight(e))})),window.innerHeight-e-20<o?(k.addClass(t.domElement,Y.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(k.removeClass(t.domElement,Y.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&n.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:n.debounce((function(){this.onResize()}),50),remember:function(){if(n.isUndefined(G)&&((G=new N).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;n.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&function(t){var e=t.__save_row=document.createElement("li");k.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),k.addClass(e,"save-row");var o=document.createElement("span");o.innerHTML="&nbsp;",k.addClass(o,"button gears");var r=document.createElement("span");r.innerHTML="Save",k.addClass(r,"button"),k.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",k.addClass(i,"button"),k.addClass(i,"save-as");var a=document.createElement("span");a.innerHTML="Revert",k.addClass(a,"button"),k.addClass(a,"revert");var s=t.__preset_select=document.createElement("select");t.load&&t.load.remembered?n.each(t.load.remembered,(function(e,o){et(t,o,o===t.preset)})):et(t,V,!1);if(k.bind(s,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(s),e.appendChild(o),e.appendChild(r),e.appendChild(i),e.appendChild(a),H){var l=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(tt(t,"isLocal"))&&c.setAttribute("checked","checked"),ot(t,l),k.bind(c,"change",(function(){t.useLocalStorage=!t.useLocalStorage,ot(t,l)}))}var d=document.getElementById("dg-new-constructor");k.bind(d,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||G.hide()})),k.bind(o,"click",(function(){d.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),G.show(),d.focus(),d.select()})),k.bind(r,"click",(function(){t.save()})),k.bind(i,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),k.bind(a,"click",(function(){t.revert()}))}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&rt(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=it(this)),t.folders={},n.each(this.__folders,(function(e,o){t.folders[o]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=it(this),Q(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[V]=it(this,!0)),this.load.remembered[t]=it(this),this.preset=t,et(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){n.each(this.__controllers,(function(e){this.getRoot().load.remembered?Z(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),n.each(this.__folders,(function(t){t.revert(t)})),t||Q(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&at(this.__listening)},updateDisplay:function(){n.each(this.__controllers,(function(t){t.updateDisplay()})),n.each(this.__folders,(function(t){t.updateDisplay()}))}});var st=Y,lt={};Object.defineProperty(lt,"__esModule",{value:!0});var ct=lt.default=void 0;const dt=6/29,ut=3*dt*dt,pt=t=>Math.round(255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055))||0,ht=t=>t>dt?t*t*t:ut*(t-4/29);function ft(t){return 0===t.length?0:void 0===t[0].length?1:void 0===t[0][0].length?2:void 0===t[0][0][0].length?3:void 0}ct=lt.default=({luminance:t,a:e,b:o})=>{const n=(t+16)/116,r=.96422*ht(n+e/500),i=Number(ht(n)),a=.82521*ht(n-o/200);return{red:pt(3.1338561*r-1.6168667*i-.4906146*a),green:pt(-.9787684*r+1.9161415*i+.033454*a),blue:pt(.0719453*r-.2289914*i+1.4052427*a)}},core["Charting`DateTicksFunction"]=()=>"DateTicksFunction",core.DateListPlot=()=>{};let gt=!1,mt=!1,_t={name:"WebObjects/Graphics"};const yt={name:"GraphicsComplex 2D"};interpretate.contextExpand(_t),["FaceForm","CurrentValue","FontColor","Tiny","VertexColors","Antialiasing","Small","Plot","ListLinePlot","ListPlot","Automatic","Controls","All","TickLabels","FrameTicksStyle","AlignmentPoint","AspectRatio","Axes","AxesLabel","AxesOrigin","AxesStyle","Background","BaselinePosition","BaseStyle","ColorOutput","ContentSelectable","CoordinatesToolOptions","DisplayFunction","Epilog","FormatType","Frame","FrameLabel","FrameStyle","FrameTicks","FrameTicksStyle","GridLines","GridLinesStyle","ImageMargins","ImagePadding","ImageSize","ImageSizeRaw","LabelStyle","Method","PlotLabel","PlotRange","PlotRangeClipping","PlotRangePadding","PlotRegion","PreserveImageOptions","Prolog","RotateLabel","Ticks","TicksStyle","TransitionDuration"].map((t=>{_t[t]=()=>t,_t[t].update=()=>t})),_t["Graphics`Canvas"]=async(t,e)=>{let o={k:1,x:0,y:0};e.onZoom.push((t=>{o=t}));const n={xAxis:e.xAxis,yAxis:e.yAxis};return e.xAxis=t=>0,e.yAxis=t=>0,e.xAxis.invert=t=>{const r=(t-o.x-e.panZoomEntites.left)/o.k;return n.xAxis.invert(r)},e.yAxis.invert=t=>{const r=(t-o.y-e.panZoomEntites.top)/o.k;return n.yAxis.invert(r)},e.panZoomEntites.canvas},_t.HoldForm=async(t,e)=>await interpretate(t[0],e),_t.HoldForm.update=async(t,e)=>await interpretate(t[0],e),_t.Scale=async(t,e)=>await interpretate(t[0],e),_t.Scale.update=async(t,e)=>await interpretate(t[0],e),_t.NamespaceBox=async(t,e)=>await interpretate(t[1],e),_t.DynamicModuleBox=async(t,e)=>await interpretate(t[1],e),_t.TagBox=async(t,e)=>await interpretate(t[0],e),_t.DynamicModule=async(t,e)=>await interpretate(t[1],e),_t["Charting`DelayedClickEffect"]=async(t,e)=>await interpretate(t[0],e),_t.ColorProfileData=()=>{},_t.ParametricPlot=()=>{},_t.TransitionDuration=()=>"TransitionDuration",_t.TransitionType=()=>"TransitionType";_t.Offset=async(t,e)=>{const o=await interpretate(t[1],e);e.offset={x:e.xAxis(o[0])-e.xAxis(0),y:e.yAxis(o[1])-e.yAxis(0)};const n=await interpretate(t[0],e);return Array.isArray(n)?(n.map(((t,e)=>t+o[e])),[0,0]):n},_t.Offset.update=_t.Offset,_t.Graphics=async(t,e)=>{await interpretate.shared.d3.load(),gt||(gt=interpretate.shared.d3.d3),mt||(mt=interpretate.shared.d3["d3-interpolate-path"].interpolatePath),_t.interpolatePath=mt,_t.d3=gt,gt.selection.prototype.maybeTransition=function(t,e){return t?this.transition().ease(t).duration(e):this},gt.selection.prototype.maybeTransitionTween=function(t,e,o,n){return t?this.transition().ease(t).duration(e).attrTween(o,n):this.attr(o,n.apply(this.node(),this.data())(1))};let o=await core._getRules(t,{...e,context:_t,hold:!0});0==Object.keys(o).length&&t.length>1&&(o=await core._getRules(await interpretate(t[1],{...e,context:_t,hold:!0}),{...e,context:_t,hold:!0})),console.log(o);let n=o.PlotLabel;var r=e.element;let i=await interpretate(o.ImageSize,e);i||(i=e.imageSize?Array.isArray(e.imageSize)?e.imageSize:[e.imageSize,.618034*e.imageSize]:[core.DefaultWidth,.618034*core.DefaultWidth]);const a=await interpretate(o.AspectRatio,e)||.618034;i instanceof Array||(i=[i,i*a]),console.log("Image size"),console.log(i);let s,l,c,d=[!1,!1],u=!1,p=[5,5,5,5],h=[!0,!0,!0,!0],f=!1;if(console.log(o),o.Frame&&(o.Frame=await interpretate(o.Frame,e),!0===o.Frame?f=!0:(!0===o.Frame[0][0]&&(f=!0),!0===o.Frame[0]&&(f=!0))),o.Axes&&(o.Axes=await interpretate(o.Axes,e),!0===o.Axes?d=[!0,!0]:Array.isArray(o.Axes)&&(d=o.Axes)),f&&(u=!0,d=[!0,!0,!0,!0]),o.Ticks&&(o.Ticks=await interpretate(o.Ticks,e),Array.isArray(o.Ticks)&&Array.isArray(o.Ticks[0])&&(Number.isInteger(o.Ticks[0][0])||Array.isArray(o.Ticks[0][0]))&&(s=[...o.Ticks,...o.Ticks])),o.FrameTicks&&f&&(o.FrameTicks=await interpretate(o.FrameTicks,e),s=[!0,!0,!0,!0],Array.isArray(o.FrameTicks)&&(Array.isArray(o.FrameTicks[0])&&(Array.isArray(o.FrameTicks[0][0])?(Number.isInteger(o.FrameTicks[0][0][0])||"string"==typeof o.FrameTicks[0][0]||Array.isArray(o.FrameTicks[0][0][0]))&&(s[1]=o.FrameTicks[0][0],s[3]=o.FrameTicks[0][1]):(s[1]=o.FrameTicks[0][0],s[3]=o.FrameTicks[0][1])),Array.isArray(o.FrameTicks[1])&&(Array.isArray(o.FrameTicks[1][0])?(Number.isInteger(o.FrameTicks[1][0][0])||"string"==typeof o.FrameTicks[1][0]||Array.isArray(o.FrameTicks[1][0][0]))&&(s[0]=o.FrameTicks[1][0],s[2]=o.FrameTicks[1][1]):(s[0]=o.FrameTicks[1][0],s[2]=o.FrameTicks[1][1])))),o.TickDirection){const t=await interpretate(o.TickDirection,e);"Inward"===t&&(u=!0),"Outward"===t&&(u=!1)}o.TickLengths&&(o.TickLengths=await interpretate(o.TickLengths,e),Array.isArray(o.TickLengths)||(p=[o.TickLengths,o.TickLengths,o.TickLengths,o.TickLengths])),o.TickLabels&&(o.TickLabels=await interpretate(o.TickLabels,e),h=Array.isArray(o.TickLabels)?o.TickLabels.flat():[!1,!1,!1,!1]);let g={top:0,right:0,bottom:10,left:40},m={top:0,right:0,bottom:15,left:0};d[2]&&(g.top=g.bottom,g.left=g.right),o.AxesLabel&&(m.bottom=10,g.top=30,g.right=50,m.right=50),f&&(m.left=40,m.left=30,g.left=30,g.right=40,g.top=30,m.bottom=10,g.bottom=35),o.ImagePadding&&(console.log("padding: "),console.log(o.ImagePadding),o.ImagePadding=await interpretate(o.ImagePadding,e),"None"===o.ImagePadding?(g.top=0,g.bottom=0,g.left=0,g.right=0):Number.isInteger(o.ImagePadding)?(g.top=o.ImagePadding,g.bottom=o.ImagePadding,g.left=o.ImagePadding,g.right=o.ImagePadding):"All"===o.ImagePadding||console.error("given ImagePadding is not supported!"));let _,y=i[0]-g.left-g.right,b=i[1]-g.top-g.bottom;if((y<0||b<0)&&(g.top=0,g.bottom=0,g.left=0,g.right=0,m={top:0,right:0,bottom:0,left:0},y=i[0],b=i[1]),_=e.inset?e.inset.append("svg"):gt.select(r).append("svg"),"ViewBox"in o){let t=await interpretate(o.ViewBox,e);t instanceof Array||(t=[0,0,t,t*a]),_.attr("viewBox",t),e.viewBox=t}else _.attr("width",y+g.left+g.right+m.left).attr("height",b+g.top+g.bottom+m.bottom),e.svgWidth=y+g.left+g.right+m.left,e.svgHeight=b+g.top+g.bottom+m.bottom;const v=_;_=_.append("g").attr("transform","translate("+(g.left+m.left)+","+g.top+")");let x=[[-1.15,1.15],[-1.15,1.15]],w=!0;if(o.PlotRange){const t=await interpretate(o.PlotRange,e);Number.isFinite(t[0][0])&&(Number.isFinite(t[1][0])?(x=t,w=!1):(x[0]=t[0],x[1]=t[0]))}let k,A,T,C,E=gt.easeLinear;if(o.TransitionType){switch(await interpretate(o.TransitionType,{...e,context:_t})){case"Linear":E=gt.easeLinear;break;case"CubicInOut":E=gt.easeCubicInOut;break;default:E=void 0}}console.log(x);let S=gt.scaleLinear().domain(x[0]).range([0,y]),O=gt.axisBottom(S),L=gt.axisTop(S);if(console.log(d),s)if(s[0])if("string"==typeof s[0])switch(s[0]){case"Automatic":break;case"None":O=O.tickValues([]);break;case"DateTicksFunction":S=gt.scaleTime().domain(x[0].map((t=>1e3*t-2208996e6))).range([0,y]),L=gt.axisTop(S),O=gt.axisBottom(S);const t=S;S=e=>t(1e3*e-2208996e6),S.copy=t.copy,S.range=t.range,S.domain=t.domain,S.invert=t.invert}else if(!0===s[0])console.log("Default ticks");else if(Array.isArray(s[0][0])){const t=s[0].map((t=>t[1]));O=O.tickValues(s[0].map((t=>t[0]))).tickFormat((function(e,o){return t[o]}))}else O=O.tickValues(s[0]);else O=O.tickValues([]);if(s)if(s[2])if("string"==typeof s[2])switch(s[2]){case"Automatic":break;case"None":L=L.tickValues([]);break;case"DateTicksFunction":S=gt.scaleTime().domain(x[0].map((t=>1e3*t-2208996e6))).range([0,y]),L=gt.axisTop(S),O=gt.axisBottom(S);const t=S;S=e=>t(1e3*e-2208996e6),S.copy=t.copy,S.range=t.range,S.domain=t.domain,S.invert=t.invert}else if(!0===s[2])console.log("Default ticks");else if(Array.isArray(s[2][0])){const t=s[2].map((t=>t[1]));L=L.tickValues(s[2].map((t=>t[0]))).tickFormat((function(e,o){return t[o]}))}else L=L.tickValues(s[2]);else L=L.tickValues([]);h[0]||(O=O.tickFormat((t=>""))),h[1]||(L=L.tickFormat((t=>""))),u?(O=O.tickSizeInner(-p[0]).tickSizeOuter(0),L=L.tickSizeInner(-p[2]).tickSizeOuter(0)):(O=O.tickSizeInner(p[0]).tickSizeOuter(0),L=L.tickSizeInner(p[2]).tickSizeOuter(0));let F=gt.scaleLinear().domain(x[1]).range([b,0]),R=gt.axisLeft(F),z=gt.axisRight(F);if(s)if(s[1])if("string"==typeof s[1])switch(s[1]){case"Automatic":break;case"None":R=R.tickValues([]);break;case"DateTicksFunction":F=gt.scaleTime().domain(x[1].map((t=>1e3*t-2208996e6))).range([0,b]),z=gt.axisRight(F),R=gt.axisLeft(F);const t=F;F=e=>t(1e3*e-2208996e6),F.copy=t.copy,F.range=t.range,F.domain=t.domain,F.invert=t.invert}else if(!0===s[1])console.log("Default ticks");else if(Array.isArray(s[1][0])){const t=s[1].map((t=>t[1]));R=R.tickValues(s[1].map((t=>t[0]))).tickFormat((function(e,o){return t[o]}))}else R=R.tickValues(s[1]);else R=R.tickValues([]);if(s)if(s[3])if("string"==typeof s[3])switch(s[3]){case"Automatic":break;case"None":z=z.tickValues([]);break;case"DateTicksFunction":F=gt.scaleTime().domain(x[1].map((t=>1e3*t-2208996e6))).range([0,b]),z=gt.axisRight(F),R=gt.axisLeft(F);const t=F;F=e=>t(1e3*e-2208996e6),F.copy=t.copy,F.range=t.range,F.domain=t.domain,F.invert=t.invert}else if(!0===s[3])console.log("Default ticks");else if(Array.isArray(s[3][0])){const t=s[3].map((t=>t[1]));z=z.tickValues(s[3].map((t=>t[0]))).tickFormat((function(e,o){return t[o]}))}else z=z.tickValues(s[3]);else z=z.tickValues([]);h[2]||(R=R.tickFormat((t=>""))),h[3]||(z=z.tickFormat((t=>""))),u?(R=R.tickSizeInner(-p[1]).tickSizeOuter(0),z=z.tickSizeInner(-p[3]).tickSizeOuter(0)):(R=R.tickSizeInner(p[1]).tickSizeOuter(0),z=z.tickSizeInner(p[3]).tickSizeOuter(0)),e.context=_t,e.svg=_.append("g"),e.xAxis=S,e.yAxis=F,e.numerical=!0,e.tostring=!1,e.offset={x:0,y:0},e.color="rgb(68, 68, 68)",e.stroke=void 0,e.opacity=1,e.fontsize=10,e.fontfamily="sans-serif",e.strokeWidth=1.5,e.pointSize=.013,e.arrowHead=1,e.onZoom=[],e.transitionDuration=50,e.transitionType=E,e.plotRange=x,l={...e},c={...e},o.AxesStyle&&await interpretate(o.AxesStyle,l),o.FrameStyle&&(console.warn("FrameStyle"),console.log(o.FrameStyle),await interpretate(o.FrameStyle,l),console.log(l)),o.FrameTicksStyle&&await interpretate(o.FrameTicksStyle,c),d[0]&&(k=_.append("g").attr("transform","translate(0,"+b+")").call(O).attr("font-size",c.fontsize).attr("fill",c.color)),d[2]&&(T=_.append("g").attr("transform","translate(0,0)").call(L).attr("font-size",c.fontsize).attr("fill",c.color)),d[1]&&(A=_.append("g").call(R).attr("font-size",c.fontsize).attr("fill",c.color)),d[3]&&(C=_.append("g").attr("transform","translate("+y+", 0)").call(z).attr("font-size",c.fontsize).attr("fill",c.color));let D={...e};if(o.LabelStyle&&await interpretate(o.LabelStyle,D),n&&(n=await interpretate(n,D),_.append("text").attr("x",y/2+D.offset.x).attr("y",0-g.top/2+D.offset.y).attr("text-anchor","middle").attr("fill",D.color).style("font-size",D.fontsize).text(n)),o.AxesLabel&&!f&&(o.AxesLabel=await interpretate(o.AxesLabel,{...e,hold:!0}),Array.isArray(o.AxesLabel))){let t={...e},n=await interpretate(o.AxesLabel[0],t);"None"!=n&&k&&_t.Text.PutText(k.append("text").attr("x",y+t.offset.x+10).attr("y",g.bottom+t.offset.y).attr("font-size",l.fontsize).attr("fill",l.color).attr("text-anchor","start"),n,l),t={...e},n=await interpretate(o.AxesLabel[1],t),"None"!=n&&A&&_t.Text.PutText(A.append("text").attr("x",0+t.offset.x).attr("y",-g.top/2+t.offset.y).attr("font-size",l.fontsize).attr("fill",l.color).attr("text-anchor","start"),n,l)}if(o.FrameLabel&&f&&(o.FrameLabel=await interpretate(o.FrameLabel,{...e,hold:!0}),Array.isArray(o.FrameLabel))){const t=await interpretate(o.FrameLabel[0],{...e,hold:!0}),n=await interpretate(o.FrameLabel[1],{...e,hold:!0});let r,i;"None"!=t&&t&&(r={...e},i=await interpretate(t[0],r),"None"!=i&&A&&_t.Text.PutText(A.append("text").attr("transform","rotate(-90)").attr("y",-g.left+r.offset.x).attr("x",-b/2-r.offset.y).attr("font-size",l.fontsize).attr("fill",l.color).attr("text-anchor","middle"),i,l),r={...e},i=await interpretate(t[1],r),"None"!=i&&C&&_t.Text.PutText(C.append("text").attr("x",0+r.offset.x).attr("y",g.bottom+r.offset.y).attr("font-size",l.fontsize).attr("fill",l.color).attr("text-anchor","middle"),i,l)),"None"!=n&&n&&(r={...e},i=await interpretate(n[1],r),"None"!=i&&T&&_t.Text.PutText(T.append("text").attr("x",y/2+r.offset.x).attr("y",g.bottom+r.offset.y).attr("font-size",l.fontsize).attr("fill",l.color).attr("text-anchor","middle"),i,l),r={...e},i=await interpretate(n[0],r),"None"!=i&&k&&_t.Text.PutText(k.append("text").attr("x",y/2+r.offset.x).attr("y",g.bottom+r.offset.y).attr("font-size",l.fontsize).attr("fill",l.color).attr("text-anchor","middle"),i,l))}if(o.TransitionDuration&&(e.transitionDuration=await interpretate(o.TransitionDuration,e)),e.local.xAxis=S,e.local.yAxis=F,(o.Controls||void 0===o.Controls)&&(void 0===o.Controls||await interpretate(o.Controls,e))&&xt(v,_,e.svg,k,A,T,C,O,R,L,z,S,F,e),e.panZoomEntites={canvas:v,svg:e.svg,left:g.left+m.left,top:g.top,gX:k,gY:A,gTX:T,gRY:C,xAxis:O,yAxis:R,txAxis:L,ryAxis:z,x:S,y:F},!e.inset){const t=new st({autoPlace:!1,name:"...",closed:!0}),o=document.createElement("div");o.classList.add("graphics2d-controller"),o.appendChild(t.domElement);const n={Save:function(){!function(t,e){if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(t,e);else{const o=document.createElement("a");document.body.appendChild(o);const n=window.URL.createObjectURL(t);o.href=n,o.download=e,o.click(),setTimeout((()=>{window.URL.revokeObjectURL(n),document.body.removeChild(o)}),0)}}(vt(r.firstChild),"plot.svg")}};t.add(n,"Save"),e.element.appendChild(o)}if(await interpretate(o.Prolog,e),await interpretate(t[0],e),await interpretate(o.Epilog,e),w){console.warn("d3.js autoscale!");const t=i[0]-(g.left+g.right),o=i[1]-(g.top+g.bottom);let n=e.svg.node().getBBox();console.log([t,o]),n.width||(console.warn("Warning! Looks like an element was not drawn properly"),n.width=i[0],n.height=i[0],n.x=0,n.y=0,console.log(n)),console.log(n);const r=Math.min(t/n.width,o/n.height);console.log(r);let a=gt.zoomTransform(v);a=a.translate(t/2,o/2),a=a.scale(r),a=a.translate(-n.x-n.width/2,-n.y-n.height/2),console.log(a),bt(a,_,e.svg,k,A,T,C,O,R,L,z,S,F),e._zoom&&e._zoom.transform(v,a)}};const bt=(t,e,o,n,r,i,a,s,l,c,d,u,p)=>{o.attr("transform",t),n&&n.call(s.scale(t.rescaleX(u))),r&&r.call(l.scale(t.rescaleY(p))),i&&i.call(c.scale(t.rescaleX(u))),a&&a.call(d.scale(t.rescaleY(p)))};_t.Graphics.update=(t,e)=>{console.error("root update method for Graphics is not supported")},_t.Graphics.destroy=(t,e)=>{console.error("Nothing to destroy...")},_t.Inset=async(t,e)=>{const o=await interpretate(t[1],e),n=e.svg.append("g");return await interpretate(t[0],{...e,inset:n}),e.local.group=n,n.attr("transform","translate("+e.xAxis(o[0])+","+e.yAxis(o[1])+")")},_t.Inset.update=async(t,e)=>{const o=await interpretate(t[1],e);return e.local.group.attr("transform","translate("+e.xAxis(o[0])+","+e.yAxis(o[1])+")"),e.local.group},_t.Inset.destroy=async(t,e)=>{console.warn("Destory method is not defined for Inset")},_t.Inset.virtual=!0;const vt=t=>{const e="http://www.w3.org/2000/xmlns/";t=t.cloneNode(!0);const o=window.location.href+"#",n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT);for(;n.nextNode();)for(const t of n.currentNode.attributes)t.value.includes(o)&&(t.value=t.value.replace(o,"#"));t.setAttributeNS(e,"xmlns","http://www.w3.org/2000/svg"),t.setAttributeNS(e,"xmlns:xlink","http://www.w3.org/1999/xlink");const r=(new window.XMLSerializer).serializeToString(t);return new Blob([r],{type:"image/svg+xml"})};const xt=(t,e,o,n,r,i,a,s,l,c,d,u,p,h)=>{console.log({listener:t,raw:e,view:o,gX:n,gY:r,gTX:i,gRY:a,xAxis:s,yAxis:l,txAxis:c,ryAxis:d,x:u,y:p,env:h});const f=gt.zoom().filter((function(t){return t.preventDefault(),!(t.ctrlKey&&"wheel"!==t.type||t.button)})).on("zoom",(function({transform:t}){o.attr("transform",t),n&&n.call(s.scale(t.rescaleX(u)));r&&r.call(l.scale(t.rescaleY(p)));i&&i.call(c.scale(t.rescaleX(u)));a&&a.call(d.scale(t.rescaleY(p)));h.onZoom.forEach((e=>{e(t)}))}));t.call(f),h._zoom=f};let wt;_t.SVGAttribute=async(t,e)=>{const o=await core._getRules(t,e);let n=await interpretate(t[0],e);return Object.keys(o).forEach((t=>{n=n.attr(t,o[t])})),e.local.object=n,n},_t.SVGAttribute.update=async(t,e)=>{const o=await core._getRules(t,e);let n=e.local.object.maybeTransition(e.transitionType,e.transitionDuration);return Object.keys(o).forEach((t=>{n=n.attr(t,o[t])})),n},_t.SVGAttribute.destroy=async(t,e)=>{console.log("SVGAttribute: nothing to destroy")},_t.SVGAttribute.virtual=!0,_t.LABColor=async(t,e)=>{let o;o=t.length>1?[await interpretate(t[0],e),await interpretate(t[1],e),await interpretate(t[2],e)]:await interpretate(t[0],e);const n=ct({luminance:100*o[0],a:100*o[1],b:100*o[2]});return console.log(o),console.log("LAB color"),console.log(n),e.color="rgb("+Math.floor(n.red)+","+Math.floor(n.green)+","+Math.floor(n.blue)+")",t.length>3&&(e.opacity=await interpretate(t[3],e)),e.color},_t.LABColor.update=()=>{},_t.arrowGenerator=void 0,yt.Arrow=async(t,e)=>{await interpretate.shared.d3.load(),wt||(wt=(await interpretate.shared.d3["d3-arrow"]).arrow1);let o=await interpretate(t[0],e);if(!Array.isArray(o)){let t;const n=uuidv4(),r=wt().id(n).attr("fill",e.color).attr("stroke","none").scale([e.arrowHead]);return e.svg.call(r),t=o.attr("marker-end","url(#"+n+")"),t}const n=e.xAxis,r=e.yAxis;if(o[0][0]){console.log("Multiple isntances"),console.log(o);const t=e.svg.append("g");t.attr("fill","none").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth);const i=uuidv4(),a=wt().id(i).attr("fill",e.color).attr("stroke","none").scale([e.arrowHead]);return e.svg.call(a),o.forEach((o=>{t.append("path").datum(o.map((t=>e.vertices[t-1]))).attr("vector-effect","non-scaling-stroke").attr("d",gt.line().x((function(t){return n(t[0])})).y((function(t){return r(t[1])}))).attr("marker-end","url(#"+i+")")})),t}{const t=uuidv4(),i=wt().id(t).attr("fill",e.color).attr("stroke","none").scale([e.arrowHead]);e.svg.call(i);return e.svg.append("path").datum(o.map((t=>e.vertices[t-1]))).attr("fill","none").attr("vector-effect","non-scaling-stroke").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",gt.line().x((function(t){return n(t[0])})).y((function(t){return r(t[1])}))).attr("marker-end","url(#"+t+")")}},_t.Arrow=async(t,e)=>{await interpretate.shared.d3.load(),wt||(wt=(await interpretate.shared.d3["d3-arrow"]).arrow1),e.xAxis,e.yAxis;const o=uuidv4(),n=wt().id(o).attr("fill",e.color).attr("stroke","none").scale([e.arrowHead]);e.svg.call(n);const r=await interpretate(t[0],e);if(!Array.isArray(r)){let t;return t=r.attr("marker-end","url(#"+o+")"),t}if(e.local.line=gt.line().x((function(t){return e.xAxis(t[0])})).y((function(t){return e.yAxis(t[1])})),r[0][0][0]){const t=[];return r.forEach((n=>{t.push(e.svg.append("path").datum(n).attr("vector-effect","non-scaling-stroke").attr("fill","none").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",e.local.line).attr("marker-end","url(#"+o+")"))})),e.local.arrows=t,t}{const t=e.svg.append("path").datum(r).attr("vector-effect","non-scaling-stroke").attr("fill","none").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",e.local.line).attr("marker-end","url(#"+o+")");return e.local.arrow=t,t}},_t.Arrow.update=async(t,e)=>{e.xAxis,e.yAxis;const o=await interpretate(t[0],e);if(o[0][0][0])throw"Arrows update method does not support multiple traces";return e.local.arrow.datum(o).maybeTransitionTween(e.TransitionType,e.TransitionDuration,"d",(function(t){var o=gt.select(this).attr("d"),n=e.local.line(t);return mt(o,n)}))},_t.Arrow.virtual=!0,_t.Arrow.destroy=async()=>{},_t.Arrowheads=async(t,e)=>{const o=await interpretate(t[0],e);Array.isArray(o)?e.arrowHead=10*o.flat()[0]:e.arrowHead=10*o},_t.Text=async(t,e)=>{const o=await interpretate(t[0],e),n=await interpretate(t[1],e);e.local.text=o;let r={x:0,y:0};e.offset&&(r=e.offset);const i=e.svg.append("text").attr("font-family",e.fontfamily).attr("font-size",e.fontsize).attr("fill",e.color);if(t.length>2){const o=await interpretate(t[2],e);i.attr("x",e.xAxis(n[0]+o[0])+r.x).attr("y",e.yAxis(n[1]+o[1])+r.y)}else i.attr("x",e.xAxis(n[0])+r.x).attr("y",e.yAxis(n[1])+r.y);return _t.Text.PutText(i,o,e),e.local.object=i,i},_t.Text.PutText=(t,e,o)=>{if(!e)return;const n=[_t.Text.TokensSplit(e.replaceAll(/\\([a-zA-z]+)/g,_t.Text.GreekReplacer),_t.Text.TextOperators)].flat(1/0);let r;console.log(n),t.html(n.shift());let i=0;for(;null!=(r=n.shift());)"string"==typeof r?(t.append("tspan").html(r).attr("font-size",o.fontsize).attr("dy",-i),i=0):(i=-o.fontsize*r.ky,t.append("tspan").html(r.data).attr("font-size",Math.round(o.fontsize*r.kf)).attr("dy",i))},_t.Text.TextOperators=[{type:"sup",handler:t=>t,regexp:/\^(\d{1,3})/,meta:{ky:.5,kf:.5}},{type:"sup",handler:t=>t,regexp:/\^{([^{|}]*)}/,meta:{ky:.5,kf:.5}},{type:"sub",handler:t=>t,regexp:/\_(\d{1,3})/,meta:{ky:-.5,kf:.5}},{type:"sub",handler:t=>t,regexp:/\_{([^{|}]*)}/,meta:{ky:-.5,kf:.5}}],_t.Text.GreekReplacer=(t,e,o)=>"&"+e.toLowerCase().replace("sqrt","radic").replace("degree","deg")+";",_t.Text.TokensSplit=(t,e,o=0)=>{if(o===e.length||o<0)return t;const n=t.match(e[o].regexp);if(null===n)return _t.Text.TokensSplit(t,e,o+1);const r={type:e[o].type,data:e[o].handler(n[1]),...e[o].meta};return[_t.Text.TokensSplit(t.slice(0,n.index),e,o+1),r,_t.Text.TokensSplit(t.slice(n.index+n[0].length),e,0)]},_t.Text.virtual=!0,_t.Text.update=async(t,e)=>{const o=await interpretate(t[0],e),n=await interpretate(t[1],e);let r;return r=e.local.text!=o?e.local.object.maybeTransition(e.transitionType,e.transitionDuration).text(o).attr("x",e.xAxis(n[0])).attr("y",e.yAxis(n[1])).attr("fill",e.color):e.local.object.maybeTransition(e.transitionType,e.transitionDuration).attr("x",e.xAxis(n[0])).attr("y",e.yAxis(n[1])).attr("fill",e.color),r},_t.Text.destroy=()=>{console.log("Nothing to destory")},_t.Text.subcontext={},_t.FontSize=()=>"FontSize",_t.FontSize.update=_t.FontSize,_t.FontFamily=()=>"FontFamily",_t.FontFamily.update=_t.FontFamily,_t.Style=async(t,e)=>{const o={...e},n=await core._getRules(t,e);n.FontSize&&(o.fontsize=n.FontSize),n.FontColor&&(o.color=n.FontColor),n.FontFamily&&(o.fontfamily=n.FontFamily);for(let e=1;e<t.length-Object.keys(n).length;++e)await interpretate(t[e],o);return await interpretate(t[0],o)},_t.Style.update=async(t,e)=>{const o=await core._getRules(t,e);return o.FontSize&&(e.fontsize=o.FontSize),o.FontFamily&&(e.fontfamily=o.FontFamily),await interpretate(t[0],e)},_t.AnimationFrameListener=async(t,e)=>{await interpretate(t[0],e);const o=await core._getRules(t,{...e,hold:!0});e.local.event=await interpretate(o.Event,e),e.local.fire=()=>{server.kernel.emitt(e.local.event,"True","Frame")},window.requestAnimationFrame(e.local.fire)},_t.AnimationFrameListener.update=async(t,e)=>{window.requestAnimationFrame(e.local.fire)},_t.AnimationFrameListener.destroy=async(t,e)=>{console.warn("AnimationFrameListener does not exist anymore")},_t.AnimationFrameListener.virtual=!0,_t.GraphicsComplex=async(t,e)=>{const o=await interpretate(t[0],e),n=await core._getRules(t,e),r={...e,vertices:o,context:[yt,_t]};return n.VertexColors&&(r.vertexColors=n.VertexColors),await interpretate(t[1],r)},_t.GraphicsComplex.update=()=>{throw"Updates of GraphicsComplex are not supported!"},_t.GraphicsComplex.destroy=()=>{console.log("Nothing to destroy")},_t.GraphicsComplex.virtual=!0,_t.Medium=()=>.08,_t.Large=()=>1.1/10,_t.Small=()=>.025,_t.GraphicsGroup=async(t,e)=>await interpretate(t[0],e),_t.GraphicsGroup.update=async(t,e)=>await interpretate(t[0],e),_t.AbsoluteThickness=(t,e)=>{e.strokeWidth=interpretate(t[0],e)},_t.PointSize=(t,e)=>{e.pointSize=interpretate(t[0],e)},_t.Annotation=core.List,_t.ZoomAt=async(t,e)=>{let o=await interpretate(t[0],e),n=[0,0];t.length>1&&(n=await interpretate(t[1],e)),n=[e.xAxis(n[0])-e.xAxis(0),e.yAxis(n[1])-e.yAxis(0)],console.log(n);const r=e.panZoomEntites;console.log(e.svg.attr("transform"));const i=e.svg.node().getBBox(),a=gt.zoomIdentity.translate(i.width/2,i.height/2).scale(o).translate(-i.width/2-n[0],-i.height/2-n[1]);r.svg.maybeTransition(e.transitionType,e.transitionDuration).attr("transform",a),r.gX&&r.gX.maybeTransition(e.transitionType,e.transitionDuration).call(r.xAxis.scale(a.rescaleX(r.x))),r.gY&&r.gY.maybeTransition(e.transitionType,e.transitionDuration).call(r.yAxis.scale(a.rescaleY(r.y))),r.gTX&&r.gTX.maybeTransition(e.transitionType,e.transitionDuration).call(r.txAxis.scale(a.rescaleX(r.x))),r.gRY&&r.gRY.maybeTransition(e.transitionType,e.transitionDuration).call(r.ryAxis.scale(a.rescaleY(r.y)))};_t.Directive=async(t,e)=>{const o=await core._getRules(t,e);for(const t of Object.keys(o))e[t.toLowerCase()]=o[t];if((t=>{if("transitiontype"in t)switch(t.transitiontype){case"Linear":t.transitionType=gt.easeLinear;break;case"CubicInOut":t.transitionType=gt.easeCubicInOut;break;default:t.transitionType=!1}t.transitionduration&&(t.transitionDuration=t.transitionduration)})(e),"PlotRange"in o){o.PlotRange;((t,e,o,n)=>{throw"not implemented"})(0,e.plotRange,e.panZoomEntites)}for(let n=0;n<t.length-Object.keys(o).length;++n)await interpretate(t[n],e)},_t.EdgeForm=async(t,e)=>{const o={...e};await interpretate(t[0],o),e.strokeWidth=o.strokeWidth,e.strokeOpacity=o.opacity,"rgb(68, 68, 68)"!==o.color&&(e.stroke=o.color)},_t.EdgeForm.update=async(t,e)=>{},_t.Opacity=async(t,e)=>{e.opacity=await interpretate(t[0],e)},_t.GrayLevel=async(t,e)=>{let o=await interpretate(t[0],e);return o.length&&(o=o[0]),o=Math.floor(255*o),e.color=`rgb(${o},${o},${o})`,e.color},_t.RGBColor=async(t,e)=>{if(3==t.length)e.color="rgb(",e.color+=String(Math.floor(255*await interpretate(t[0],e)))+",",e.color+=String(Math.floor(255*await interpretate(t[1],e)))+",",e.color+=String(Math.floor(255*await interpretate(t[2],e)))+")";else{const o=await interpretate(t[0],e);e.color="rgb(",e.color+=String(Math.floor(255*o[0]))+",",e.color+=String(Math.floor(255*o[1]))+",",e.color+=String(Math.floor(255*o[2]))+")"}return e.color};_t.Hue=async(t,e)=>{if(3==t.length){let o=await Promise.all(t.map((t=>interpretate(t,e))));o=((t,e,o,n=o-o*e/2,r=Math.min(n,1-n))=>[t,r?(o-n)/r:0,n])(...o),o=[o[0],(100*o[1]).toFixed(2),(100*o[2]).toFixed(2)],e.color="hsl("+(314*o[0]).toFixed(2)+","+o[1]+"%,"+o[2]+"%)"}else console.error("g2d: Hue must have three arguments!")},_t.CubicInOut=()=>"CubicInOut",_t.Linear=()=>"Linear",_t.Tooltip=()=>{console.log("Tooltip is not implemented.")},yt.List=core.List,yt.Polygon=async(t,e)=>{let o=await interpretate(t[0],e);if(!e.vertices)throw"No vertices provided!";e.local.line||(e.local.line=gt.line().x((function(t){return e.xAxis(t[0])})).y((function(t){return e.yAxis(t[1])})));const n=[];let r=e.color;return o[0][0]||(o=[o]),o.forEach((t=>{e.vertexColors&&(r=[0,0,0],t.map((t=>{if("string"==typeof e.vertexColors[t-1]){const o=gt.color(e.vertexColors[t-1]);r[0]=r[0]+o.r/255,r[1]=r[1]+o.g/255,r[2]=r[2]+o.b/255}else r[0]=r[0]+e.vertexColors[t-1][0],r[1]=r[1]+e.vertexColors[t-1][1],r[2]=r[2]+e.vertexColors[t-1][2]})),r[0]=255*r[0]/t.length,r[1]=255*r[1]/t.length,r[2]=255*r[2]/t.length,r="rgb("+r[0]+","+r[1]+","+r[2]+")"),n.push(e.svg.append("path").datum(t.map((t=>e.vertices[t-1]))).attr("fill",r).attr("fill-opacity",e.opacity).attr("stroke-opacity",e.strokeOpacity||e.opacity).attr("vector-effect","non-scaling-stroke").attr("stroke-width",e.strokeWidth).attr("stroke",e.stroke||r).attr("d",e.local.line))})),n},_t.Polygon=async(t,e)=>{let o=await interpretate(t[0],e);if(e.local.line=gt.line().x((function(t){return e.xAxis(t[0])})).y((function(t){return e.yAxis(t[1])})),Array.isArray(o[0][0])){console.log("most likely there are many polygons");const t=e.svg.append("g").attr("fill",e.color).attr("fill-opacity",e.opacity).attr("stroke-opacity",e.strokeOpacity||e.opacity).attr("vector-effect","non-scaling-stroke").attr("stroke-width",e.strokeWidth).attr("stroke",e.stroke||e.color);return o.forEach((o=>{o.push(o[0]),t.append("path").datum(o).attr("d",e.local.line)})),e.local.polygons=t,t}return o.push(o[0]),e.local.area=e.svg.append("path").datum(o).attr("fill",e.color).attr("fill-opacity",e.opacity).attr("stroke-opacity",e.strokeOpacity||e.opacity).attr("vector-effect","non-scaling-stroke").attr("stroke-width",e.strokeWidth).attr("stroke",e.stroke||e.color).attr("d",e.local.line),e.local.area},_t.Polygon.update=async(t,e)=>{let o=await interpretate(t[0],e);if(e.local.polygons)throw"update method for many polygons in not supported";e.xAxis,e.yAxis;return e.local.area.datum(o).maybeTransitionTween(e.transitionType,e.transitionDuration,"d",(function(t){var o=gt.select(this).attr("d"),n=e.local.line(t);return mt(o,n)}))},_t.Polygon.destroy=(t,e)=>{if(console.log("area destroyed"),e.local)return e.local.area?(e.local.area.remove(),void delete e.local.area):void(e.local.polygons&&(e.local.polygons.remove(),delete e.local.polygons))},_t.Polygon.virtual=!0,_t.IdentityFunction=async(t,e)=>await interpretate(t[0],e),_t.Tooltip=_t.IdentityFunction,_t.StatusArea=_t.IdentityFunction,_t["Charting`DelayedMouseEffect"]=_t.IdentityFunction,yt.Line=async(t,e)=>{console.log("drawing a line");let o=await interpretate(t[0],e);const n=e.xAxis,r=e.yAxis;if(o[0][0]){const t=e.svg.append("g");return t.attr("fill","none").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth),o.forEach((o=>{t.append("path").datum(o.map((t=>e.vertices[t-1]))).attr("vector-effect","non-scaling-stroke").attr("d",gt.line().x((function(t){return n(t[0])})).y((function(t){return r(t[1])})))})),t}return e.svg.append("path").datum(o.map((t=>e.vertices[t-1]))).attr("fill","none").attr("vector-effect","non-scaling-stroke").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",gt.line().x((function(t){return n(t[0])})).y((function(t){return r(t[1])})))},_t.BezierCurve=async(t,e)=>{let o=await interpretate(t[0],e);var n=gt.path();const r=e.xAxis,i=e.yAxis;o=o.map((t=>[r(t[0]),i(t[1])])),n.moveTo(...o[0]);for(let t=1;t<o.length-2;t+=3)n.bezierCurveTo(...o[t],...o[t+1],...o[t+2]);return e.svg.append("path").attr("fill","none").attr("vector-effect","non-scaling-stroke").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",n)},_t.Line=async(t,e)=>{let o=await interpretate(t[0],e);const n=e.xAxis,r=e.yAxis,i=uuidv4();let a;switch(e.local.uid=i,e.local.uid=i,ft(o)){case 0:a=e.svg.append("path").datum([]).attr("class","line-"+i).attr("fill","none").attr("vector-effect","non-scaling-stroke").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",gt.line().x((function(t){return n(t[0])})).y((function(t){return r(t[1])})));break;case 2:a=e.svg.append("path").datum(o).attr("class","line-"+i).attr("vector-effect","non-scaling-stroke").attr("fill","none").attr("opacity",e.opacity).attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",gt.line().x((function(t){return n(t[0])})).y((function(t){return r(t[1])})));break;case 3:console.log(o),o.forEach(((t,o)=>{a=e.svg.append("path").datum(t).join("path").attr("class","line-"+i+"-"+o).attr("vector-effect","non-scaling-stroke").attr("fill","none").attr("stroke",e.color).attr("stroke-width",e.strokeWidth).attr("d",gt.line().x((function(t){return n(t[0])})).y((function(t){return r(t[1])})))}))}return e.local.nsets=o.length,e.local.line=gt.line().x((function(t){return e.xAxis(t[0])})).y((function(t){return e.yAxis(t[1])})),e.local.object=a,a},_t.Line.update=async(t,e)=>{let o=await interpretate(t[0],e);const n=e.xAxis,r=e.yAxis;let i;switch(ft(o)){case 0:i=e.svg.selectAll(".line-"+e.local.uid).datum([]).attr("class","line-"+e.local.uid).maybeTransitionTween(e.transitionType,e.transitionDuration,"d",(function(t){var o=gt.select(this).attr("d"),n=e.local.line(t);return mt(o,n)}));break;case 2:Math.min(o.length,e.local.nsets),i=e.svg.selectAll(".line-"+e.local.uid).datum(o).attr("class","line-"+e.local.uid).maybeTransitionTween(e.transitionType,e.transitionDuration,"d",(function(t){var o=gt.select(this).attr("d"),n=e.local.line(t);return mt(o,n)}));break;case 3:for(let t=0;t<Math.min(o.length,e.local.nsets);++t)console.log("upd 1"),i=e.svg.selectAll(".line-"+e.local.uid+"-"+t).datum(o[t]).attr("class","line-"+e.local.uid+"-"+t).maybeTransitionTween(e.transitionType,e.transitionDuration,"d",(function(t){var o=gt.select(this).attr("d"),n=e.local.line(t);return mt(o,n)}));if(o.length>e.local.nsets){console.log("upd 2"),console.log("new lines");for(let t=e.local.nsets;t<o.length;++t)i=e.svg.append("path").datum(o[t]).attr("class","line-"+e.local.uid+"-"+t).attr("fill","none").attr("stroke",e.color).attr("stroke-width",e.strokeWidth).maybeTransition(e.transitionType,e.transitionDuration).attr("d",gt.line().x((function(t){return n(t[0])})).y((function(t){return r(t[1])})))}if(o.length<e.local.nsets){console.log("upd 3");for(let t=o.length;t<e.local.nsets;++t)i=e.svg.selectAll(".line-"+e.local.uid+"-"+t).datum(o[0]).join("path").attr("class","line-"+e.local.uid+"-"+t).maybeTransition(e.transitionType,e.transitionDuration).attr("d",e.local.line)}}return e.local.nsets=Math.max(o.length,e.local.nsets),i},_t.Line.virtual=!0,_t.Line.destroy=(t,e)=>{console.log("nothing to destroy"),e.local&&e.local.object&&(Array.isArray(e.local.object)?e.local.object.forEach((t=>t.remove())):e.local.object.remove(),delete e.local.object)},_t.Circle=async(t,e)=>{let o=await interpretate(t[0],e),n=1;t.length>1&&(n=await interpretate(t[1],e),Array.isArray(n)&&(n=(n[0]+n[1])/2));const r=e.xAxis,i=e.yAxis,a=e.svg.append("circle").attr("vector-effect","non-scaling-stroke").attr("cx",r(o[0])).attr("cy",i(o[1])).attr("r",r(n)-r(0)).style("stroke",e.color).style("fill","none").style("opacity",e.opacity);return e.local.object=a,a},_t.Circle.update=async(t,e)=>{let o=await interpretate(t[0],e),n=1;t.length>1&&(n=await interpretate(t[1],e),Array.isArray(n)&&(n=(n[0]+n[1])/2));const r=e.xAxis,i=e.yAxis;return e.local.object.maybeTransition(e.transitionType,e.transitionDuration).attr("cx",r(o[0])).attr("cy",i(o[1])).attr("r",r(n)-r(0)),e.local.object},_t.Circle.destroy=()=>{},_t.Circle.virtual=!0,_t._arc=async(t,e)=>{let o=await interpretate(t[0],e),n=await interpretate(t[1],e);Array.isArray(n)&&(n=(n[0]+n[1])/2);let r=await interpretate(t[2],e);const i=e.xAxis,a=e.yAxis;e.local.coords=[i(o[0]),a(o[1])],e.local.r=i(n)-i(0);const s=gt.arc().outerRadius(0).innerRadius(e.local.r).startAngle(r[0]).endAngle(r[1]);e.local.arc=s,console.log({x:i(o[0]),xorg:o[0],r:e.local.r,rorg:n});return e.svg.append("path").attr("vector-effect","non-scaling-stroke").attr("transform",`translate(${i(o[0])},${a(o[1])})`).style("stroke","none").style("fill",e.color).style("opacity",e.opacity).attr("d",s)},yt.Disk=async(t,e)=>{if(t.length>2)throw"Graphics complex with arcs is not supported";let o=await interpretate(t[0],e),n=1;t.length>1&&(n=await interpretate(t[1],e),Array.isArray(n)&&(n=(n[0]+n[1])/2));const r=e.xAxis,i=e.yAxis;if(o[0]){const t=[],a=r(n)-r(0);return o.map((t=>e.vertices[t-1])).map((o=>{t.push(e.svg.append("circle").attr("vector-effect","non-scaling-stroke").attr("cx",r(o[0])).attr("cy",i(o[1])).attr("r",a).style("stroke","none").style("fill",e.color).style("opacity",e.opacity))})),t}{const t=e.vertices[o-1],a=[r(t[0]),i(t[1])],s=r(n)-r(0);return e.svg.append("circle").attr("vector-effect","non-scaling-stroke").attr("cx",a[0]).attr("cy",a[1]).attr("r",s).style("stroke","none").style("fill",e.color).style("opacity",e.opacity)}},_t.Disk=async(t,e)=>{if(t.length>2)return await _t._arc(t,e);let o=await interpretate(t[0],e),n=1;t.length>1&&(n=await interpretate(t[1],e),Array.isArray(n)&&(n=(n[0]+n[1])/2));const r=e.xAxis,i=e.yAxis;e.local.coords=[r(o[0]),i(o[1])],e.local.r=r(n)-r(0);const a=e.svg.append("circle").attr("vector-effect","non-scaling-stroke").attr("cx",r(o[0])).attr("cy",i(o[1])).attr("r",e.local.r).style("stroke","none").style("fill",e.color).style("opacity",e.opacity);return e.local.object=a,a},_t.Disk.update=async(t,e)=>{let o=await interpretate(t[0],e),n=1;t.length>1&&(n=await interpretate(t[1],e),Array.isArray(n)&&(n=(n[0]+n[1])/2));const r=e.xAxis,i=e.yAxis;e.local.coords=[r(o[0]),i(o[1])],e.local.r=r(n)-r(0),e.local.object.maybeTransition(e.transitionType,e.transitionDuration).attr("cx",e.local.coords[0]).attr("cy",e.local.coords[1]).attr("r",e.local.r)},_t.Disk.virtual=!0,_t.Disk.destroy=(t,e)=>{console.log("nothing to destroy"),e.local&&e.local.object&&(e.local.object.remove(),delete e.local.object)},yt.Point=async(t,e)=>{let o=await interpretate(t[0],e);const n=e.xAxis,r=e.yAxis;o[0][0]&&(o=o.flat()),o=o.map((t=>e.vertices[t-1]));const i=e.svg.append("g").style("stroke-width",100*e.pointSize*2).style("stroke-linecap","round").style("stroke",e.color).style("opacity",e.opacity),a=[];let s;return o.forEach(((t,o)=>{if(e.vertexColors){if(s=[0,0,0],"string"==typeof e.vertexColors[o]){const t=gt.color(e.vertexColors[o]);s[0]=s[0]+t.r/255,s[1]=s[1]+t.g/255,s[2]=s[2]+t.b/255}else s[0]=s[0]+e.vertexColors[o][0],s[1]=s[1]+e.vertexColors[o][1],s[2]=s[2]+e.vertexColors[o][2];s[0]=255*s[0],s[1]=255*s[1],s[2]=255*s[2],s="rgb("+s[0]+","+s[1]+","+s[2]+")",a.push(i.append("path").attr("stroke",s).attr("d",`M ${n(t[0])} ${r(t[1])} l 0.0001 0`).attr("vector-effect","non-scaling-stroke"))}else a.push(i.append("path").attr("d",`M ${n(t[0])} ${r(t[1])} l 0.0001 0`).attr("vector-effect","non-scaling-stroke"))})),i},_t.Point=async(t,e)=>{let o=await interpretate(t[0],e);const n=e.xAxis,r=e.yAxis,i=ft(o);0===i?o=[]:i<2&&(o=[o]);const a=uuidv4();e.local.uid=a;const s=e.svg.append("g").style("stroke-width",100*e.pointSize*2).style("stroke-linecap","round").style("stroke",e.color).style("opacity",e.opacity),l=[];return o.forEach(((t,e)=>{l.push(s.append("path").attr("d",`M ${n(t[0])} ${r(t[1])} l 0.0001 0`).attr("vector-effect","non-scaling-stroke"))})),e.local.points=l,e.local.object=s,s},_t.Point.update=async(t,e)=>{let o=await interpretate(t[0],e);const n=ft(o);0===n?o=[]:n<2&&(o=[o]);const r=e.xAxis,i=e.yAxis;let a;const s=e.local.object,l=Math.min(e.local.points.length,o.length);let c=[0,0];for(let t=e.local.points.length;t<o.length;t++)t-1>=0&&(c=o[t-1]),a=s.append("path").attr("d",`M ${r(c[0])} ${i(c[1])} l 0.0001 0`).style("opacity",e.opacity/5).attr("vector-effect","non-scaling-stroke"),e.local.points.push(a),a=a.maybeTransition(e.transitionType,e.transitionDuration).attr("d",`M ${r(o[t][0])} ${i(o[t][1])} l 0.0001 0`).style("opacity",e.opacity);for(let t=e.local.points.length;t>o.length;t--)a=e.local.points.pop(),a.maybeTransition(e.transitionType,e.transitionDuration).style("opacity",0).remove();for(let t=0;t<l;t++)a=e.local.points[t].maybeTransition(e.transitionType,e.transitionDuration).attr("d",`M ${r(o[t][0])} ${i(o[t][1])} l 0.0001 0`);return a},_t.Point.virtual=!0,_t.Point.destroy=(t,e)=>{console.log("nothing to destroy"),e.local&&e.local.object&&(Array.isArray(e.local.object)?e.local.object.forEach((t=>t.remove())):e.local.object.remove(),delete e.local.object)},_t.EventListener=async(t,e)=>{const o=await interpretate(t[1],e),n={...e};let r=await interpretate(t[0],n);return Array.isArray(r)&&(r=r[0]),o.forEach((t=>{_t.EventListener[t.lhs](t.rhs,r,n)})),null},_t.EventListener.update=async(t,e)=>{console.log("EventListener does not support updates")},_t.EventListener.onload=(t,e,o)=>{console.log("onload event generator"),server.kernel.emitt(t,"True","onload")},_t.MiddlewareListener=async(t,e)=>{const o=await core._getRules(t,e),n=await interpretate(t[1],e),r=await interpretate(t[2],e);return console.log(t),e.local.middleware=_t.MiddlewareListener[n](r,o,e),await interpretate(t[0],e)},_t.MiddlewareListener.update=(t,e)=>interpretate(t[0],e),_t.MiddlewareListener.end=(t,e,o)=>{const n=e.Threshold||1;return server.kernel.emitt(t,"True","end"),console.log("pre Fire"),e=>{let o=!1;return e.then((e=>e.tween(t,(function(e){return function(e){e>=n&&!o&&(server.kernel.emitt(t,"True","end"),o=!0)}}))))}},_t.MiddlewareListener.endtransition=_t.MiddlewareListener.end,_t.EventListener.drag=(t,e,o)=>{console.log("drag event generator"),console.log(o.local);const n=o.xAxis,r=o.yAxis;let i=[];const a=throttle(((e,o)=>{server.kernel.emitt(t,`{${e}, ${o}}`.replace("e","*^").replace("e","*^"),"drag")}));e.call(gt.drag().on("start",(function(t,e){0===i.length&&(i=[t.x,t.y])})).on("drag",(function(t,e){gt.select(this).raise().attr("transform",(e=>"translate("+[t.x-i[0],t.y-i[1]]+")")),a(n.invert(t.x),r.invert(t.y))})).on("end",(function(t,e){})))},_t.EventListener.dragall=(t,e,o)=>{console.log("drag event generator"),console.log(o.local);const n=o.xAxis,r=o.yAxis;const i=throttle(((e,o,n)=>{server.kernel.emitt(t,`{"${n}", {${e}, ${o}}}`.replace("e","*^").replace("e","*^"),"dragall")}));e.call(gt.drag().on("start",(function(t,e){i(n.invert(t.x),r.invert(t.y),"dragstarted")})).on("drag",(function(t,e){i(n.invert(t.x),r.invert(t.y),"dragged")})).on("end",(function(t,e){i(n.invert(t.x),r.invert(t.y),"dragended")})))},_t.EventListener.click=(t,e,o)=>{console.log("click event generator"),console.log(o.local);const n=o.xAxis,r=o.yAxis,i=throttle(((e,o)=>{server.kernel.emitt(t,`{${e}, ${o}}`.replace("e","*^").replace("e","*^"),"click")}));e.call(gt.drag().on("start",(function(t,e){i(n.invert(t.x),r.invert(t.y))})))},_t.EventListener.mousedown=(t,e,o)=>{console.log("mousedown event generator"),console.log(o.local);const n=o.xAxis,r=o.yAxis,i=throttle(((e,o)=>{server.kernel.emitt(t,`{${e}, ${o}}`.replace("e","*^").replace("e","*^"),"click")}));e.on("mousedown",(function(t,e){i(n.invert(t.x),r.invert(t.y))}))},_t.EventListener.mouseup=(t,e,o)=>{console.log("mouseup event generator"),console.log(o.local);const n=o.xAxis,r=o.yAxis,i=throttle(((e,o)=>{server.kernel.emitt(t,`{${e}, ${o}}`.replace("e","*^").replace("e","*^"),"click")}));e.on("mouseup",(function(t,e){i(n.invert(t.x),r.invert(t.y))}))},_t.EventListener.keydown=(t,e,o)=>{console.error("You cannot listen keys from the SVG element!")},_t.EventListener.mousemove=(t,e,o)=>{console.log("mouse event generator"),console.log(o.local);const n=o.xAxis,r=o.yAxis,i=throttle(((e,o)=>{server.kernel.emitt(t,`{${e}, ${o}}`.replace("e","*^").replace("e","*^"),"mousemove")}));e.on("mousemove",(t=>{return e=gt.pointer(t),void i(n.invert(e[0]),r.invert(e[1]));var e}))},_t.EventListener.mouseover=(t,e,o)=>{console.log("mouse event generator"),console.log(o.local);const n=o.xAxis,r=o.yAxis,i=throttle(((e,o)=>{server.kernel.emitt(t,`{${e}, ${o}}`.replace("e","*^").replace("e","*^"),"mouseover")}));e.on("mouseover",(t=>{return e=gt.pointer(t),void i(n.invert(e[0]),r.invert(e[1]));var e}))},_t.EventListener.zoom=(t,e,o)=>{console.log("zoom event generator"),console.log(o.local);const n=throttle((e=>{server.kernel.emitt(t,`${e}`,"zoom")}));e.call(gt.zoom().on("zoom",(function(t){console.log(),n(t.transform.k)})))},_t.Rotate=async(t,e)=>{const o=await interpretate(t[1],e);t.length>2&&await interpretate(t[2],e);const n=e.svg.append("g");e.local.group=n,await interpretate(t[0],{...e,svg:n});const r=n.node().getBBox(),i="rotate("+o/Math.PI*180+", "+(r.x+r.width/2)+", "+(r.y+r.height/2)+")";n.attr("transform",i),e.local.rotation=i},_t.Rotate.update=async(t,e)=>{const o=await interpretate(t[1],e),n=e.local.group.node().getBBox(),r="rotate("+o/Math.PI*180+", "+(n.x+n.width/2)+", "+(n.y+n.height/2)+")";var i=gt.interpolateString(e.local.rotation,r);e.local.group.maybeTransitionTween(e.transitionType,e.transitionDuration,"transform",(function(t,e,o){return i})),e.local.rotation=r},_t.Rotate.virtual=!0,_t.Rotate.destroy=(t,e)=>{console.log("nothing to destroy")},_t.Translate=async(t,e)=>{const o=await interpretate(t[1],e),n=e.svg.append("g");e.local.group=n;const r=e.xAxis,i=e.yAxis;return await interpretate(t[0],{...e,svg:n}),n.attr("transform",`translate(${r(o[0])-r(0)}, ${i(o[1])-i(0)})`)},_t.Translate.update=async(t,e)=>{const o=await interpretate(t[1],e),n=e.xAxis,r=e.yAxis;return e.local.group.maybeTransition(e.transitionType,e.transitionDuration).attr("transform",`translate(${n(o[0])-n(0)}, ${r(o[1])-r(0)})`)},_t.Translate.virtual=!0,_t.Translate.destroy=(t,e)=>{console.log("nothing to destroy")},_t.Center=()=>"Center",_t.Center.update=_t.Center,_t.Degree=()=>Math.PI/180,_t.Degree.update=_t.Degree,_t.Rectangle=async(t,e)=>{const o=await interpretate(t[0],e),n=await interpretate(t[1],e);if(o[1]>n[1]){const t=o[1];o[1]=n[1],n[1]=t}if(o[0]>n[0]){const t=o[0];o[0]=n[0],n[0]=t}const r=e.xAxis,i=e.yAxis;o[0]=r(o[0]),o[1]=i(o[1]),n[0]=r(n[0]),n[1]=i(n[1]);const a=[Math.abs(n[0]-o[0]),Math.abs(n[1]-o[1])];return e.local.rect=e.svg.append("rect").attr("x",o[0]).attr("y",o[1]-a[1]).attr("width",a[0]).attr("height",a[1]).attr("vector-effect","non-scaling-stroke").attr("stroke",e.stroke).attr("opacity",e.opacity).attr("fill",e.color),e.local.rect},_t.Rectangle.update=async(t,e)=>{const o=await interpretate(t[0],e),n=await interpretate(t[1],e);if(o[1]>n[1]){const t=o[1];o[1]=n[1],n[1]=t}if(o[0]>n[0]){const t=o[0];o[0]=n[0],n[0]=t}const r=e.xAxis,i=e.yAxis;o[0]=r(o[0]),o[1]=i(o[1]),n[0]=r(n[0]),n[1]=i(n[1]);const a=[Math.abs(n[0]-o[0]),Math.abs(n[1]-o[1])];e.local.rect.maybeTransition(e.transitionType,e.transitionDuration).attr("x",o[0]).attr("y",o[1]-a[1]).attr("width",a[0]).attr("height",a[1])},_t.Rectangle.virtual=!0,_t.Rectangle.destroy=(t,e)=>{console.log("nothing to destroy"),e.local&&e.local.rect&&(e.local.rect.remove(),delete e.local.rect)},_t.Void=(t,e)=>{},_t.Identity=_t.Void,_t.Scaled=_t.Void,_t.GoldenRatio=_t.Void,_t.None=()=>!1,_t.AbsolutePointSize=_t.Void,_t.CopiedValueFunction=_t.Void,_t.Raster=async(t,e)=>{if(e.image)return await interpretate(t[0],e);const o=await interpretate(t[0],{...e,context:_t,nfast:!0,numeric:!0});console.log(t);const n=o.length,r=o[0].length,i=o[0][0].length,a=e.xAxis,s=e.yAxis;let l=[[0,r],[0,n]];if(t.length>1){const o=await interpretate(t[1],e);l[0][0]=o[0][0],l[0][1]=o[1][0],l[1][0]=o[0][1],l[1][1]=o[1][1]}t.length>2&&(await interpretate(t[2],e),console.warn("scaling is not implemented!"));const c=Math.abs((a(l[0][1])-a(l[0][0]))/r),d=Math.abs((s(l[1][1])-s(l[1][0]))/n),u=(l[0][1]-l[0][0])/r,p=(l[1][1]-l[1][0])/n,h=e.svg;if(i)if(2!==i)if(3!==i)if(4!==i);else for(let t=0;t<n;++t)for(let e=0;e<r;++e)h.append("rect").attr("x",a(u*e+l[0][0])).attr("y",s(p*t+l[1][0])-d).attr("width",c).attr("height",d).attr("opacity",o[t][e][3]).attr("fill",`rgb(${Math.floor(255*o[t][e][0])}, ${Math.floor(255*o[t][e][1])}, ${Math.floor(255*o[t][e][2])})`);else for(let t=0;t<n;++t)for(let n=0;n<r;++n)h.append("rect").attr("x",a(u*n+l[0][0])).attr("y",s(p*t+l[1][0])-d).attr("width",c).attr("height",d).attr("opacity",e.opacity).attr("fill",`rgb(${Math.floor(255*o[t][n][0])}, ${Math.floor(255*o[t][n][1])}, ${Math.floor(255*o[t][n][2])})`);else for(let t=0;t<n;++t)for(let e=0;e<r;++e)h.append("rect").attr("x",a(u*e+l[0][0])).attr("y",s(p*t+l[1][0])-d).attr("width",c).attr("height",d).attr("opacity",o[t][e][1]).attr("fill",`rgb(${Math.floor(255*o[t][e][0])}, ${Math.floor(255*o[t][e][0])}, ${Math.floor(255*o[t][e][0])})`);else for(let t=0;t<n;++t)for(let n=0;n<r;++n)h.append("rect").attr("x",a(u*n+l[0][0])).attr("y",s(p*t+l[1][0])-d).attr("width",c).attr("height",d).attr("opacity",e.opacity).attr("fill",`rgb(${Math.floor(255*o[t][n])}, ${Math.floor(255*o[t][n])}, ${Math.floor(255*o[t][n])})`)},_t.Magnification=()=>"Magnification",_t.ColorSpace=()=>"ColorSpace",_t.Interleaving=()=>"Interleaving",_t.MetaInformation=()=>"MetaInformation",_t.ImageResolution=()=>"ImageResolution",_t.DateObject=()=>{console.warn("Date Object is not supported for now")},_t.Image=async(t,e)=>{const o=await core._getRules(t,{...e,context:_t}),n=performance.now(),r=await interpretate(t[0],{...e,context:_t,nfast:!0,numeric:!0,image:!0}),i=r.length,a=r[0].length;console.log(a),console.log(i);let s=o.ImageSize;o.Magnification&&(s=Math.floor(a*o.Magnification)),s||(s=e.imageSize?e.imageSize:a),Array.isArray(s)&&(s=s[0]);const l=Math.floor(s),c=Math.floor(i/a*s),d=a/l;console.log(d);const u=r[0][0].length;let p;if(e.inset){p=e.inset.append("foreignObject").attr("width",l).attr("height",c).append("xhtml:canvas").attr("xmlns","http://www.w3.org/1999/xhtml").node().getContext("2d")}else{const t=document.createElement("canvas");t.width=l,t.height=c,e.element.appendChild(t),p=t.getContext("2d")}e.local.ctx=p,e.local.length=a*i*4,e.local.width=a,e.local.height=i,e.local.target_width=l,e.local.target_height=c,e.local.scalingFactor=d,e.local.rgb=u;const h=new Uint8ClampedArray(l*c*4);let f,g,m=0;if(u){if(3===u)for(let t=0;t<c;++t)for(let e=0;e<l;++e)f=Math.floor(t*d),g=Math.floor(e*d),h[m+0]=r[f][g][0],h[m+1]=r[f][g][1],h[m+2]=r[f][g][2],h[m+3]=255,m+=4;if(4===u)for(let t=0;t<c;++t)for(let e=0;e<l;++e)f=Math.floor(t*d),g=Math.floor(e*d),h[m+0]=r[f][g][0],h[m+1]=r[f][g][1],h[m+2]=r[f][g][2],h[m+3]=255,m+=4;p.putImageData(new ImageData(h,l,c),0,0),console.warn(performance.now()-n+" passed")}else{for(let t=0;t<c;++t)for(let e=0;e<l;++e)f=Math.floor(t*d),g=Math.floor(e*d),h[m+0]=255*r[f][g],h[m+1]=255*r[f][g],h[m+2]=255*r[f][g],h[m+3]=255,m+=4;p.putImageData(new ImageData(h,a,i),0,0)}},_t.Image.update=async(t,e)=>{const o=await interpretate(t[0],{...e,nfast:!0,numeric:!0,image:!0});o.length,o[0].length;const n=o[0][0].length,r=e.local.ctx,i=e.local.target_width,a=e.local.target_height,s=e.local.scalingFactor,l=new Uint8ClampedArray(i*a*4);let c,d,u=0;if(n){if(3===n)for(let t=0;t<a;++t)for(let e=0;e<i;++e)c=Math.floor(t*s),d=Math.floor(e*s),l[u+0]=o[c][d][0],l[u+1]=o[c][d][1],l[u+2]=o[c][d][2],l[u+3]=255,u+=4;if(4===n)for(let t=0;t<a;++t)for(let e=0;e<i;++e)c=Math.floor(t*s),d=Math.floor(e*s),l[u+0]=o[c][d][0],l[u+1]=o[c][d][1],l[u+2]=o[c][d][2],l[u+3]=255,u+=4;r.putImageData(new ImageData(l,i,a),0,0)}else{for(let t=0;t<a;++t)for(let e=0;e<i;++e)c=Math.floor(t*s),d=Math.floor(e*s),l[u+0]=255*o[c][d],l[u+1]=255*o[c][d],l[u+2]=255*o[c][d],l[u+3]=255,u+=4;r.putImageData(new ImageData(l,i,a),0,0)}},_t.Image.destroy=(t,e)=>{},_t.GraphicsGroupBox=_t.GraphicsGroup,_t.GraphicsComplexBox=_t.GraphicsComplex,_t.DiskBox=_t.Disk,_t.LineBox=_t.Line;
